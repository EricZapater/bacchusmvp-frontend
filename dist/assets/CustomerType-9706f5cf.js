import{u as k,b as w}from"./vue-router-b024814c.js";import{u as F}from"./customers-aaa7ae8d.js";import{j as C,k as V,f as T,c as I,h as d,n as f,e as N,d as _,o as B,u as h,ax as M,M as R,l as v,a as $,P as g}from"./index-2bfc80b2.js";import{c as A,a as b,F as D}from"./form-validator-1a569dfe.js";import{u as E}from"./usetoast.esm-82b2df9e.js";import{F as i}from"./component-c8ee66ae.js";import"./base.service-8b4a1a4e.js";const S={key:0},L={class:"mt-2"},U=C({__name:"FormCustomerType",props:{customerType:{}},emits:["submit","cancel"],setup(y,{emit:n}){const m=y,u=E(),l=A().shape({name:b().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),description:b().required("La descripció és obligatori").max(250,"La descripció no pot superar els 250 carácters")}),e=V({result:!1,errors:{}}),c=()=>{const t=new D(l);e.value=t.validate(m.customerType)},p=async()=>{if(c(),e.value.result)n("submit",m.customerType);else{let t="";Object.entries(e.value.errors).forEach(o=>{t+=`${o[1].map(s=>s)}.   `}),u.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,o)=>{const s=T("BaseInput"),r=T("Button");return t.customerType?(B(),I("form",S,[d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.name}]),label:"Nom",id:"name",modelValue:t.customerType.name,"onUpdate:modelValue":o[0]||(o[0]=a=>t.customerType.name=a)},null,8,["modelValue","class"]),d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.description}]),label:"Descripció",id:"description",modelValue:t.customerType.description,"onUpdate:modelValue":o[1]||(o[1]=a=>t.customerType.description=a)},null,8,["modelValue","class"]),N("div",L,[d(r,{label:"Guardar",class:"mr-2",onClick:p})])])):_("",!0)}}}),H=C({__name:"CustomerType",setup(y){const n=V(i.EDIT),m=k(),u=w(),l=h(),e=F(),{customerType:c}=M(e),p=async()=>{await e.fetchCustomerType(u.params.id);let s="";c.value?(n.value=i.EDIT,s=`Tipus de client ${c.value.name}`):(n.value=i.CREATE,e.setNewCustomerType(u.params.id),s="Alta de tipus de client"),l.setMenuItem({icon:g.BUILDING,backButtonVisible:!0,text:s})};R(async()=>{await p()});const t=E(),o=async()=>{const s=c.value;let r=!1,a="";n.value===i.CREATE?(r=await e.createCustomerType(s),a="Tipus de client creat correctament"):(r=await e.updateCustomerType(s.id,s),a="Tipus de client actualizat correctament"),r&&(t.add({severity:"success",summary:a,life:5e3}),m.back())};return(s,r)=>v(e).customerType?(B(),$(U,{key:0,customerType:v(e).customerType,onSubmit:o},null,8,["customerType"])):_("",!0)}});export{H as default};
