import{b as M}from"./vue-router-b024814c.js";import{j as C,ax as D,E as U,k as P,f,a as F,w as E,d as g,o as y,e as d,h as u,l as _,P as V,n as w,q as A,s as j,c as $,u as L,M as R,F as z}from"./index-2bfc80b2.js";import{u as N}from"./purchaseInvoiceStatus-1f687557.js";import{u as q}from"./usetoast.esm-82b2df9e.js";import{F as T}from"./component-c8ee66ae.js";import{r as O}from"./router-2586516d.js";import{u as G}from"./useconfirm.esm-4982caff.js";import{v as H}from"./v4-a960c1f4.js";import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";import{B}from"./BaseInput-95847e6b.js";import{c as K,a as x,F as Q}from"./form-validator-1a569dfe.js";import"./index-78dd0e83.js";import"./base.service-8b4a1a4e.js";import"./suppliers.service-82e016ae.js";import"./runtime-dom.esm-bundler-0884c737.js";const W=m=>(A("data-v-73dec45e"),m=m(),j(),m),X={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Y=W(()=>d("span",{class:"text-xl text-900 font-bold"},"Transicions",-1)),Z=["onClick"],ee=C({__name:"TablePurchaseInvoiceStatusTransitions",props:{purchaseInvoiceStatus:{}},emits:["add","delete"],setup(m,{emit:p}){const c=m,I=G(),r=N(),{purchaseInvoiceStatuses:o}=D(r),S=U(()=>{var e;let s=[];return(e=o.value)==null||e.forEach(t=>{var v,b,h;!((b=(v=c.purchaseInvoiceStatus)==null?void 0:v.transitions)==null?void 0:b.find(k=>k.id===t.id))&&t.id!==((h=c.purchaseInvoiceStatus)==null?void 0:h.id)&&s.push(t)}),s}),i=P(void 0),a=()=>{var e,t;const s={id:H(),fromStatusId:(e=c.purchaseInvoiceStatus)==null?void 0:e.id,toStatusId:(t=i.value)==null?void 0:t.id};p("add",s)},n=(s,e)=>{I.require({target:s.currentTarget,message:"Está segur que vol eliminar la transició?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{var t,l;p("delete",{id:(t=i.value)==null?void 0:t.id,fromStatusId:(l=c.purchaseInvoiceStatus)==null?void 0:l.id,toStatusId:e.id})}})};return(s,e)=>{const t=f("Dropdown"),l=f("Button"),v=f("Column"),b=f("DataTable");return s.purchaseInvoiceStatus?(y(),F(b,{key:0,class:"p-datatable-small",value:s.purchaseInvoiceStatus.transitions},{header:E(()=>[d("div",X,[Y,d("div",null,[u(t,{class:"status-selector",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=h=>i.value=h),options:S.value,placeholder:"Selecc. un estat",optionLabel:"name"},null,8,["modelValue","options"]),u(l,{icon:_(V).PLUS,rounded:"",raised:"",onClick:a},null,8,["icon"])])])]),default:E(()=>[u(v,{field:"name",header:"Nom"}),u(v,{field:"description",header:"Descripció"}),u(v,null,{body:E(h=>[d("i",{class:w([_(V).TIMES,"grid_delete_column_button"]),onClick:k=>n(k,h.data)},null,10,Z)]),_:1})]),_:1},8,["value"])):g("",!0)}}});const te=J(ee,[["__scopeId","data-v-73dec45e"]]),ae={key:0},se={class:"three-columns"},oe=d("label",{class:"block text-900 mb-2"},"Desactivat",-1),ne={class:"mt-2"},re=C({__name:"FormPurchaseInvoiceStatus",props:{purchaseInvoiceStatus:{}},emits:["submit","cancel"],setup(m,{emit:p}){const c=m,I=q(),r=K().shape({name:x().required("El nom de l'estat és obligatori").max(50,"El nom de l'estat no pot superar els 50 caràcters"),description:x().required("La descripció de l'estat és obligatòri").max(250,"La descripció de l'estat no pot superar els 50 caràcters")}),o=P({result:!1,errors:{}}),S=()=>{const a=new Q(r);o.value=a.validate(c.purchaseInvoiceStatus)},i=async()=>{if(S(),o.value.result)p("submit",c.purchaseInvoiceStatus);else{let a="";Object.entries(o.value.errors).forEach(n=>{a+=`${n[1].map(s=>s)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,n)=>{const s=f("Checkbox"),e=f("Button");return a.purchaseInvoiceStatus?(y(),$("form",ae,[d("div",se,[u(B,{name:"name",class:w(["mb-2",{"p-invalid":o.value.errors.name}]),label:"Nom de l'estat",id:"name",modelValue:a.purchaseInvoiceStatus.name,"onUpdate:modelValue":n[0]||(n[0]=t=>a.purchaseInvoiceStatus.name=t)},null,8,["modelValue","class"]),u(B,{name:"description",class:w(["mb-2",{"p-invalid":o.value.errors.description}]),label:"Descripció",id:"description",modelValue:a.purchaseInvoiceStatus.description,"onUpdate:modelValue":n[1]||(n[1]=t=>a.purchaseInvoiceStatus.description=t)},null,8,["modelValue","class"]),d("div",null,[oe,u(s,{modelValue:a.purchaseInvoiceStatus.disabled,"onUpdate:modelValue":n[2]||(n[2]=t=>a.purchaseInvoiceStatus.disabled=t),class:"w-full",binary:!0},null,8,["modelValue"])])]),d("div",ne,[u(e,{label:"Guardar",class:"mr-2",onClick:i})])])):g("",!0)}}}),ce=d("br",null,null,-1),ke=C({__name:"PurchaseInvoiceStatus",setup(m){const p=P(T.EDIT),c=M(),I=L(),r=N(),{purchaseInvoiceStatus:o}=D(r),S=async()=>{await r.fetchPurchaseInvoiceStatus(c.params.id);let e="";o.value?(p.value=T.EDIT,e=`Estat de factura: ${o.value.name}`):(p.value=T.CREATE,r.setNewPurchaseInvoiceStatus(c.params.id),e="Alta d'estat de factura'"),I.setMenuItem({icon:V.POUND,backButtonVisible:!0,text:e})};R(async()=>{await S()});const i=q(),a=async()=>{const e=o.value;let t=!1,l="";p.value===T.CREATE?(t=await r.createPurchaseInvoiceStatus(e),l="Estat de factura creat correctament"):(t=await r.updatePurchaseInvoiceStatus(e.id,e),l="Estat de factura actualitzat correctament"),t&&(i.add({severity:"success",summary:l,life:5e3}),O.back())},n=async e=>{console.log(e),await r.createPurchaseInvoiceStatusTransition(e)||i.add({severity:"error",detail:"Error al crear la transició"})},s=async e=>{await r.deletePurchaseInvoiceStatusTransition(e)||i.add({severity:"error",detail:"Error al eliminar la transició"})};return(e,t)=>(y(),$(z,null,[_(o)?(y(),F(re,{key:0,purchaseInvoiceStatus:_(o),onSubmit:a},null,8,["purchaseInvoiceStatus"])):g("",!0),ce,u(te,{purchaseInvoiceStatus:_(o),onAdd:n,onDelete:s},null,8,["purchaseInvoiceStatus"])],64))}});export{ke as default};
