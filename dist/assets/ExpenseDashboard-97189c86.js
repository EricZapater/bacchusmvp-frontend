import{_ as G}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-eb6a562c.js";import{d as O,h,a as g,m as E,w as u,i as o,e as t,D as S,k as p,u as H,r as c,o as U,P as b,J as j,c as W,n as w,C as z,G as J,p as K,b as Q,L as I,l as A,f as Y}from"./index-2e8f6a24.js";import{u as Z}from"./masterData-df5927e6.js";import{_ as q}from"./lodash-16e64dd2.js";import{f as X,a as B}from"./functions-13b40d42.js";import{E as L}from"./index-eb231e5d.js";import"./index-dcc0abe4.js";import"./base.service-b9981b5f.js";import"./v4-a960c1f4.js";import"./suppliers.service-e3eff5a8.js";const ee=O({__name:"TableConsolidatedExpenses",props:{expenses:{}},setup(_){const m=_;return(D,x)=>{const a=h("Column"),C=h("DataTable");return g(),E(C,{value:m.expenses,tableStyle:"min-width: 100%"},{default:u(()=>[o(a,{field:"type",header:"Tipus de despesa",style:{width:"10%"}}),o(a,{field:"typeDetail",header:"Detall",style:{width:"15%"}}),o(a,{field:"paymentDate",header:"Data pagament",sortable:"",style:{width:"10%"}},{body:u(n=>[t("span",null,S(p(X)(n.data.paymentDate)),1)]),_:1}),o(a,{field:"amount",header:"Import",style:{width:"10%"}},{body:u(n=>[t("span",null,S(n.data.amount)+" €",1)]),_:1}),o(a,{field:"description",header:"Descripció",style:{width:"30%"}})]),_:1},8,["value"])}}}),y=_=>(K("data-v-e8b7c087"),_=_(),Q(),_),te={class:"dashboard-filter"},ae={class:"dashboard-filter-field"},se={class:"dashboard-filter-field"},oe=y(()=>t("label",null,"Tipus",-1)),le={class:"dashboard-filter-field"},ne=y(()=>t("label",null,"Detall",-1)),re={class:"dashboard-filter-field"},de={class:"block text-900"},ie=y(()=>t("span",null,"Gràfics",-1)),ce={class:"dashboard-container"},pe={class:"dashboard-item"},ue=y(()=>t("header",{class:"dashboard-item-header"}," Agrupat despeses mensual ",-1)),me={class:"dashboard-item-chart"},_e={class:"dashboard-item"},he=y(()=>t("header",{class:"dashboard-item-header"}," Gràfic de despeses per tipologia ",-1)),ye={class:"dashboard-item-chart"},ve=y(()=>t("span",null,"Llistat",-1)),be=O({__name:"ExpenseDashboard",setup(_){const m=H(),D=Z(),x=c(0),a=c({dates:void 0,type:"",typeDetail:""}),C=c(void 0),n=c([]),R=()=>{m.cleanExercisePicker(),a.value.type="",a.value.typeDetail=""};U(async()=>{m.setMenuItem({icon:b.MONEY_BILL,title:"Dashboard despeses"}),await D.fetchMasterData(),C.value=await L.ExpenseType.getAll()});const f=c(void 0),F=c({plugins:{legend:{labels:{usePointStyle:!0}}}}),T=c(void 0),N=c({scales:{y:{beginAtZero:!0}}}),$=j(()=>{let d=0;return n.value.length>0&&n.value.forEach(e=>d+=e.amount),d}),V=async d=>{if(m.exercisePicker.dates){const e=B(m.exercisePicker.dates[0]),s=B(m.exercisePicker.dates[1]);d&&(a.value.typeDetail="");const l=await L.Expense.getConsolidated(e,s,a.value.type,a.value.typeDetail);l&&(n.value=l),T.value=k(n.value,"monthPaymentKey"),f.value=k(n.value,"typeDetail")}},k=(d,e)=>{const s={},l=q.groupBy(d,e);s.labels=Object.keys(l);const i=M(s.labels.length);return s.datasets=[{label:"Despeses",data:[],backgroundColor:i,borderColor:i,borderWidth:1}],Object.keys(l).forEach(P=>{let v=0;l[P].forEach(r=>{v+=r.amount}),s.datasets[0].data.push(v)}),s},M=d=>{const e=getComputedStyle(document.body),s=[e.getPropertyValue("--blue-400"),e.getPropertyValue("--green-400"),e.getPropertyValue("--yellow-400"),e.getPropertyValue("--cyan-400"),e.getPropertyValue("--pink-400"),e.getPropertyValue("--indigo-400"),e.getPropertyValue("--orange-400"),e.getPropertyValue("--purple-400"),e.getPropertyValue("--red-400")],l=[];for(;l.length<d;)for(let i=0;i<s.length;i++)l.push(s[i]);return l};return(d,e)=>{var v;const s=h("Dropdown"),l=h("Button"),i=h("TabPanel"),P=h("TabView");return g(),W(J,null,[t("div",te,[t("div",ae,[o(G,{exercises:p(D).exercises,onRangeSelected:e[0]||(e[0]=r=>V(!1))},null,8,["exercises"])]),t("div",se,[oe,o(s,{options:["Despesa","Compra"],modelValue:a.value.type,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.type=r),onChange:e[2]||(e[2]=r=>V(!0))},null,8,["modelValue"])]),t("div",le,[ne,o(s,{options:(v=f.value)==null?void 0:v.labels,modelValue:a.value.typeDetail,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.typeDetail=r),onChange:e[4]||(e[4]=r=>V(!1))},null,8,["options","modelValue"])]),t("div",re,[t("label",de,[t("i",{class:w(p(b).WALLET)},null,2),z("   Total despesa "),t("b",null,S($.value.toFixed(2))+" € ",1)])]),o(l,{class:"grid_add_row_button",icon:p(b).FILTER_SLASH,onClick:R},null,8,["icon"])]),o(P,{activeIndex:x.value,"onUpdate:activeIndex":e[5]||(e[5]=r=>x.value=r)},{default:u(()=>[o(i,null,{header:u(()=>[t("i",{class:w([p(b).CHART_BAR,"mr-2"])},null,2),ie]),default:u(()=>[t("div",ce,[t("section",pe,[ue,t("div",me,[T.value?(g(),E(p(I),{key:0,type:"bar",data:T.value,options:N.value},null,8,["data","options"])):A("",!0)])]),t("section",_e,[he,t("div",ye,[f.value?(g(),E(p(I),{key:0,type:"pie",data:f.value,options:F.value},null,8,["data","options"])):A("",!0)])])])]),_:1}),o(i,null,{header:u(()=>[t("i",{class:w([p(b).LIST,"mr-2"])},null,2),ve]),default:u(()=>[o(ee,{scrollable:"",scrollHeight:"75vh",expenses:n.value},null,8,["expenses"])]),_:1})]),_:1},8,["activeIndex"])],64)}}});const Se=Y(be,[["__scopeId","data-v-e8b7c087"]]);export{Se as default};
