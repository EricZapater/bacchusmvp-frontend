import{_ as oe}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-e9f85766.js";import{d as B,x as F,h as y,a as C,m as D,w as h,e as l,i as a,k as r,P as S,C as O,D as L,B as W,n as P,j as x,r as T,c as $,s as V,y as w,l as M,v as ie,g as ne,u as re,z as de,E as me,o as ue,F as g,G as ce}from"./index-5e079de4.js";import{g as j}from"./functions-4d7ada1d.js";import{u as A}from"./plantmodel-b5c92e3c.js";import{u as G}from"./workmaster-86503d77.js";import{c as z,d as U,F as H,a as pe}from"./form-validator-f8953ae6.js";import{u as q}from"./reference-04677b7a.js";import{_ as be}from"./DropdownReference.vue_vue_type_script_setup_true_lang-38920d2f.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./index-807fa16d.js";import"./base.service-4c53d7ae.js";import"./reference.service-7ecaa2ca.js";const fe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},he=l("span",{class:"text-xl text-900 font-bold"},"Pasos de fabricació",-1),ve=["onClick"],ye=B({__name:"TableWorkmasterPhaseDetails",props:{workmasterPhase:{},details:{}},emits:["add","edit","delete"],setup(E,{emit:f}){const v=E,I=F();G();const _=A(),m=t=>{var u;if(!_.machineStatuses)return"";const s=(u=_.machineStatuses)==null?void 0:u.find(d=>t===d.id);return s?s.name:""},c=()=>{const t={id:j(),workMasterPhaseId:v.workmasterPhase.id,estimatedTime:0,isCycleTime:!1,isExternalWork:!1,externalWorkCost:0,machineStatusId:"",comment:"",order:p()};f("add",t)},p=()=>{let t=10;return v.details?(v.details.length+1)*10:t},o=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||f("edit",t.data)},e=(t,s)=>{I.require({target:t.currentTarget,message:"Está segur que vol eliminar el pas de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{f("delete",s)}})};return(t,s)=>{const u=y("Button"),d=y("Column"),n=y("DataTable");return C(),D(n,{onRowClick:o,value:t.details,tableStyle:"min-width: 100%","sort-field":"order","sort-order":1},{header:h(()=>[l("div",fe,[he,a(u,{icon:r(S).PLUS,rounded:"",raised:"",onClick:c},null,8,["icon"])])]),default:h(()=>[a(d,{sortable:"",field:"order",header:"Ordre",style:{width:"10%"}}),a(d,{header:"Estat de màquina",style:{width:"25%"}},{body:h(b=>[O(L(m(b.data.machineStatusId)),1)]),_:1}),a(d,{field:"estimatedTime",header:"Temps (min)",style:{width:"25%"}}),a(d,{header:"Temps de cicle",style:{width:"25%"}},{body:h(b=>[a(W,{value:b.data.isCycleTime},null,8,["value"])]),_:1}),a(d,{header:"Extern",style:{width:"25%"}},{body:h(b=>[a(W,{value:b.data.isExternalWork},null,8,["value"])]),_:1}),a(d,{style:{width:"25%"}},{body:h(b=>[l("i",{class:P([r(S).TIMES,"grid_delete_column_button"]),onClick:N=>e(N,b.data)},null,10,ve)]),_:1})]),_:1},8,["value"])}}}),_e={key:0},Ie={class:"three-columns"},ke=l("label",{class:"block text-900 mt-1 mb-1"},"Extern",-1),we={class:"three-columns mt-3"},ge=l("label",{class:"block text-900 mb-2"},"Estat",-1),Ve=l("label",{class:"block text-900v mb-1"},"Temps de cicle",-1),Ce={class:"mt-3"},Ee=l("br",null,null,-1),Te=B({__name:"FormWorkmasterPhaseDetail",props:{detail:{}},emits:["submit","cancel"],setup(E,{emit:f}){const v=E,I=A(),_=x(),m=z().shape({order:U().required("L'ordre és obligatori").positive("L'ordre ha de ser positiu"),estimatedTime:U().required("El temps estimat és obligatori"),externalWorkCost:U().required("El cost extern és obligatori")}),c=T({result:!1,errors:{}}),p=()=>{const e=new H(m);c.value=e.validate(v.detail)},o=async()=>{if(p(),c.value.result)f("submit",v.detail);else{let e="";Object.entries(c.value.errors).forEach(t=>{e+=`${t[1].map(s=>s)}.   `}),_.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const s=y("Checkbox"),u=y("Dropdown"),d=y("Button");return e.detail?(C(),$("form",_e,[l("section",Ie,[l("div",null,[a(w,{type:r(V).NUMERIC,label:"Ordre",modelValue:e.detail.order,"onUpdate:modelValue":t[0]||(t[0]=n=>e.detail.order=n),class:P({"p-invalid":c.value.errors.order})},null,8,["type","modelValue","class"])]),l("div",null,[ke,a(s,{modelValue:e.detail.isExternalWork,"onUpdate:modelValue":t[1]||(t[1]=n=>e.detail.isExternalWork=n),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[a(w,{type:r(V).CURRENCY,label:"Cost extern",modelValue:e.detail.externalWorkCost,"onUpdate:modelValue":t[2]||(t[2]=n=>e.detail.externalWorkCost=n),disabled:!e.detail.isExternalWork,class:P({"p-invalid":c.value.errors.externalWorkCost})},null,8,["type","modelValue","disabled","class"])])]),l("section",we,[l("div",null,[ge,a(u,{modelValue:e.detail.machineStatusId,"onUpdate:modelValue":t[3]||(t[3]=n=>e.detail.machineStatusId=n),editable:"",options:r(I).machineStatuses,optionValue:"id",optionLabel:"description",class:P(["w-full",{"p-invalid":c.value.errors.machineStatusId}])},null,8,["modelValue","options","class"])]),l("div",null,[Ve,a(s,{modelValue:e.detail.isCycleTime,"onUpdate:modelValue":t[4]||(t[4]=n=>e.detail.isCycleTime=n),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[a(w,{type:r(V).NUMERIC,decimals:2,label:"Temps estimat (min)",modelValue:e.detail.estimatedTime,"onUpdate:modelValue":t[5]||(t[5]=n=>e.detail.estimatedTime=n),class:P({"p-invalid":c.value.errors.estimatedTime})},null,8,["type","modelValue","class"])])]),l("div",Ce,[a(w,{label:"Comentari fabricació",modelValue:e.detail.comment,"onUpdate:modelValue":t[6]||(t[6]=n=>e.detail.comment=n)},null,8,["modelValue"])]),Ee,l("div",null,[a(d,{label:"Guardar pas",style:{float:"right"},size:"small",onClick:o})])])):M("",!0)}}}),Pe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Me=l("span",{class:"text-xl text-900 font-bold"},"Materials de fabricació",-1),De=["onClick"],Se=B({__name:"TableWorkmasterPhaseBillOfMaterials",props:{workmasterPhase:{},billOfMaterials:{}},emits:["add","edit","delete"],setup(E,{emit:f}){const v=E,I=F(),_=q(),m=e=>{var s;if(!_.references)return"";const t=(s=_.references)==null?void 0:s.find(u=>e===u.id);return t?_.getFullName(t):""},c=()=>{const e={id:j(),workMasterPhaseId:v.workmasterPhase.id,referenceId:"",quantity:0,width:0,diameter:0,height:0,length:0,thickness:0};f("add",e)},p=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||f("edit",e.data)},o=(e,t)=>{I.require({target:e.currentTarget,message:"Está segur que vol eliminar el material de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{f("delete",t)}})};return(e,t)=>{const s=y("Button"),u=y("Column"),d=y("DataTable");return C(),D(d,{onRowClick:p,value:e.billOfMaterials,tableStyle:"min-width: 100%"},{header:h(()=>[l("div",Pe,[Me,a(s,{icon:r(S).PLUS,rounded:"",raised:"",onClick:c},null,8,["icon"])])]),default:h(()=>[a(u,{header:"Material consum",style:{width:"30%"}},{body:h(n=>[O(L(m(n.data.referenceId)),1)]),_:1}),a(u,{field:"quantity",header:"Consum",style:{width:"15%"}}),a(u,{field:"width",header:"Ample (x) mm",style:{width:"12%"}}),a(u,{field:"length",header:"Llarg (y) mm",style:{width:"12%"}}),a(u,{field:"height",header:"Alt (z) mm",style:{width:"12%"}}),a(u,{field:"diameter",header:"Diàmetre mm",style:{width:"12%"}}),a(u,{field:"thickness",header:"Gruix mm",style:{width:"12%"}}),a(u,{style:{width:"10%"}},{body:h(n=>[l("i",{class:P([r(S).TIMES,"grid_delete_column_button"]),onClick:b=>o(b,n.data)},null,10,De)]),_:1})]),_:1},8,["value"])}}}),Be={key:0},Re={class:"three-columns"},Ue={class:"three-columns"},$e={class:"mt-2"},Ne={class:"mt-2"},Ae={class:"mt-2"},qe=l("br",null,null,-1),We=B({__name:"FormWorkmasterPhaseBomItem",props:{bomItem:{}},emits:["submit","cancel"],setup(E,{emit:f}){const v=E;q();const I=x(),_=z().shape({referenceId:pe().required("El material de consum és obligatori"),quantity:U().min(1,"La quantitat a consumir ha de ser positiva").required("La quantitat a consumir és obligatoria")}),m=T({result:!1,errors:{}}),c=()=>{const o=new H(_);m.value=o.validate(v.bomItem)},p=async()=>{if(c(),m.value.result)f("submit",v.bomItem);else{let o="";Object.entries(m.value.errors).forEach(e=>{o+=`${e[1].map(t=>t)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const t=y("Button");return o.bomItem?(C(),$("form",Be,[l("div",null,[a(be,{label:"Material",fullName:!0,modelValue:o.bomItem.referenceId,"onUpdate:modelValue":e[0]||(e[0]=s=>o.bomItem.referenceId=s),class:P({"p-invalid":m.value.errors.referenceId})},null,8,["modelValue","class"])]),l("section",Re,[l("div",null,[a(w,{type:r(V).NUMERIC,label:"Quantitat",modelValue:o.bomItem.quantity,"onUpdate:modelValue":e[1]||(e[1]=s=>o.bomItem.quantity=s)},null,8,["type","modelValue"])]),l("div",null,[a(w,{type:r(V).NUMERIC,label:"Amplada (mm)",decimals:2,modelValue:o.bomItem.width,"onUpdate:modelValue":e[2]||(e[2]=s=>o.bomItem.width=s)},null,8,["type","modelValue"])]),l("div",null,[a(w,{type:r(V).NUMERIC,decimals:2,label:"Alçada (mm)",modelValue:o.bomItem.height,"onUpdate:modelValue":e[3]||(e[3]=s=>o.bomItem.height=s)},null,8,["type","modelValue"])])]),l("section",Ue,[l("div",$e,[a(w,{type:r(V).NUMERIC,decimals:2,label:"Longitud (mm)",modelValue:o.bomItem.length,"onUpdate:modelValue":e[4]||(e[4]=s=>o.bomItem.length=s)},null,8,["type","modelValue"])]),l("div",Ne,[a(w,{type:r(V).NUMERIC,decimals:2,label:"Diàmetre (mm)",modelValue:o.bomItem.diameter,"onUpdate:modelValue":e[5]||(e[5]=s=>o.bomItem.diameter=s)},null,8,["type","modelValue"])]),l("div",Ae,[a(w,{type:r(V).NUMERIC,decimals:2,label:"Gruix (mm)",modelValue:o.bomItem.thickness,"onUpdate:modelValue":e[6]||(e[6]=s=>o.bomItem.thickness=s)},null,8,["type","modelValue"])])]),qe,l("div",null,[a(t,{label:"Guardar material",style:{float:"right"},size:"small",onClick:p})])])):M("",!0)}}}),Fe={key:0,class:"main"},et=B({__name:"WorkmasterPhase",setup(E){const f=ie();ne();const v=re(),I=q(),_=A(),m=G(),{workmaster:c,workmasterPhase:p}=de(m),o=T(""),e=T(""),t=me({visible:!1,title:"Linea",closable:!0,position:"center",modal:!0});ue(async()=>{o.value=f.params.id,e.value=f.params.phaseid,await s();let i="";i="Ruta de fabricació",c.value&&p.value&&(i=`${i} ${I.getFullName(c.value.reference)} - Fase ${p.value.phaseCode}`),v.setMenuItem({icon:S.BUILDING,backButtonVisible:!0,title:i}),I.fetchReferencesByModule("purchase"),_.fetchActiveModel()});const s=async()=>{await m.fetchPhaseById(e.value)},u=async i=>{await m.updatePhase(e.value,i)},d=T(g.CREATE),n=T(void 0),b=T(void 0),N=()=>{n.value=void 0,b.value=void 0},Q=i=>{d.value=g.CREATE,n.value=i,t.title="Afegir pas de fabricació",t.visible=!0},Y=i=>{d.value=g.EDIT,n.value=i,t.title="Modificar pas de fabricació",t.visible=!0},J=i=>{m.deletePhaseDetail(i.id)},K=async i=>{let k;d.value===g.CREATE?k=m.createPhaseDetail(i):d.value===g.EDIT&&(k=m.updatePhaseDetail(i.id,i)),await k&&(t.visible=!1)},X=i=>{d.value=g.CREATE,b.value=i,t.title="Afegir material",t.visible=!0},Z=i=>{d.value=g.EDIT,b.value=i,t.title="Modificar material",t.visible=!0},ee=i=>{m.deletePhaseBomItem(i.id)},te=async i=>{let k;d.value===g.CREATE?k=m.createPhaseBomItem(i):d.value===g.EDIT&&(k=m.updatePhaseBomItem(i.id,i)),await k&&(t.visible=!1)};return(i,k)=>{const R=y("TabPanel"),ae=y("TabView"),le=y("Dialog");return C(),$(ce,null,[l("header",null,[r(c)&&r(p)?(C(),D(oe,{key:0,workmaster:r(c),phase:r(p),onSubmit:u},null,8,["workmaster","phase"])):M("",!0)]),r(p)?(C(),$("main",Fe,[a(ae,null,{default:h(()=>[a(R,{header:"Pasos"},{default:h(()=>[a(ye,{workmasterPhase:r(p),details:r(p).details,onAdd:Q,onEdit:Y,onDelete:J},null,8,["workmasterPhase","details"])]),_:1}),a(R,{header:"Materials"},{default:h(()=>[a(Se,{workmasterPhase:r(p),billOfMaterials:r(p).billOfMaterials,onAdd:X,onEdit:Z,onDelete:ee},null,8,["workmasterPhase","billOfMaterials"])]),_:1})]),_:1}),a(le,{visible:t.visible,"onUpdate:visible":k[0]||(k[0]=se=>t.visible=se),header:t.title,closable:t.closable,modal:t.modal,onHide:N},{default:h(()=>[n.value?(C(),D(Te,{key:0,detail:n.value,onSubmit:K},null,8,["detail"])):M("",!0),b.value?(C(),D(We,{key:1,bomItem:b.value,onSubmit:te},null,8,["bomItem"])):M("",!0)]),_:1},8,["visible","header","closable","modal"])])):M("",!0)],64)}}});export{et as default};
