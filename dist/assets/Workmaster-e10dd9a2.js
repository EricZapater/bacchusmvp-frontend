import{c as P,d as R,a as S,F as M}from"./form-validator-9d0a56f8.js";import{d as V,j as x,r as $,h as f,c as g,e as r,i as c,w as v,k as l,n as B,y as W,l as y,a as k,D as F,s as N,x as T,m as C,P as I,v as E,g as U,u as q,z as L,o as j,G as Q,f as z}from"./index-357c9d4c.js";import{u as D}from"./reference-35a8c4f2.js";import{g as G}from"./functions-afe9fe15.js";import{u as O}from"./workmaster-137f1d0f.js";import"./reference.service-387fdae1.js";import"./base.service-d0780977.js";import"./v4-a960c1f4.js";import"./index-6fe49fa3.js";const A={key:0},H=r("br",null,null,-1),J={class:"three-columns"},K=r("label",{class:"block text-900 mb-2"},"Referència",-1),X={key:0,class:"flex align-items-center"},Y=r("label",{class:"block text-900 mb-2"},"Desactivat",-1),Z=V({__name:"FormWorkmaster",props:{workmaster:{}},emits:["submit","cancel"],setup(b,{emit:d}){const u=b,w=x(),m=D(),i=P().shape({baseQuantity:R().min(1).required("La quantitat base ha de ser superior a 1"),referenceId:S().required("La referència és obligatoria")}),s=$({result:!1,errors:{}}),t=()=>{const a=new M(i);s.value=a.validate(u.workmaster)},p=async()=>{if(t(),s.value.result)d("submit",u.workmaster);else{let a="";Object.entries(s.value.errors).forEach(o=>{a+=`${o[1].map(_=>_)}.   `}),w.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,o)=>{const _=f("Button"),h=f("Dropdown"),e=f("Checkbox");return a.workmaster?(k(),g("form",A,[r("div",null,[c(_,{label:"Guardar Ruta",class:"grid_add_row_button",size:"small",onClick:p}),H]),r("section",J,[r("div",null,[K,c(h,{modelValue:a.workmaster.referenceId,"onUpdate:modelValue":o[0]||(o[0]=n=>a.workmaster.referenceId=n),editable:"",options:l(m).references,optionValue:"id",optionLabel:"description",class:B(["w-full",{"p-invalid":s.value.errors.referenceId}])},{option:v(n=>[n.option?(k(),g("div",X,F(l(m).getFullName(n.option)),1)):y("",!0)]),_:1},8,["modelValue","options","class"])]),r("div",null,[c(W,{type:l(N).NUMERIC,label:"Quantitat Base",decimals:2,modelValue:a.workmaster.baseQuantity,"onUpdate:modelValue":o[1]||(o[1]=n=>a.workmaster.baseQuantity=n)},null,8,["type","modelValue"])]),r("div",null,[Y,c(e,{modelValue:a.workmaster.disabled,"onUpdate:modelValue":o[2]||(o[2]=n=>a.workmaster.disabled=n),class:"w-full",binary:!0},null,8,["modelValue"])])])])):y("",!0)}}}),ee={class:"flex flex-wrap align-items-center justify-content-between gap-2"},te=r("span",{class:"text-xl text-900 font-bold"},"Fases de la ruta",-1),ae=["onClick"],se=V({__name:"TableWorkmasterPhases",props:{workmaster:{},workmasterPhases:{}},emits:["add","edit","delete"],setup(b,{emit:d}){const u=b,w=T(),m=()=>{const t={id:G(),workMasterId:u.workmaster.id,disabled:!1,phaseCode:"",phaseDescription:"",workmasterPhaseDetails:[],workmasterPhaseBillOfMaterials:[]};d("add",t)},i=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||d("edit",t.data)},s=(t,p)=>{w.require({target:t.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{d("delete",p)}})};return(t,p)=>{const a=f("Button"),o=f("Column"),_=f("DataTable");return k(),C(_,{onRowClick:i,value:t.workmasterPhases,tableStyle:"min-width: 100%"},{header:v(()=>[r("div",ee,[te,c(a,{icon:l(I).PLUS,rounded:"",raised:"",onClick:m},null,8,["icon"])])]),default:v(()=>[c(o,{field:"phaseCode",header:"Codi",style:{width:"25%"}}),c(o,{field:"phaseDescription",header:"Descripció",style:{width:"65%"}}),c(o,{style:{width:"10%"}},{body:v(h=>[r("i",{class:B([l(I).TIMES,"grid_delete_column_button"]),onClick:e=>s(e,h.data)},null,10,ae)]),_:1})]),_:1},8,["value"])}}}),oe={class:"main"},re=V({__name:"Workmaster",setup(b){const d=E(),u=U(),w=q(),m=D(),i=O(),{workmaster:s}=L(i),t=$("");j(async()=>{t.value=d.params.id,await p();let e="";e="Ruta de fabricació",s.value&&(e=`${e} ${m.getFullName(s.value.reference)}`),w.setMenuItem({icon:I.BUILDING,backButtonVisible:!0,title:e})});const p=async()=>{await m.fetchReferencesByModule("sales"),await i.fetchOne(t.value)},a=async e=>{await i.update(t.value,e)&&await p()},o=async e=>{await i.createPhase(e)&&u.push({path:`/workmaster/${t.value}/phase/${e.id}`})},_=e=>{u.push({path:`/workmaster/${t.value}/phase/${e.id}`})},h=async e=>{await i.deletePhase(e.id)};return(e,n)=>(k(),g(Q,null,[r("header",null,[l(s)?(k(),C(Z,{key:0,workmaster:l(s),onSubmit:a},null,8,["workmaster"])):y("",!0)]),r("main",oe,[l(s)&&l(s).phases?(k(),C(se,{key:0,workmaster:l(s),workmasterPhases:l(s).phases,onAdd:o,onEdit:_,onDelete:h},null,8,["workmaster","workmasterPhases"])):y("",!0)])],64))}});const fe=z(re,[["__scopeId","data-v-c8146846"]]);export{fe as default};
