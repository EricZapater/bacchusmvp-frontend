import{b as X,u as Z}from"./vue-router-ffe4063c.js";import{o as g,c as P,e as o,r as B,m as N,j as R,k as z,M as G,f as x,h as n,w as k,t as L,l as a,P as S,F as ee,p as te,n as V,d as U,ax as W,a as Y,a0 as ae,u as oe}from"./index-a2430148.js";import{F as se,a as H,u as J}from"./purchaseInvoices-52275d21.js";import{u as O}from"./usetoast.esm-261cff49.js";import{B as T,F as M}from"./component-c8ee66ae.js";import{s as le,B as $}from"./BaseInput-2edd0472.js";import{c as ne,a as q,F as ie}from"./form-validator-1a569dfe.js";import{c as re,f as ue}from"./functions-028ffd6d.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";import"./exercise.service-ceab6cec.js";import"./base.service-ac28cfab.js";import"./paymentmethod.service-65f61ad5.js";import"./tax.service-be95229b.js";import"./index-87fd5a83.js";import"./suppliers.service-1deeab6b.js";import"./runtime-dom.esm-bundler-ee5f76e0.js";var K={name:"Toolbar",extends:le,props:{"aria-labelledby":{type:String,default:null}}};const ce=["aria-labelledby"];function me(u,p,_,c,l,e){return g(),P("div",N({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":u.ariaLabelledby},u.ptm("root")),[o("div",N({class:"p-toolbar-group-start p-toolbar-group-left"},u.ptm("start")),[B(u.$slots,"start")],16),o("div",N({class:"p-toolbar-group-center"},u.ptm("center")),[B(u.$slots,"center")],16),o("div",N({class:"p-toolbar-group-end p-toolbar-group-right"},u.ptm("end")),[B(u.$slots,"end")],16)],16,ce)}function pe(u,p){p===void 0&&(p={});var _=p.insertAt;if(!(!u||typeof document>"u")){var c=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",_==="top"&&c.firstChild?c.insertBefore(l,c.firstChild):c.appendChild(l),l.styleSheet?l.styleSheet.cssText=u:l.appendChild(document.createTextNode(u))}}var ve=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;pe(ve);K.render=me;const be={class:"base_input"},fe={class:"file-viewer"},ye={class:"file-viewer-item-type"},Ie={class:"file-viewer-item-actions"},_e=["onClick"],he=["onClick"],Ve=R({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(u){const p=u,_=O(),c=new se,l=z(void 0),e=async()=>{l.value=await c.GetEntityFiles(p.entity,p.id)};G(async()=>{await e()});const w=async()=>{const v=document.createElement("input");v.type="file",v.onchange=async I=>{const F=I.target.files[0];if(!await c.Upload(F,p.entity,p.id)){_.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await e()},v.click()},m=async v=>{const I=await c.Download(v);re(v.originalName,I)},f=async v=>{var I=await c.Delete(v.id);if(!I){_.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await e()};return(v,I)=>{const F=x("Button");return g(),P("div",be,[n(a(K),null,{start:k(()=>[o("h4",null,L(v.title),1)]),end:k(()=>[n(F,{size:"small",rounded:"",icon:a(S).UPLOAD,onClick:w},null,8,["icon"])]),_:1}),o("section",fe,[(g(!0),P(ee,null,te(l.value,i=>(g(),P("article",{class:"file-viewer-item",key:v.id},[o("div",ye,[i.type===0?(g(),P("i",{key:0,class:V(a(S).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):U("",!0),i.type===1?(g(),P("i",{key:1,class:V(a(S).IMAGE),style:{"font-size":"3.5rem"}},null,2)):U("",!0),o("p",null,L(i.originalName.substring(0,20)),1)]),o("div",Ie,[o("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:b=>m(i)},[o("i",{class:V(a(S).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,_e),o("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:b=>f(i)},[o("i",{class:V(a(S).TIMES)},null,2)],8,he)])]))),128))])])}}});const we=de(Ve,[["__scopeId","data-v-dd7a228d"]]),De={key:0},ge={class:"four-columns"},xe=o("label",{class:"block text-900 mb-2"},"Exercici",-1),Fe=o("label",{class:"block text-900 mb-2"},"Sèrie",-1),Ae=o("label",{class:"block text-900 mb-2"},"Estat",-1),Pe={class:"three-columns"},ke={class:"mt-2"},Ce=o("label",{class:"block text-900 mb-2"},"Proveïdor",-1),Ee={class:"mt-2"},$e={class:"mt-2"},Se=o("label",{class:"block text-900 mb-2"},"Data Factura: ",-1),Ne={class:"four-columns"},Te={class:"mt-2"},Me={class:"mt-2"},Ue={class:"mt-2"},Be=o("label",{class:"block text-900 mb-2"},"IVA",-1),Le={class:"mt-2"},Re={class:"two-columns"},ze={class:"mt-2"},Ge=o("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),Oe={class:"mt-2"},je={class:"mt-3"},qe=R({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(u,{emit:p}){const _=u,c=H(),l=J(),{purchaseInvoice:e}=W(c),w=O(),m=ne().shape({exerciceId:q().required("L'exercici es obligatori"),supplierId:q().required("El proveïdor es obligatori")}),f=z({result:!1,errors:{}}),v=()=>{const r=new ie(m);f.value=r.validate(_.purchaseInvoice)};let I=!1;G(()=>{setTimeout(()=>I=!0,1e3)});const F=async()=>{if(v(),f.value.result)p("submit",e.value);else{let r="";Object.entries(f.value.errors).forEach(t=>{r+=`${t[1].map(d=>d)}.   `}),w.add({severity:"warn",summary:"Formulari inválid",detail:r,life:5e3})}},i=()=>{var t;const r=(t=l.masterData.suppliers)==null?void 0:t.find(d=>{var h;return(h=e.value)==null?void 0:h.supplierId});r&&(e.value.paymentMethodId=r.paymentMethodId)},b=async()=>{var s;if(!I)return;var r=(s=l.masterData.taxes)==null?void 0:s.find(Q=>{var j;return Q.id===((j=e.value)==null?void 0:j.taxId)});let t=0,d=0,h=0,D=0,A=0,y=0,C=0,E=0;e.value&&(e.value.baseAmount&&(t=parseFloat(e.value.baseAmount.toFixed(2))),e.value.transportAmount&&(d=parseFloat(e.value.transportAmount.toFixed(2))),e.value.discountPercentage&&(C=parseFloat(e.value.discountPercentage.toFixed(2))),r&&(h=parseFloat(r.percentatge.toFixed(2)))),D=(t*1+d*1)*(h/100),E=t*1+d*1+D*1,y=E*(1*C)/100,A=E-y,e.value.baseAmount=t,e.value.transportAmount=d,e.value.taxAmount=D,e.value.grossAmount=E,e.value.netAmount=A,e.value.discountPercentage=C,e.value.discountAmount=y,e.value.purchaseInvoiceDueDates=await c.GetDueDates(e.value)};return(r,t)=>{const d=x("Dropdown"),h=x("Calendar"),D=x("Column"),A=x("DataTable"),y=x("Button"),C=x("TabPanel"),E=x("TabView");return g(),Y(E,null,{default:k(()=>[n(C,{header:"Factura"},{default:k(()=>[a(e)?(g(),P("form",De,[o("section",ge,[n($,{label:"Num. Fra. Intern",id:"number",modelValue:a(e).number,"onUpdate:modelValue":t[0]||(t[0]=s=>a(e).number=s),disabled:""},null,8,["modelValue"]),o("div",null,[xe,n(d,{modelValue:a(e).exerciceId,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).exerciceId=s),editable:"",options:a(l).masterData.exercises,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),o("div",null,[Fe,n(d,{modelValue:a(e).purchaseInvoiceSerieId,"onUpdate:modelValue":t[2]||(t[2]=s=>a(e).purchaseInvoiceSerieId=s),editable:"",options:a(l).masterData.series,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),o("div",null,[Ae,n(d,{modelValue:a(e).purchaseInvoiceStatusId,"onUpdate:modelValue":t[3]||(t[3]=s=>a(e).purchaseInvoiceStatusId=s),editable:"",options:a(l).masterData.statuses,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),o("section",Pe,[o("div",ke,[Ce,n(d,{modelValue:a(e).supplierId,"onUpdate:modelValue":t[4]||(t[4]=s=>a(e).supplierId=s),editable:"",options:a(l).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",onChange:i,class:V(["w-full",{"p-invalid":f.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),o("div",Ee,[n($,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:a(e).supplierNumber,"onUpdate:modelValue":t[5]||(t[5]=s=>a(e).supplierNumber=s)},null,8,["modelValue"])]),o("div",$e,[Se,n(h,{id:"purchaseInvoiceDate",modelValue:a(e).purchaseInvoiceDate,"onUpdate:modelValue":t[6]||(t[6]=s=>a(e).purchaseInvoiceDate=s)},null,8,["modelValue"])])]),o("section",Ne,[o("div",Te,[n($,{type:a(T).NUMERIC,label:"Base",id:"baseAmount",modelValue:a(e).baseAmount,"onUpdate:modelValue":[t[7]||(t[7]=s=>a(e).baseAmount=s),t[8]||(t[8]=s=>b())]},null,8,["type","modelValue"])]),o("div",Me,[n($,{type:a(T).NUMERIC,label:"Ports",id:"transportAmount",modelValue:a(e).transportAmount,"onUpdate:modelValue":[t[9]||(t[9]=s=>a(e).transportAmount=s),t[10]||(t[10]=s=>b())]},null,8,["type","modelValue"])]),o("div",Ue,[Be,n(d,{modelValue:a(e).taxId,"onUpdate:modelValue":[t[11]||(t[11]=s=>a(e).taxId=s),t[12]||(t[12]=s=>b())],editable:"",options:a(l).masterData.taxes,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.taxId}])},null,8,["modelValue","options","class"])]),o("div",Le,[n($,{type:a(T).NUMERIC,label:"% Dto.",id:"discountPercentage",modelValue:a(e).discountPercentage,"onUpdate:modelValue":[t[13]||(t[13]=s=>a(e).discountPercentage=s),t[14]||(t[14]=s=>b())]},null,8,["type","modelValue"])])]),o("section",Re,[o("div",ze,[Ge,n(d,{modelValue:a(e).paymentMethodId,"onUpdate:modelValue":[t[15]||(t[15]=s=>a(e).paymentMethodId=s),t[16]||(t[16]=s=>b())],editable:"",options:a(l).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])]),o("div",Oe,[n($,{type:a(T).NUMERIC,label:"Total",id:"netAmount",modelValue:a(e).netAmount,"onUpdate:modelValue":t[17]||(t[17]=s=>a(e).netAmount=s),disabled:""},null,8,["type","modelValue"])])])])):U("",!0),o("div",je,[n(A,{value:a(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:k(()=>[n(D,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:k(s=>[ae(L(a(ue)(s.data.dueDate)),1)]),_:1}),n(D,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),n(y,{label:"Guardar",class:"mt-2",onClick:F})]),_:1}),n(C,{header:"Fitxers"},{default:k(()=>[n(we,{title:"Factures",entity:"PurchaseInvoice",id:a(e).id},null,8,["id"])]),_:1})]),_:1})}}}),rt=R({__name:"PurchaseInvoice",setup(u){const p=z(M.EDIT),_=X(),c=Z(),l=oe(),e=J(),w=H(),{purchaseInvoice:m}=W(w),f=async()=>{await w.GetById(_.params.id);let i="";m.value?(p.value=M.EDIT,i=`Factura de compra: ${m.value.number}`,m.value.purchaseInvoiceDate=new Date(m.value.purchaseInvoiceDate)):(p.value=M.CREATE,w.setNewPurchaseInvoice(_.params.id),i="Alta de factures de compra",v()),l.setMenuItem({icon:S.POUND,backButtonVisible:!0,text:i})},v=()=>{var i,b,r,t;if(m.value){const d=(i=e.masterData.exercises)==null?void 0:i.find(y=>y.name===new Date().getFullYear().toString());d&&(m.value.exerciceId=d.id);const h=(b=e.masterData.series)==null?void 0:b.find(y=>y.name==="Nacional");h&&(m.value.purchaseInvoiceSerieId=h.id);const D=(r=e.masterData.statuses)==null?void 0:r.find(y=>y.name==="Nova");D&&(m.value.purchaseInvoiceStatusId=D.id);const A=(t=e.masterData.taxes)==null?void 0:t.find(y=>y.name==="IVA 21%");A&&(m.value.taxId=A.id)}};G(async()=>{await f()});const I=O(),F=async()=>{const i=m.value;let b=!1,r="";p.value===M.CREATE?await w.Create(i)===!0&&(b=!0,r="Factura creada correctament"):await w.Update(i)===!0&&(b=!0,r="Factura actualizada correctament"),b&&(I.add({severity:"success",summary:r,life:5e3}),c.back())};return(i,b)=>a(m)?(g(),Y(qe,{key:0,purchaseInvoice:a(m),onSubmit:F},null,8,["purchaseInvoice"])):U("",!0)}});export{rt as default};
