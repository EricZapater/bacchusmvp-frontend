import{d as C,g as V,q as _,r as T,c as k,j as d,s as f,e as w,t as B,a as E,v as l,i as I,x as F,u as N,y as g,o as R,k as v,z as $,P as h}from"./index-1098a02f.js";import{u as A}from"./customers-9a71376a.js";import{c as D,a as b,F as M}from"./form-validator-88e54800.js";import"./base.service-613925eb.js";const S={key:0},q={class:"mt-2"},z=C({__name:"FormCustomerType",props:{customerType:{}},emits:["submit","cancel"],setup(y,{emit:c}){const u=y,i=V(),m=D().shape({name:b().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),description:b().required("La descripció és obligatori").max(250,"La descripció no pot superar els 250 carácters")}),e=_({result:!1,errors:{}}),n=()=>{const t=new M(m);e.value=t.validate(u.customerType)},p=async()=>{if(n(),e.value.result)c("submit",u.customerType);else{let t="";Object.entries(e.value.errors).forEach(a=>{t+=`${a[1].map(s=>s)}.   `}),i.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,a)=>{const s=T("BaseInput"),r=T("Button");return t.customerType?(E(),k("form",S,[d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.name}]),label:"Nom",id:"name",modelValue:t.customerType.name,"onUpdate:modelValue":a[0]||(a[0]=o=>t.customerType.name=o)},null,8,["modelValue","class"]),d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.description}]),label:"Descripció",id:"description",modelValue:t.customerType.description,"onUpdate:modelValue":a[1]||(a[1]=o=>t.customerType.description=o)},null,8,["modelValue","class"]),w("div",q,[d(r,{label:"Guardar",class:"mr-2",onClick:p})])])):B("",!0)}}}),G=C({__name:"CustomerType",setup(y){const c=_(l.EDIT),u=I(),i=F(),m=N(),e=A(),{customerType:n}=g(e),p=async()=>{await e.fetchCustomerType(i.params.id);let s="";n.value?(c.value=l.EDIT,s=`Tipus de client ${n.value.name}`):(c.value=l.CREATE,e.setNewCustomerType(i.params.id),s="Alta de tipus de client"),m.setMenuItem({icon:h.BUILDING,backButtonVisible:!0,text:s})};R(async()=>{await p()});const t=V(),a=async()=>{const s=n.value;let r=!1,o="";c.value===l.CREATE?(r=await e.createCustomerType(s),o="Tipus de client creat correctament"):(r=await e.updateCustomerType(s.id,s),o="Tipus de client actualizat correctament"),r&&(t.add({severity:"success",summary:o,life:5e3}),u.back())};return(s,r)=>v(e).customerType?(E(),$(z,{key:0,customerType:v(e).customerType,onSubmit:a},null,8,["customerType"])):B("",!0)}});export{G as default};
