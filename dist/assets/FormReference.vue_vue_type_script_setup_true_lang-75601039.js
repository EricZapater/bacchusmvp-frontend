import{d as g,H as y,j as B,o as L,r as N,h as C,c as p,e as l,i as r,n as u,y as n,k as a,l as f,m as q,G as P,a as c,s as m}from"./index-3e5d5186.js";import{c as D,a as i,F as S}from"./form-validator-06de3ae8.js";import{F as T}from"./FileEntityPicker-5805eef6.js";import{u as M}from"./tax-11cff46b.js";import{u as Y}from"./reference-66e6a90e.js";const $=l("br",null,null,-1),j={key:0},z={class:"three-columns"},G={class:"mt-1"},A={class:"mt-1"},H={class:"mt-1"},O={key:0,class:"four-columns"},X={class:"mt-1"},J={class:"mt-1"},K=l("label",{class:"block text-900 mb-2"},"Format",-1),Q={class:"mt-1"},W={class:"mt-1"},Z=l("label",{class:"block text-900 mb-2"},"Impost",-1),x={key:1,class:"three-columns"},ee={class:"mt-1"},oe={class:"mt-1"},se={class:"mt-1"},le=l("label",{class:"block text-900 mb-2"},"Impost",-1),re=l("br",null,null,-1),ue=g({__name:"FormReference",props:{module:{},reference:{}},emits:["submit","cancel"],setup(U,{emit:k}){const d=U,E=y(()=>d.module==="sales"),h=y(()=>d.module==="purchase");y(()=>d.module==="production");const F=B(),v=M(),I=Y();L(async()=>{await v.fetchAll()});const w=D().shape({code:i().required("El codi és obligatori").max(50,"El codi no pot superar els 50 carácters"),description:i().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),version:i().required("La versió és obligatoria").max(20,"La versió pot superar els 20 carácters"),cost:i().required("El cost es obligatori"),price:i().required("El preu es obligatori"),taxId:i().required("El tipus d'iva es obligatori")}),t=N({result:!1,errors:{}}),R=()=>{const e=new S(w);t.value=e.validate(d.reference)},_=async()=>{if(R(),t.value.result)k("submit",d.reference);else{let e="";Object.entries(t.value.errors).forEach(o=>{e+=`${o[1].map(V=>V)}.   `}),F.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,o)=>{const V=C("Button"),b=C("Dropdown");return c(),p(P,null,[l("div",null,[r(V,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:_}),$]),e.reference?(c(),p("form",j,[l("section",z,[l("div",G,[r(n,{class:u(["mb-2",{"p-invalid":t.value.errors.code}]),label:"Codi",id:"code",modelValue:e.reference.code,"onUpdate:modelValue":o[0]||(o[0]=s=>e.reference.code=s)},null,8,["modelValue","class"])]),l("div",A,[r(n,{class:u(["mb-2",{"p-invalid":t.value.errors.description}]),label:"Descripció",id:"description",modelValue:e.reference.description,"onUpdate:modelValue":o[1]||(o[1]=s=>e.reference.description=s)},null,8,["modelValue","class"])]),l("div",H,[r(n,{type:a(m).TEXT,label:"Versió",id:"version",modelValue:e.reference.version,"onUpdate:modelValue":o[2]||(o[2]=s=>e.reference.version=s)},null,8,["type","modelValue"])])]),h.value?(c(),p("section",O,[l("div",X,[r(n,{type:a(m).NUMERIC,decimals:2,label:"Densitat",id:"density",modelValue:e.reference.density,"onUpdate:modelValue":o[3]||(o[3]=s=>e.reference.density=s)},null,8,["type","modelValue"])]),l("div",J,[K,r(b,{modelValue:e.reference.referenceFormatId,"onUpdate:modelValue":o[4]||(o[4]=s=>e.reference.referenceFormatId=s),editable:"",options:a(I).referenceFormats,optionValue:"id",optionLabel:"description",class:u(["w-full",{"p-invalid":t.value.errors.taxid}])},null,8,["modelValue","options","class"])]),l("div",Q,[r(n,{type:a(m).CURRENCY,label:"Últim preu de compra",id:"lastPurchaseCost",modelValue:e.reference.lastPurchaseCost,"onUpdate:modelValue":o[5]||(o[5]=s=>e.reference.lastPurchaseCost=s)},null,8,["type","modelValue"])]),l("div",W,[Z,r(b,{modelValue:e.reference.taxId,"onUpdate:modelValue":o[6]||(o[6]=s=>e.reference.taxId=s),editable:"",options:a(v).taxes,optionValue:"id",optionLabel:"name",class:u(["w-full",{"p-invalid":t.value.errors.taxid}])},null,8,["modelValue","options","class"])])])):f("",!0),E.value?(c(),p("section",x,[l("div",ee,[r(n,{type:a(m).CURRENCY,label:"Cost",id:"cost",modelValue:e.reference.cost,"onUpdate:modelValue":o[7]||(o[7]=s=>e.reference.cost=s)},null,8,["type","modelValue"])]),l("div",oe,[r(n,{type:a(m).CURRENCY,label:"Preu",id:"price",modelValue:e.reference.price,"onUpdate:modelValue":o[8]||(o[8]=s=>e.reference.price=s)},null,8,["type","modelValue"])]),l("div",se,[le,r(b,{modelValue:e.reference.taxId,"onUpdate:modelValue":o[9]||(o[9]=s=>e.reference.taxId=s),editable:"",options:a(v).taxes,optionValue:"id",optionLabel:"name",class:u(["w-full",{"p-invalid":t.value.errors.taxid}])},null,8,["modelValue","options","class"])])])):f("",!0),l("section",null,[re,e.reference?(c(),q(T,{key:0,title:"Documentació",entity:"referenceMaps",id:e.reference.id},null,8,["id"])):f("",!0)])])):f("",!0)],64)}}});export{ue as _};
