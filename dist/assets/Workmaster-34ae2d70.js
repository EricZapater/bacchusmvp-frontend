import{_ as F}from"./DropdownReference.vue_vue_type_script_setup_true_lang-36b25622.js";import{c as U,d as O,a as j,F as A}from"./form-validator-f8953ae6.js";import{d as S,j as L,r as B,h as b,c as D,e as i,i as o,k as p,y as Q,l as C,a as y,s as z,E as G,x as H,w,G as W,P as V,C as $,D as P,n as J,m as M,v as K,g as X,u as Y,z as Z,o as ee,f as te}from"./index-911ee129.js";import{u as R}from"./reference-bee2d075.js";import{g as ae}from"./functions-25e1930c.js";import{u as N}from"./plantmodel-5a4f0b93.js";import{_ as se}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-b4b285d9.js";import{u as re}from"./workmaster-3991e3c2.js";import"./_commonjsHelpers-725317a4.js";import"./reference.service-a8d0a640.js";import"./base.service-f2c5646d.js";import"./v4-a960c1f4.js";import"./index-3a886172.js";const oe={key:0},ne=i("br",null,null,-1),le={class:"three-columns"},ie=i("label",{class:"block text-900 mb-2"},"Desactivat",-1),de=S({__name:"FormWorkmaster",props:{workmaster:{}},emits:["submit","cancel"],setup(T,{emit:k}){const f=T,d=L();R();const h=U().shape({baseQuantity:O().min(1).required("La quantitat base ha de ser superior a 1"),referenceId:j().required("La referència és obligatoria")}),a=B({result:!1,errors:{}}),v=()=>{const t=new A(h);a.value=t.validate(f.workmaster)},n=async()=>{if(v(),a.value.result)k("submit",f.workmaster);else{let t="";Object.entries(a.value.errors).forEach(r=>{t+=`${r[1].map(_=>_)}.   `}),d.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,r)=>{const _=b("Button"),g=b("Checkbox");return t.workmaster?(y(),D("form",oe,[i("div",null,[o(_,{label:"Guardar Ruta",class:"grid_add_row_button",size:"small",onClick:n}),ne]),i("section",le,[i("div",null,[o(F,{label:"Referència",modelValue:t.workmaster.referenceId,"onUpdate:modelValue":r[0]||(r[0]=u=>t.workmaster.referenceId=u),fullName:!0},null,8,["modelValue"])]),i("div",null,[o(Q,{type:p(z).NUMERIC,label:"Quantitat Base",decimals:2,modelValue:t.workmaster.baseQuantity,"onUpdate:modelValue":r[1]||(r[1]=u=>t.workmaster.baseQuantity=u)},null,8,["type","modelValue"])]),i("div",null,[ie,o(g,{modelValue:t.workmaster.disabled,"onUpdate:modelValue":r[2]||(r[2]=u=>t.workmaster.disabled=u),class:"w-full",binary:!0},null,8,["modelValue"])])])])):C("",!0)}}}),ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ue=i("span",{class:"text-xl text-900 font-bold"},"Fases de la ruta",-1),me=["onClick"],pe=S({__name:"TableWorkmasterPhases",props:{workmaster:{},workmasterPhases:{}},emits:["add","edit","delete"],setup(T,{emit:k}){const f=T,d=G({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),h=H(),a=N(),v=e=>{var c;if(!a.workcenterTypes)return"";const s=(c=a.workcenterTypes)==null?void 0:c.find(l=>e===l.id);return s?s.name:""},n=e=>{var c;if(!a.workcenters)return"";const s=(c=a.workcenters)==null?void 0:c.find(l=>e===l.id);return s?s.name:""},t=e=>{var c;if(!a.operatorTypes)return"";const s=(c=a.operatorTypes)==null?void 0:c.find(l=>e===l.id);return s?s.name:""},r=B({}),_=()=>{r.value={id:ae(),workMasterId:f.workmaster.id,disabled:!1,phaseCode:((f.workmaster.phases.length+1)*10).toString(),phaseDescription:"",operatorTypeId:"",workcenterTypeId:"",preferredWorkcenterId:null,workmasterPhaseDetails:[],workmasterPhaseBillOfMaterials:[]},d.visible=!0},g=e=>{d.visible=!1,k("add",e)},u=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||k("edit",e.data)},I=(e,s)=>{h.require({target:e.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{k("delete",s)}})};return(e,s)=>{const c=b("Button"),l=b("Column"),E=b("DataTable"),q=b("Dialog");return y(),D(W,null,[o(E,{onRowClick:u,value:e.workmasterPhases,tableStyle:"min-width: 100%"},{header:w(()=>[i("div",ce,[ue,o(c,{icon:p(V).PLUS,rounded:"",raised:"",onClick:_},null,8,["icon"])])]),default:w(()=>[o(l,{field:"phaseCode",header:"Codi",style:{width:"15%"}}),o(l,{field:"phaseDescription",header:"Descripció",style:{width:"30%"}}),o(l,{header:"Tipus de màquina",style:{width:"15%"}},{body:w(m=>[$(P(v(m.data.workcenterTypeId)),1)]),_:1}),o(l,{header:"Màquina preferida",style:{width:"15%"}},{body:w(m=>[$(P(n(m.data.preferredWorkcenterId)),1)]),_:1}),o(l,{header:"Tipus d'operari",style:{width:"15%"}},{body:w(m=>[$(P(t(m.data.operatorTypeId)),1)]),_:1}),o(l,{style:{width:"10%"}},{body:w(m=>[i("i",{class:J([p(V).TIMES,"grid_delete_column_button"]),onClick:x=>I(x,m.data)},null,10,me)]),_:1})]),_:1},8,["value"]),o(q,{visible:d.visible,"onUpdate:visible":s[0]||(s[0]=m=>d.visible=m),header:d.title,closable:d.closable,modal:d.modal},{default:w(()=>[r.value?(y(),M(se,{key:0,workmaster:e.workmaster,phase:r.value,onSubmit:g},null,8,["workmaster","phase"])):C("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),fe={class:"main"},ke=S({__name:"Workmaster",setup(T){const k=K(),f=X(),d=Y(),h=R(),a=re(),v=N(),{workmaster:n}=Z(a),t=B("");ee(async()=>{t.value=k.params.id,await r();let e="";e="Ruta de fabricació",n.value&&(e=`${e} ${h.getFullName(n.value.reference)}`),d.setMenuItem({icon:V.BUILDING,backButtonVisible:!0,title:e})});const r=async()=>{await h.fetchReferencesByModule("sales"),await a.fetchOne(t.value),v.fetchActiveModel()},_=async e=>{await a.update(t.value,e)&&await r()},g=async e=>{await a.createPhase(e)&&f.push({path:`/workmaster/${t.value}/phase/${e.id}`})},u=e=>{f.push({path:`/workmaster/${t.value}/phase/${e.id}`})},I=async e=>{await a.deletePhase(e.id)};return(e,s)=>(y(),D(W,null,[i("header",null,[p(n)?(y(),M(de,{key:0,workmaster:p(n),onSubmit:_},null,8,["workmaster"])):C("",!0)]),i("main",fe,[p(n)&&p(n).phases?(y(),M(pe,{key:0,workmaster:p(n),workmasterPhases:p(n).phases,onAdd:g,onEdit:u,onDelete:I},null,8,["workmaster","workmasterPhases"])):C("",!0)])],64))}});const Me=te(ke,[["__scopeId","data-v-a7de9030"]]);export{Me as default};
