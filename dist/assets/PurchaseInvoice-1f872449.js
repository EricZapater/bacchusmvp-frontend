import{K as oe,a as g,c as C,e as s,L as G,M as B,d as Y,j as q,r as K,o as W,h as F,i as l,w as T,D as O,k as a,P as S,G as se,N as le,n as V,l as U,f as Q,z as X,m as j,y as P,s as N,C as ne,p as ie,b as re,F as R,v as ue,g as de,u as ce}from"./index-1eecf3a6.js";import{a as Z,u as ee}from"./purchaseInvoices-8e8ad822.js";import{c as pe,a as J,F as me}from"./form-validator-a4e10584.js";import{F as ve}from"./file.service-2653f048.js";import{c as be,f as fe}from"./functions-028ffd6d.js";import"./index-353ee2c2.js";import"./base.service-5f37388d.js";import"./index-aa51f725.js";import"./suppliers.service-e52cf2e8.js";var te={name:"Toolbar",extends:oe,props:{"aria-labelledby":{type:String,default:null}}};const ye=["aria-labelledby"];function _e(i,v,I,p,n,e){return g(),C("div",B({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":i.ariaLabelledby},i.ptm("root")),[s("div",B({class:"p-toolbar-group-start p-toolbar-group-left"},i.ptm("start")),[G(i.$slots,"start")],16),s("div",B({class:"p-toolbar-group-center"},i.ptm("center")),[G(i.$slots,"center")],16),s("div",B({class:"p-toolbar-group-end p-toolbar-group-right"},i.ptm("end")),[G(i.$slots,"end")],16)],16,ye)}function Ie(i,v){v===void 0&&(v={});var I=v.insertAt;if(!(!i||typeof document>"u")){var p=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",I==="top"&&p.firstChild?p.insertBefore(n,p.firstChild):p.appendChild(n),n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i))}}var he=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;Ie(he);te.render=_e;const xe={class:"base_input"},Ve={class:"file-viewer"},ge={class:"file-viewer-item-type"},De={class:"file-viewer-item-actions"},we=["onClick"],Fe=["onClick"],Ae=Y({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(i){const v=i,I=q(),p=new ve,n=K(void 0),e=async()=>{n.value=await p.GetEntityFiles(v.entity,v.id)};W(async()=>{await e()});const D=async()=>{const b=document.createElement("input");b.type="file",b.onchange=async _=>{const w=_.target.files[0];if(!await p.Upload(w,v.entity,v.id)){I.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await e()},b.click()},m=async b=>{const _=await p.Download(b);be(b.originalName,_)},y=async b=>{var _=await p.Delete(b.id);if(!_){I.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await e()};return(b,_)=>{const w=F("Button");return g(),C("div",xe,[l(a(te),null,{start:T(()=>[s("h4",null,O(b.title),1)]),end:T(()=>[l(w,{size:"small",rounded:"",icon:a(S).UPLOAD,onClick:D},null,8,["icon"])]),_:1}),s("section",Ve,[(g(!0),C(se,null,le(n.value,r=>(g(),C("article",{class:"file-viewer-item",key:b.id},[s("div",ge,[r.type===0?(g(),C("i",{key:0,class:V(a(S).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):U("",!0),r.type===1?(g(),C("i",{key:1,class:V(a(S).IMAGE),style:{"font-size":"3.5rem"}},null,2)):U("",!0),s("p",null,O(r.originalName.substring(0,20)),1)]),s("div",De,[s("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:d=>m(r)},[s("i",{class:V(a(S).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,we),s("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:d=>y(r)},[s("i",{class:V(a(S).TIMES)},null,2)],8,Fe)])]))),128))])])}}});const Pe=Q(Ae,[["__scopeId","data-v-dd7a228d"]]),k=i=>(ie("data-v-e6336f23"),i=i(),re(),i),Ce={key:0},Te={class:"four-columns"},ke=k(()=>s("label",{class:"block text-900 mb-2"},"Exercici",-1)),Se=k(()=>s("label",{class:"block text-900 mb-2"},"Sèrie",-1)),$e=k(()=>s("label",{class:"block text-900 mb-2"},"Estat",-1)),Ee={class:"four-columns"},Ne={class:"mt-1"},Ue=k(()=>s("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),Me={class:"mt-1"},Be={class:"mt-1"},Re=k(()=>s("label",{class:"block text-900 mb-2"},"Data Factura",-1)),Le={class:"mt-1"},ze=k(()=>s("label",{class:"block text-900 mb-2"},"Forma de pagament",-1)),Ge={class:"four-columns"},Oe={class:"mt-1"},je={class:"mt-1"},Ye={class:"mt-1"},qe=k(()=>s("label",{class:"block text-900 mb-2"},"IVA",-1)),Ke={class:"mt-1"},We={class:"four-columns"},He={class:"mt-1"},Je={class:"mt-1"},Qe={class:"mt-3"},Xe=Y({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(i,{emit:v}){const I=i,p=Z(),n=ee(),{purchaseInvoice:e}=X(p),D=q(),m=pe().shape({exerciceId:J().required("L'exercici es obligatori"),supplierId:J().required("El proveïdor es obligatori")}),y=K({result:!1,errors:{}}),b=()=>{const u=new me(m);y.value=u.validate(I.purchaseInvoice)};let _=!1;W(()=>{setTimeout(()=>{_=!0},500)});const w=async()=>{if(b(),y.value.result)v("submit",e.value);else{let u="";Object.entries(y.value.errors).forEach(t=>{u+=`${t[1].map(c=>c)}.   `}),D.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},r=()=>{var t;const u=(t=n.masterData.suppliers)==null?void 0:t.find(c=>{var h;return c.id===((h=e.value)==null?void 0:h.supplierId)});u&&(e.value.paymentMethodId=u.paymentMethodId)},d=async()=>{var t;if(_&&e.value&&e.value.baseAmount!==0){let c=0,h=0,x=0,A=0,f=0,$=0,E=0,o=0,M=0,L=0,z=0;e.value.baseAmount&&(c=parseFloat(e.value.baseAmount.toFixed(2))),e.value.transportAmount&&(h=parseFloat(e.value.transportAmount.toFixed(2))),e.value.discountPercentage&&(o=parseFloat(e.value.discountPercentage.toFixed(2))),e.value.extraTaxPercentatge&&(L=e.value.extraTaxPercentatge);var u=(t=n.masterData.taxes)==null?void 0:t.find(ae=>{var H;return ae.id===((H=e.value)==null?void 0:H.taxId)});u&&(A=parseFloat(u.percentatge.toFixed(2))),x=(c+h)*1,f=x*(A/100),z=x*(L/100),M=x+f*1-z*1,E=M*(1*o)/100,$=parseFloat((M-E).toFixed(2)),e.value.baseAmount=c,e.value.transportAmount=h,e.value.subtotal=x,e.value.taxAmount=f,e.value.grossAmount=M,e.value.netAmount=$,e.value.discountPercentage=o,e.value.discountAmount=E,e.value.extraTaxPercentatge=L,e.value.extraTaxAmount=z,e.value.purchaseInvoiceDueDates=await p.GetDueDates(e.value)}};return(u,t)=>{const c=F("Dropdown"),h=F("Calendar"),x=F("Column"),A=F("DataTable"),f=F("Button"),$=F("TabPanel"),E=F("TabView");return g(),j(E,null,{default:T(()=>[l($,{header:"Factura"},{default:T(()=>[a(e)?(g(),C("form",Ce,[s("section",Te,[l(P,{label:"Num. Fra. Intern",id:"number",modelValue:a(e).number,"onUpdate:modelValue":t[0]||(t[0]=o=>a(e).number=o),disabled:""},null,8,["modelValue"]),s("div",null,[ke,l(c,{modelValue:a(e).exerciceId,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).exerciceId=o),editable:"",options:a(n).masterData.exercises,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":y.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),s("div",null,[Se,l(c,{modelValue:a(e).purchaseInvoiceSerieId,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).purchaseInvoiceSerieId=o),editable:"",options:a(n).masterData.series,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":y.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),s("div",null,[$e,l(c,{modelValue:a(e).purchaseInvoiceStatusId,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).purchaseInvoiceStatusId=o),editable:"",options:a(n).masterData.statuses,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":y.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),s("section",Ee,[s("div",Ne,[Ue,l(c,{modelValue:a(e).supplierId,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).supplierId=o),editable:"",options:a(n).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",onChange:r,class:V(["w-full",{"p-invalid":y.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),s("div",Me,[l(P,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:a(e).supplierNumber,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).supplierNumber=o)},null,8,["modelValue"])]),s("div",Be,[Re,l(h,{id:"purchaseInvoiceDate",modelValue:a(e).purchaseInvoiceDate,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).purchaseInvoiceDate=o),onDateSelect:t[7]||(t[7]=o=>d())},null,8,["modelValue"])]),s("div",Le,[ze,l(c,{modelValue:a(e).paymentMethodId,"onUpdate:modelValue":[t[8]||(t[8]=o=>a(e).paymentMethodId=o),t[9]||(t[9]=o=>d())],editable:"",options:a(n).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":y.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])])]),s("section",Ge,[s("div",Oe,[l(P,{type:a(N).CURRENCY,label:"Base",id:"baseAmount",modelValue:a(e).baseAmount,"onUpdate:modelValue":[t[10]||(t[10]=o=>a(e).baseAmount=o),t[11]||(t[11]=o=>d())]},null,8,["type","modelValue"])]),s("div",je,[l(P,{type:a(N).CURRENCY,label:"Ports",id:"transportAmount",modelValue:a(e).transportAmount,"onUpdate:modelValue":[t[12]||(t[12]=o=>a(e).transportAmount=o),t[13]||(t[13]=o=>d())]},null,8,["type","modelValue"])]),s("div",Ye,[qe,l(c,{modelValue:a(e).taxId,"onUpdate:modelValue":[t[14]||(t[14]=o=>a(e).taxId=o),t[15]||(t[15]=o=>d())],editable:"",options:a(n).masterData.taxes,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":y.value.errors.taxId}])},null,8,["modelValue","options","class"])]),s("div",Ke,[l(P,{type:a(N).NUMERIC,label:"IRPF",id:"extraTaxPercentatge",modelValue:a(e).extraTaxPercentatge,"onUpdate:modelValue":[t[16]||(t[16]=o=>a(e).extraTaxPercentatge=o),t[17]||(t[17]=o=>d())]},null,8,["type","modelValue"])])]),s("section",We,[s("div",He,[l(P,{type:a(N).NUMERIC,decimals:2,label:"% Dto.",id:"discountPercentage",modelValue:a(e).discountPercentage,"onUpdate:modelValue":[t[18]||(t[18]=o=>a(e).discountPercentage=o),t[19]||(t[19]=o=>d())]},null,8,["type","modelValue"])]),s("div",Je,[l(P,{type:a(N).CURRENCY,label:"Total",id:"netAmount",modelValue:a(e).netAmount,"onUpdate:modelValue":t[20]||(t[20]=o=>a(e).netAmount=o),disabled:""},null,8,["type","modelValue"])])])])):U("",!0),s("div",Qe,[l(A,{value:a(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:T(()=>[l(x,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:T(o=>[ne(O(a(fe)(o.data.dueDate)),1)]),_:1}),l(x,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),l(f,{label:"Guardar",class:"save_button",onClick:w})]),_:1}),l($,{header:"Fitxers"},{default:T(()=>[l(f,{label:"Guardar",class:"save_button",onClick:w}),a(_)?(g(),j(Pe,{key:0,title:"Factures",entity:"PurchaseInvoice",id:I.purchaseInvoice.id},null,8,["id"])):U("",!0)]),_:1})]),_:1})}}});const Ze=Q(Xe,[["__scopeId","data-v-e6336f23"]]),ut=Y({__name:"PurchaseInvoice",setup(i){const v=K(R.EDIT),I=ue(),p=de(),n=ce(),e=ee(),D=Z(),{purchaseInvoice:m}=X(D),y=async()=>{await D.GetById(I.params.id);let r="";m.value?(v.value=R.EDIT,r=`Factura de compra: ${m.value.number}`,m.value.purchaseInvoiceDate=new Date(m.value.purchaseInvoiceDate)):(v.value=R.CREATE,D.setNewPurchaseInvoice(I.params.id),r="Alta de factures de compra",b()),n.setMenuItem({icon:S.POUND,backButtonVisible:!0,title:r})},b=()=>{var r,d,u,t;if(m.value){const c=(r=e.masterData.exercises)==null?void 0:r.find(f=>f.name===new Date().getFullYear().toString());c&&(m.value.exerciceId=c.id);const h=(d=e.masterData.series)==null?void 0:d.find(f=>f.name==="Nacional");h&&(m.value.purchaseInvoiceSerieId=h.id);const x=(u=e.masterData.statuses)==null?void 0:u.find(f=>f.name==="Nova");x&&(m.value.purchaseInvoiceStatusId=x.id);const A=(t=e.masterData.taxes)==null?void 0:t.find(f=>f.name==="IVA 21%");A&&(m.value.taxId=A.id)}};W(async()=>{await y()});const _=q(),w=async()=>{const r=m.value;let d=!1,u="";v.value===R.CREATE?await D.Create(r)===!0&&(d=!0,u="Factura creada correctament"):await D.Update(r)===!0&&(d=!0,u="Factura actualizada correctament"),d&&(_.add({severity:"success",summary:u,life:5e3}),p.back())};return(r,d)=>a(m)?(g(),j(Ze,{key:0,purchaseInvoice:a(m),onSubmit:w},null,8,["purchaseInvoice"])):U("",!0)}});export{ut as default};
