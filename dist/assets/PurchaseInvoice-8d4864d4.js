import{b as Z,u as ee}from"./vue-router-b024814c.js";import{o as V,c as g,e as o,r as U,m as T,j as L,k as z,M as G,f as w,h as l,w as D,t as M,l as t,P as A,F as te,p as ae,n as y,d as N,ax as K,a as Q,a0 as oe,u as se}from"./index-2bfc80b2.js";import{F as le,a as X,u as ne}from"./purchaseInvoices-e022a5b2.js";import{u as O}from"./usetoast.esm-82b2df9e.js";import{F as B}from"./component-c8ee66ae.js";import{s as ie,B as F}from"./BaseInput-95847e6b.js";import{c as re,a as J,F as ue}from"./form-validator-1a569dfe.js";import{c as de,f as ce}from"./functions-028ffd6d.js";import{_ as me}from"./_plugin-vue_export-helper-c27b6911.js";import"./exercise.service-65855d63.js";import"./base.service-8b4a1a4e.js";import"./paymentmethod.service-1ada7ddf.js";import"./tax.service-2ace897f.js";import"./index-78dd0e83.js";import"./suppliers.service-82e016ae.js";import"./runtime-dom.esm-bundler-0884c737.js";var Y={name:"Toolbar",extends:ie,props:{"aria-labelledby":{type:String,default:null}}};const pe=["aria-labelledby"];function ve(i,c,f,u,n,e){return V(),g("div",T({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":i.ariaLabelledby},i.ptm("root")),[o("div",T({class:"p-toolbar-group-start p-toolbar-group-left"},i.ptm("start")),[U(i.$slots,"start")],16),o("div",T({class:"p-toolbar-group-center"},i.ptm("center")),[U(i.$slots,"center")],16),o("div",T({class:"p-toolbar-group-end p-toolbar-group-right"},i.ptm("end")),[U(i.$slots,"end")],16)],16,pe)}function be(i,c){c===void 0&&(c={});var f=c.insertAt;if(!(!i||typeof document>"u")){var u=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",f==="top"&&u.firstChild?u.insertBefore(n,u.firstChild):u.appendChild(n),n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i))}}var fe=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;be(fe);Y.render=ve;const _e={class:"base_input"},ye={class:"file-viewer"},Ie={class:"file-viewer-item-type"},Ve={class:"file-viewer-item-actions"},he=["onClick"],we=["onClick"],ge=L({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(i){const c=i,f=O(),u=new le,n=z(void 0),e=async()=>{n.value=await u.GetEntityFiles(c.entity,c.id)};G(async()=>{await e()});const I=async()=>{const m=document.createElement("input");m.type="file",m.onchange=async r=>{const _=r.target.files[0];if(!await u.Upload(_,c.entity,c.id)){f.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await e()},m.click()},k=async m=>{const r=await u.Download(m);de(m.originalName,r)},p=async m=>{var r=await u.Delete(m.id);if(!r){f.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await e()};return(m,r)=>{const _=w("Button");return V(),g("div",_e,[l(t(Y),null,{start:D(()=>[o("h4",null,M(m.title),1)]),end:D(()=>[l(_,{size:"small",rounded:"",icon:t(A).UPLOAD,onClick:I},null,8,["icon"])]),_:1}),o("section",ye,[(V(!0),g(te,null,ae(n.value,d=>(V(),g("article",{class:"file-viewer-item",key:m.id},[o("div",Ie,[d.type===0?(V(),g("i",{key:0,class:y(t(A).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):N("",!0),d.type===1?(V(),g("i",{key:1,class:y(t(A).IMAGE),style:{"font-size":"3.5rem"}},null,2)):N("",!0),o("p",null,M(d.originalName.substring(0,20)),1)]),o("div",Ve,[o("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:h=>k(d)},[o("i",{class:y(t(A).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,he),o("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:h=>p(d)},[o("i",{class:y(t(A).TIMES)},null,2)],8,we)])]))),128))])])}}});const De=me(ge,[["__scopeId","data-v-dd7a228d"]]),xe={key:0},Fe={class:"four-columns"},Ae=o("label",{class:"block text-900 mb-2"},"Exercici",-1),ke=o("label",{class:"block text-900 mb-2"},"Sèrie",-1),$e=o("label",{class:"block text-900 mb-2"},"Estat",-1),Pe={class:"three-columns"},Ce={class:"mt-2"},Ee=o("label",{class:"block text-900 mb-2"},"Proveïdor",-1),Se={class:"mt-2"},Te={class:"mt-2"},Be=o("label",{class:"block text-900 mb-2"},"Data Factura: ",-1),Ne={class:"four-columns"},Ue={class:"mt-2"},Me={class:"mt-2"},Le={class:"mt-2"},ze=o("label",{class:"block text-900 mb-2"},"IVA",-1),Ge={class:"mt-2"},Oe={class:"two-columns"},Re={class:"mt-2"},je=o("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),qe={class:"mt-2"},We={class:"mt-3"},He=L({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(i,{emit:c}){const f=i,u=X(),n=ne(),{purchaseInvoice:e}=K(u),I=O(),k=re().shape({exerciceId:J().required("L'exercici es obligatori"),supplierId:J().required("El proveïdor es obligatori")}),p=z({result:!1,errors:{}}),m=()=>{const v=new ue(k);p.value=v.validate(f.purchaseInvoice)};let r=!1;G(()=>{setTimeout(()=>r=!0,1e3)});const _=async()=>{if(m(),p.value.result)c("submit",e.value);else{let v="";Object.entries(p.value.errors).forEach(a=>{v+=`${a[1].map(b=>b)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:v,life:5e3})}},d=async()=>{var s,R,j,q;if(!r)return;let v,a,b,$,P,C,x,E;v=h((s=e.value)==null?void 0:s.baseAmount),a=h((R=e.value)==null?void 0:R.transportAmount);var S=(j=n.masterData.taxes)==null?void 0:j.find(Je=>{var W,H;return((W=e.value)==null?void 0:W.taxId)===((H=e.value)==null?void 0:H.taxId)});b=h(S==null?void 0:S.percentatge),$=(v*1+a*1)*(b/100),e.value.taxAmount=$,x=v*1+a*1+$*1,e.value.grossAmount=x,C=x*(1*h((q=e.value)==null?void 0:q.discountPercentage))/100,e.value.discountAmount=C,P=x-C,e.value.netAmount=parseFloat(P.toFixed(2)),console.log(e.value),E=await u.GetDueDates(e.value),e.value.purchaseInvoiceDueDates=E,console.log(e.value)},h=v=>v||0;return(v,a)=>{const b=w("Dropdown"),$=w("Calendar"),P=w("Column"),C=w("DataTable"),x=w("Button"),E=w("TabPanel"),S=w("TabView");return V(),Q(S,null,{default:D(()=>[l(E,{header:"Factura"},{default:D(()=>[t(e)?(V(),g("form",xe,[o("section",Fe,[o("div",null,[Ae,l(b,{modelValue:t(e).exerciceId,"onUpdate:modelValue":a[0]||(a[0]=s=>t(e).exerciceId=s),editable:"",options:t(n).masterData.exercises,optionValue:"id",optionLabel:"name",class:y(["w-full",{"p-invalid":p.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),o("div",null,[ke,l(b,{modelValue:t(e).purchaseInvoiceSerieId,"onUpdate:modelValue":a[1]||(a[1]=s=>t(e).purchaseInvoiceSerieId=s),editable:"",options:t(n).masterData.series,optionValue:"id",optionLabel:"name",class:y(["w-full",{"p-invalid":p.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),l(F,{label:"Num. Fra. Intern",id:"number",modelValue:t(e).number,"onUpdate:modelValue":a[2]||(a[2]=s=>t(e).number=s),disabled:""},null,8,["modelValue"]),o("div",null,[$e,l(b,{modelValue:t(e).purchaseInvoiceStatusId,"onUpdate:modelValue":a[3]||(a[3]=s=>t(e).purchaseInvoiceStatusId=s),editable:"",options:t(n).masterData.statuses,optionValue:"id",optionLabel:"name",class:y(["w-full",{"p-invalid":p.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),o("section",Pe,[o("div",Ce,[Ee,l(b,{modelValue:t(e).supplierId,"onUpdate:modelValue":a[4]||(a[4]=s=>t(e).supplierId=s),editable:"",options:t(n).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:y(["w-full",{"p-invalid":p.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),o("div",Se,[l(F,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:t(e).supplierNumber,"onUpdate:modelValue":a[5]||(a[5]=s=>t(e).supplierNumber=s)},null,8,["modelValue"])]),o("div",Te,[Be,l($,{id:"purchaseInvoiceDate",modelValue:t(e).purchaseInvoiceDate,"onUpdate:modelValue":a[6]||(a[6]=s=>t(e).purchaseInvoiceDate=s)},null,8,["modelValue"])])]),o("section",Ne,[o("div",Ue,[l(F,{label:"Base",id:"baseAmount",modelValue:t(e).baseAmount,"onUpdate:modelValue":[a[7]||(a[7]=s=>t(e).baseAmount=s),a[8]||(a[8]=s=>d())]},null,8,["modelValue"])]),o("div",Me,[l(F,{label:"Ports",id:"transportAmount",modelValue:t(e).transportAmount,"onUpdate:modelValue":[a[9]||(a[9]=s=>t(e).transportAmount=s),a[10]||(a[10]=s=>d())]},null,8,["modelValue"])]),o("div",Le,[ze,l(b,{modelValue:t(e).taxId,"onUpdate:modelValue":[a[11]||(a[11]=s=>t(e).taxId=s),a[12]||(a[12]=s=>d())],editable:"",options:t(n).masterData.taxes,optionValue:"id",optionLabel:"name",class:y(["w-full",{"p-invalid":p.value.errors.taxId}])},null,8,["modelValue","options","class"])]),o("div",Ge,[l(F,{label:"% Dto.",id:"discountPercentage",modelValue:t(e).discountPercentage,"onUpdate:modelValue":[a[13]||(a[13]=s=>t(e).discountPercentage=s),a[14]||(a[14]=s=>d())]},null,8,["modelValue"])])]),o("section",Oe,[o("div",Re,[je,l(b,{modelValue:t(e).paymentMethodId,"onUpdate:modelValue":[a[15]||(a[15]=s=>t(e).paymentMethodId=s),a[16]||(a[16]=s=>d())],editable:"",options:t(n).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:y(["w-full",{"p-invalid":p.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])]),o("div",qe,[l(F,{label:"Total",id:"netAmount",modelValue:t(e).netAmount,"onUpdate:modelValue":a[17]||(a[17]=s=>t(e).netAmount=s),disabled:""},null,8,["modelValue"])])])])):N("",!0),o("div",We,[l(C,{value:t(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:D(()=>[l(P,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:D(s=>[oe(M(t(ce)(s.data.dueDate)),1)]),_:1}),l(P,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),l(x,{label:"Guardar",class:"mt-2",onClick:_})]),_:1}),l(E,{header:"Fitxers"},{default:D(()=>[l(De,{title:"Factures",entity:"PurchaseInvoice",id:t(e).id},null,8,["id"])]),_:1})]),_:1})}}}),ct=L({__name:"PurchaseInvoice",setup(i){const c=z(B.EDIT),f=Z(),u=ee(),n=se(),e=X(),{purchaseInvoice:I}=K(e),k=async()=>{await e.GetById(f.params.id);let r="";I.value?(c.value=B.EDIT,r=`Factura de compra: ${I.value.number}`):(c.value=B.CREATE,e.setNewPurchaseInvoice(f.params.id),r="Alta de factures de compra"),n.setMenuItem({icon:A.POUND,backButtonVisible:!0,text:r})};G(async()=>{await k()});const p=O(),m=async()=>{const r=I.value;let _=!1,d="";c.value===B.CREATE?await e.Create(r)===!0&&(_=!0,d="Factura creada correctament"):await e.Update(r)===!0&&(_=!0,d="Factura actualizada correctament"),_&&(p.add({severity:"success",summary:d,life:5e3}),u.back())};return(r,_)=>t(I)?(V(),Q(He,{key:0,purchaseInvoice:t(I),onSubmit:m},null,8,["purchaseInvoice"])):N("",!0)}});export{ct as default};
