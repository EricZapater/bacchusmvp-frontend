import{L as oe,a as D,c as C,e as s,M as O,N as M,d as j,j as Y,r as q,o as H,h as w,i as l,w as T,E as G,k as a,P as S,H as se,O as le,n as V,l as R,f as K,z as Q,m as X,y as P,s as N,D as ne,p as ie,b as re,F as B,v as ue,g as de,u as ce}from"./index-c73e34a4.js";import{F as pe,a as Z,u as ee}from"./purchaseInvoices-2b0e1aac.js";import{c as me,a as J,F as ve}from"./form-validator-2f00ec67.js";import{c as be,f as fe}from"./functions-028ffd6d.js";import"./exercise.service-4fe4f098.js";import"./base.service-02c1db1f.js";import"./paymentmethod.service-105d0201.js";import"./tax.service-f18ef59d.js";import"./index-c36f6e5b.js";import"./suppliers.service-c2e91e78.js";var te={name:"Toolbar",extends:oe,props:{"aria-labelledby":{type:String,default:null}}};const ye=["aria-labelledby"];function _e(i,v,x,c,n,e){return D(),C("div",M({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":i.ariaLabelledby},i.ptm("root")),[s("div",M({class:"p-toolbar-group-start p-toolbar-group-left"},i.ptm("start")),[O(i.$slots,"start")],16),s("div",M({class:"p-toolbar-group-center"},i.ptm("center")),[O(i.$slots,"center")],16),s("div",M({class:"p-toolbar-group-end p-toolbar-group-right"},i.ptm("end")),[O(i.$slots,"end")],16)],16,ye)}function Ie(i,v){v===void 0&&(v={});var x=v.insertAt;if(!(!i||typeof document>"u")){var c=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",x==="top"&&c.firstChild?c.insertBefore(n,c.firstChild):c.appendChild(n),n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i))}}var he=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;Ie(he);te.render=_e;const xe={class:"base_input"},Ve={class:"file-viewer"},ge={class:"file-viewer-item-type"},De={class:"file-viewer-item-actions"},we=["onClick"],Fe=["onClick"],Ae=j({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(i){const v=i,x=Y(),c=new pe,n=q(void 0),e=async()=>{n.value=await c.GetEntityFiles(v.entity,v.id)};H(async()=>{await e()});const g=async()=>{const b=document.createElement("input");b.type="file",b.onchange=async _=>{const F=_.target.files[0];if(!await c.Upload(F,v.entity,v.id)){x.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await e()},b.click()},p=async b=>{const _=await c.Download(b);be(b.originalName,_)},f=async b=>{var _=await c.Delete(b.id);if(!_){x.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await e()};return(b,_)=>{const F=w("Button");return D(),C("div",xe,[l(a(te),null,{start:T(()=>[s("h4",null,G(b.title),1)]),end:T(()=>[l(F,{size:"small",rounded:"",icon:a(S).UPLOAD,onClick:g},null,8,["icon"])]),_:1}),s("section",Ve,[(D(!0),C(se,null,le(n.value,r=>(D(),C("article",{class:"file-viewer-item",key:b.id},[s("div",ge,[r.type===0?(D(),C("i",{key:0,class:V(a(S).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):R("",!0),r.type===1?(D(),C("i",{key:1,class:V(a(S).IMAGE),style:{"font-size":"3.5rem"}},null,2)):R("",!0),s("p",null,G(r.originalName.substring(0,20)),1)]),s("div",De,[s("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:m=>p(r)},[s("i",{class:V(a(S).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,we),s("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:m=>f(r)},[s("i",{class:V(a(S).TIMES)},null,2)],8,Fe)])]))),128))])])}}});const Pe=K(Ae,[["__scopeId","data-v-dd7a228d"]]),E=i=>(ie("data-v-c1e91076"),i=i(),re(),i),Ce={key:0},Te={class:"four-columns"},Ee=E(()=>s("label",{class:"block text-900 mb-2"},"Exercici",-1)),Se=E(()=>s("label",{class:"block text-900 mb-2"},"Sèrie",-1)),$e=E(()=>s("label",{class:"block text-900 mb-2"},"Estat",-1)),ke={class:"four-columns"},Ne={class:"mt-1"},Ue=E(()=>s("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),Me={class:"mt-1"},Be={class:"mt-1"},Re=E(()=>s("label",{class:"block text-900 mb-2"},"Data Factura: ",-1)),Le={class:"mt-1"},ze=E(()=>s("label",{class:"block text-900 mb-2"},"Forma de pagament",-1)),Oe={class:"four-columns"},Ge={class:"mt-1"},je={class:"mt-1"},Ye={class:"mt-1"},qe=E(()=>s("label",{class:"block text-900 mb-2"},"IVA",-1)),He={class:"mt-1"},We={class:"four-columns"},Je={class:"mt-1"},Ke={class:"mt-1"},Qe={class:"mt-3"},Xe=j({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(i,{emit:v}){const x=i,c=Z(),n=ee(),{purchaseInvoice:e}=Q(c),g=Y(),p=me().shape({exerciceId:J().required("L'exercici es obligatori"),supplierId:J().required("El proveïdor es obligatori")}),f=q({result:!1,errors:{}}),b=()=>{const u=new ve(p);f.value=u.validate(x.purchaseInvoice)};let _=!1;H(()=>{setTimeout(()=>_=!0,1e3)});const F=async()=>{if(b(),f.value.result)v("submit",e.value);else{let u="";Object.entries(f.value.errors).forEach(t=>{u+=`${t[1].map(d=>d)}.   `}),g.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},r=()=>{var t;const u=(t=n.masterData.suppliers)==null?void 0:t.find(d=>{var I;return d.id===((I=e.value)==null?void 0:I.supplierId)});u&&(e.value.paymentMethodId=u.paymentMethodId)},m=async()=>{var t;if(_&&e.value&&e.value.baseAmount!==0){let d=0,I=0,h=0,A=0,y=0,$=0,k=0,o=0,U=0,L=0,z=0;e.value.baseAmount&&(d=parseFloat(e.value.baseAmount.toFixed(2))),e.value.transportAmount&&(I=parseFloat(e.value.transportAmount.toFixed(2))),e.value.discountPercentage&&(o=parseFloat(e.value.discountPercentage.toFixed(2))),e.value.extraTaxPercentatge&&(L=e.value.extraTaxPercentatge);var u=(t=n.masterData.taxes)==null?void 0:t.find(ae=>{var W;return ae.id===((W=e.value)==null?void 0:W.taxId)});u&&(A=parseFloat(u.percentatge.toFixed(2))),h=(d+I)*1,y=h*(A/100),z=h*(L/100),U=h+y*1-z*1,k=U*(1*o)/100,$=parseFloat((U-k).toFixed(2)),e.value.baseAmount=d,e.value.transportAmount=I,e.value.subtotal=h,e.value.taxAmount=y,e.value.grossAmount=U,e.value.netAmount=$,e.value.discountPercentage=o,e.value.discountAmount=k,e.value.extraTaxPercentatge=L,e.value.extraTaxAmount=z,e.value.purchaseInvoiceDueDates=await c.GetDueDates(e.value)}};return(u,t)=>{const d=w("Dropdown"),I=w("Calendar"),h=w("Column"),A=w("DataTable"),y=w("Button"),$=w("TabPanel"),k=w("TabView");return D(),X(k,null,{default:T(()=>[l($,{header:"Factura"},{default:T(()=>[a(e)?(D(),C("form",Ce,[s("section",Te,[l(P,{label:"Num. Fra. Intern",id:"number",modelValue:a(e).number,"onUpdate:modelValue":t[0]||(t[0]=o=>a(e).number=o),disabled:""},null,8,["modelValue"]),s("div",null,[Ee,l(d,{modelValue:a(e).exerciceId,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).exerciceId=o),editable:"",options:a(n).masterData.exercises,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),s("div",null,[Se,l(d,{modelValue:a(e).purchaseInvoiceSerieId,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).purchaseInvoiceSerieId=o),editable:"",options:a(n).masterData.series,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),s("div",null,[$e,l(d,{modelValue:a(e).purchaseInvoiceStatusId,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).purchaseInvoiceStatusId=o),editable:"",options:a(n).masterData.statuses,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),s("section",ke,[s("div",Ne,[Ue,l(d,{modelValue:a(e).supplierId,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).supplierId=o),editable:"",options:a(n).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",onChange:r,class:V(["w-full",{"p-invalid":f.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),s("div",Me,[l(P,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:a(e).supplierNumber,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).supplierNumber=o)},null,8,["modelValue"])]),s("div",Be,[Re,l(I,{id:"purchaseInvoiceDate",modelValue:a(e).purchaseInvoiceDate,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).purchaseInvoiceDate=o)},null,8,["modelValue"])]),s("div",Le,[ze,l(d,{modelValue:a(e).paymentMethodId,"onUpdate:modelValue":[t[7]||(t[7]=o=>a(e).paymentMethodId=o),t[8]||(t[8]=o=>m())],editable:"",options:a(n).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])])]),s("section",Oe,[s("div",Ge,[l(P,{type:a(N).CURRENCY,label:"Base",id:"baseAmount",modelValue:a(e).baseAmount,"onUpdate:modelValue":[t[9]||(t[9]=o=>a(e).baseAmount=o),t[10]||(t[10]=o=>m())]},null,8,["type","modelValue"])]),s("div",je,[l(P,{type:a(N).CURRENCY,label:"Ports",id:"transportAmount",modelValue:a(e).transportAmount,"onUpdate:modelValue":[t[11]||(t[11]=o=>a(e).transportAmount=o),t[12]||(t[12]=o=>m())]},null,8,["type","modelValue"])]),s("div",Ye,[qe,l(d,{modelValue:a(e).taxId,"onUpdate:modelValue":[t[13]||(t[13]=o=>a(e).taxId=o),t[14]||(t[14]=o=>m())],editable:"",options:a(n).masterData.taxes,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.taxId}])},null,8,["modelValue","options","class"])]),s("div",He,[l(P,{type:a(N).NUMERIC,label:"IRPF",id:"extraTaxPercentatge",modelValue:a(e).extraTaxPercentatge,"onUpdate:modelValue":[t[15]||(t[15]=o=>a(e).extraTaxPercentatge=o),t[16]||(t[16]=o=>m())]},null,8,["type","modelValue"])])]),s("section",We,[s("div",Je,[l(P,{type:a(N).NUMERIC,decimals:2,label:"% Dto.",id:"discountPercentage",modelValue:a(e).discountPercentage,"onUpdate:modelValue":[t[17]||(t[17]=o=>a(e).discountPercentage=o),t[18]||(t[18]=o=>m())]},null,8,["type","modelValue"])]),s("div",Ke,[l(P,{type:a(N).CURRENCY,label:"Total",id:"netAmount",modelValue:a(e).netAmount,"onUpdate:modelValue":t[19]||(t[19]=o=>a(e).netAmount=o),disabled:""},null,8,["type","modelValue"])])])])):R("",!0),s("div",Qe,[l(A,{value:a(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:T(()=>[l(h,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:T(o=>[ne(G(a(fe)(o.data.dueDate)),1)]),_:1}),l(h,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),l(y,{label:"Guardar",class:"save_button",onClick:F})]),_:1}),l($,{header:"Fitxers"},{default:T(()=>[l(Pe,{title:"Factures",entity:"PurchaseInvoice",id:a(e).id},null,8,["id"])]),_:1})]),_:1})}}});const Ze=K(Xe,[["__scopeId","data-v-c1e91076"]]),dt=j({__name:"PurchaseInvoice",setup(i){const v=q(B.EDIT),x=ue(),c=de(),n=ce(),e=ee(),g=Z(),{purchaseInvoice:p}=Q(g),f=async()=>{await g.GetById(x.params.id);let r="";p.value?(v.value=B.EDIT,r=`Factura de compra: ${p.value.number}`,p.value.purchaseInvoiceDate=new Date(p.value.purchaseInvoiceDate)):(v.value=B.CREATE,g.setNewPurchaseInvoice(x.params.id),r="Alta de factures de compra",b()),n.setMenuItem({icon:S.POUND,backButtonVisible:!0,title:r})},b=()=>{var r,m,u,t;if(p.value){const d=(r=e.masterData.exercises)==null?void 0:r.find(y=>y.name===new Date().getFullYear().toString());d&&(p.value.exerciceId=d.id);const I=(m=e.masterData.series)==null?void 0:m.find(y=>y.name==="Nacional");I&&(p.value.purchaseInvoiceSerieId=I.id);const h=(u=e.masterData.statuses)==null?void 0:u.find(y=>y.name==="Nova");h&&(p.value.purchaseInvoiceStatusId=h.id);const A=(t=e.masterData.taxes)==null?void 0:t.find(y=>y.name==="IVA 21%");A&&(p.value.taxId=A.id)}};H(async()=>{await f()});const _=Y(),F=async()=>{const r=p.value;let m=!1,u="";v.value===B.CREATE?await g.Create(r)===!0&&(m=!0,u="Factura creada correctament"):await g.Update(r)===!0&&(m=!0,u="Factura actualizada correctament"),m&&(_.add({severity:"success",summary:u,life:5e3}),c.back())};return(r,m)=>a(p)?(D(),X(Ze,{key:0,purchaseInvoice:a(p),onSubmit:F},null,8,["purchaseInvoice"])):R("",!0)}});export{dt as default};
