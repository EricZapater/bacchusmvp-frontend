import{d as _,j as k,r as E,h as x,c as C,e as c,i as m,n as V,y,k as v,l as I,a as g,s as T,F as u,v as w,u as B,z as h,o as F,m as N,P as $,C as M}from"./index-8ef16467.js";import{u as R}from"./tax-cb8ecade.js";import{c as U,a as q,d as A,b as D,F as z}from"./form-validator-167199ef.js";import"./tax.service-ec9b8391.js";import"./base.service-01d8aabb.js";const P={key:0},S={class:"two-columns"},j=c("label",{class:"block text-900 mb-2"},"Desactivada",-1),G={class:"mt-2"},L=_({__name:"FormTax",props:{tax:{}},emits:["submit","cancel"],setup(f,{emit:l}){const r=f,d=k(),o=U().shape({name:q().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),percentatge:A().required("La freqüència és obligatoria"),disabled:D().required("El camp deshabilitat és obligatori")}),t=E({result:!1,errors:{}}),p=()=>{const a=new z(o);t.value=a.validate(r.tax)},b=async()=>{if(p(),t.value.result)l("submit",r.tax);else{let a="";Object.entries(t.value.errors).forEach(e=>{a+=`${e[1].map(s=>s)}.   `}),d.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const s=x("Checkbox"),n=x("Button");return a.tax?(g(),C("form",P,[c("div",S,[m(y,{class:V(["mb-2",{"p-invalid":t.value.errors.name}]),label:"Nom",id:"name",modelValue:a.tax.name,"onUpdate:modelValue":e[0]||(e[0]=i=>a.tax.name=i)},null,8,["modelValue","class"]),m(y,{type:v(T).NUMERIC,label:"Percentatge",id:"percentatge",modelValue:a.tax.percentatge,"onUpdate:modelValue":e[1]||(e[1]=i=>a.tax.percentatge=i),class:V({"p-invalid":t.value.errors.percentatge})},null,8,["type","modelValue","class"])]),c("div",null,[c("div",null,[j,m(s,{modelValue:a.tax.disabled,"onUpdate:modelValue":e[2]||(e[2]=i=>a.tax.disabled=i),class:"w-full",binary:!0},null,8,["modelValue"])])]),c("div",G,[m(n,{label:"Guardar",onClick:b})])])):I("",!0)}}}),W=_({__name:"Tax",setup(f){const l=E(u.EDIT),r=w(),d=B(),o=R(),{tax:t}=h(o),p=async()=>{await o.fetchOne(r.params.id);let e="";t.value?(l.value=u.EDIT,e=`Impost ${t.value.name}`):(l.value=u.CREATE,o.setNew(r.params.id),e="Alta d'impost"),d.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:e})};F(async()=>{await p()});const b=k(),a=async()=>{const e=t.value;let s=!1,n="";l.value===u.CREATE?(s=await o.create(e),n="Impost creat correctament"):(s=await o.update(e.id,e),n="Impost actualizat correctament"),s&&(b.add({severity:"success",summary:n,life:5e3}),M.back())};return(e,s)=>v(t)?(g(),N(L,{key:0,tax:v(t),onSubmit:a},null,8,["tax"])):I("",!0)}});export{W as default};
