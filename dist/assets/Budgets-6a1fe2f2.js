import{_ as H}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-567cb20c.js";import{_ as Y}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-9a22dcd7.js";import{d as z,g as Q,j as J,x as K,u as W,r as I,E as X,o as Z,P as m,h as f,c as k,i as s,w as l,k as r,G as ee,a as N,e as u,C as v,D as y,n as te,l as se}from"./index-b40c6ded.js";import{u as ae}from"./reference-c2502c33.js";import{u as oe}from"./customers-bd42da68.js";import{u as ie}from"./lifecycle-5c03d44c.js";import{a as P,f as B,g as re}from"./functions-79f2dbc4.js";import{u as ce}from"./masterData-115fcf9b.js";import{u as ne}from"./budget-49c6bf56.js";import"./form-validator-f8953ae6.js";import"./_commonjsHelpers-725317a4.js";import"./reference.service-9da581c8.js";import"./base.service-265c7e5a.js";import"./index-21bedaf3.js";import"./v4-a960c1f4.js";import"./index-fe53ec88.js";const le={class:"flex flex-wrap align-items-center justify-content-between gap-2"},de={class:"datatable-filter"},ue={class:"filter-field"},me={class:"filter-field"},fe=u("label",{class:"block text-900 mb-2"},"Client",-1),pe={class:"datatable-buttons"},_e=["onClick"],Te=z({__name:"Budgets",setup(be){const S=Q(),x=J(),E=K(),c=W(),g=ce(),p=ne(),R=ae(),w=oe(),D=ie(),_=I({customerId:void 0,referenceId:void 0}),d=X({visible:!1,title:"Crear pressupost",closable:!0,position:"center",modal:!0});Z(async()=>{D.fetchOneByName("Budget"),R.fetchReferences(),w.fetchCustomers(),await g.fetchMasterData(),T(),await h(),c.setMenuItem({icon:m.APPLE,title:"Pressupostos"})});const T=()=>{var o;const a=new Date().getFullYear().toString(),e=(o=g.exercises)==null?void 0:o.find(i=>i.name===a);e&&(c.exercisePicker.exercise=e,c.exercisePicker.dates=[new Date(c.exercisePicker.exercise.startDate),new Date(c.exercisePicker.exercise.endDate)])},F=()=>{c.cleanExercisePicker(),_.value.customerId=void 0},b=I({}),V=()=>({id:re(),customerId:"",exerciseId:"",date:new Date}),q=()=>{b.value=V(),d.visible=!0},h=async()=>{if(c.exercisePicker.dates){const a=P(c.exercisePicker.dates[0]),e=P(c.exercisePicker.dates[1]);await p.GetFiltered(a,e,_.value.customerId)}else x.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},L=a=>{var o,i;const e=(i=(o=D.lifecycle)==null?void 0:o.statuses)==null?void 0:i.find(n=>n.id===a);return e?e.name:""},O=a=>{var o;const e=(o=w.customers)==null?void 0:o.find(i=>i.id===a);return e?e.comercialName:""},M=async()=>{d.visible=!1,await p.Create(b.value)&&S.push({path:`/budget/${b.value.id}`})},U=a=>{a.originalEvent.target.className.includes("grid_delete_column_button")||S.push({path:`/budget/${a.data.id}`})},$=(a,e)=>{E.require({message:"Està segur que vol eliminar el pressupost?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await p.Delete(e.id)&&(x.add({severity:"success",summary:"Eliminada",life:3e3}),await h())}})};return(a,e)=>{const o=f("Dropdown"),i=f("Button"),n=f("Column"),j=f("DataTable"),A=f("Dialog");return N(),k(ee,null,[s(j,{value:r(p).budgets,class:"small-datatable",tableStyle:"min-width: 100%","sort-field":"salesOrderNumber","sort-mode":"single","sort-order":1,scrollable:"",scrollHeight:"80vh",onRowClick:U},{header:l(()=>[u("div",le,[u("div",de,[u("div",ue,[s(H,{exercises:r(g).exercises,onRangeSelected:h},null,8,["exercises"])]),u("div",me,[fe,s(o,{modelValue:_.value.customerId,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value.customerId=t),editable:"",options:r(w).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full",showClear:""},null,8,["modelValue","options"])])]),u("div",pe,[s(i,{class:"datatable-button mr-2",icon:r(m).FILTER,rounded:"",raised:"",onClick:h},null,8,["icon"]),s(i,{class:"datatable-button mr-2",icon:r(m).FILTER_SLASH,rounded:"",raised:"",onClick:F},null,8,["icon"]),s(i,{icon:r(m).PLUS,rounded:"",raised:"",onClick:q},null,8,["icon"])])])]),default:l(()=>[s(n,{field:"number",header:"Número",style:{width:"10%"}}),s(n,{field:"date",header:"Data",style:{width:"15%"},sortable:""},{body:l(t=>[v(y(r(B)(t.data.date)),1)]),_:1}),s(n,{header:"Client",style:{width:"20%"}},{body:l(t=>[v(y(O(t.data.customerId)),1)]),_:1}),s(n,{header:"Estat",style:{width:"20%"}},{body:l(t=>[v(y(L(t.data.statusId)),1)]),_:1}),s(n,{field:"acceptanceDate",header:"Data d'acceptació",style:{width:"15%"}},{body:l(t=>[v(y(t.data.acceptanceDate?r(B)(t.data.acceptanceDate):""),1)]),_:1}),s(n,{field:"deliveryDays",header:"Dies d'entrega",style:{width:"10%"}}),s(n,{style:{width:"5%"}},{body:l(t=>{var C;return[t.data.statusId===((C=r(D).lifecycle)==null?void 0:C.initialStatusId)?(N(),k("i",{key:0,class:te([r(m).TIMES,"grid_delete_column_button"]),onClick:G=>$(G,t.data)},null,10,_e)):se("",!0)]}),_:1})]),_:1},8,["value"]),s(A,{visible:d.visible,"onUpdate:visible":e[1]||(e[1]=t=>d.visible=t),header:d.title,closable:d.closable,modal:d.modal},{default:l(()=>[s(Y,{"create-request":b.value,onSubmit:M},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Te as default};
