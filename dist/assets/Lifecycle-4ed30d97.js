import{d as $,h as y,m as I,w as g,a as E,e as c,i as p,k as f,P as A,c as D,n as S,l as V,C as H,D as J,j as R,r as k,y as L,F as T,g as K,v as Q,u as W,z as X,G as Y,o as Z,H as ee,f as te}from"./index-46043a45.js";import{g as U}from"./functions-1a09c2e2.js";import{c as F,a as B,F as M}from"./form-validator-591216ce.js";import{u as se}from"./lifecycle-03facc4e.js";import"./v4-a960c1f4.js";import"./index-7b8f1609.js";import"./base.service-1c5fc4fe.js";const ae={class:"flex flex-wrap align-items-center justify-content-between gap-2"},oe=c("span",{class:"text-xl text-900 font-bold"},"Estats",-1),ne=["onClick"],ie=$({__name:"TableStatuses",props:{lifecycleId:{},statuses:{},transitions:{}},emits:["add","edit","delete"],setup(w,{emit:u}){const r=w,m=n=>{let e=!1;return r.transitions&&(e=r.transitions.filter(t=>t.statusId===n.id||t.statusToId===n.id).length>0),console.log("hasTransitions",n,r.transitions,e),e},b=()=>{const n={id:U(),lifecycleId:r.lifecycleId,name:"",disabled:!1,transitions:[]};u("add",n)},s=n=>{n.originalEvent.target.className.includes("grid_delete_column_button")||u("edit",n.data)},i=(n,e)=>{u("delete",e)};return(n,e)=>{const t=y("Button"),d=y("Column"),l=y("DataTable");return E(),I(l,{onRowClick:s,value:r.statuses,tableStyle:"min-width: 100%"},{header:g(()=>[c("div",ae,[oe,p(t,{icon:f(A).PLUS,rounded:"",raised:"",onClick:b},null,8,["icon"])])]),default:g(()=>[p(d,{field:"name",header:"Nom",style:{width:"75%"}}),p(d,{style:{width:"25%"}},{body:g(_=>[m(_.data)?V("",!0):(E(),D("i",{key:0,class:S([f(A).TIMES,"grid_delete_column_button"]),onClick:v=>i(v,_.data)},null,10,ne))]),_:1})]),_:1},8,["value"])}}}),le={class:"flex flex-wrap align-items-center justify-content-between gap-2"},re=c("span",{class:"text-xl text-900 font-bold"},"Transicions",-1),de=["onClick"],ce=$({__name:"TableStatusTransitions",props:{statuses:{},transitions:{}},emits:["add","edit","delete"],setup(w,{emit:u}){const r=w,m=n=>{var d,l;const e=(d=r.statuses)==null?void 0:d.find(_=>_.id===n.statusId),t=(l=r.statuses)==null?void 0:l.find(_=>_.id===n.statusToId);return e&&t?`${e.name} > ${t.name}`:""},b=()=>{const n={id:U(),statusId:"",statusToId:"",name:""};u("add",n)},s=n=>{n.originalEvent.target.className.includes("grid_delete_column_button")||u("edit",n.data)},i=(n,e)=>{u("delete",e)};return(n,e)=>{const t=y("Button"),d=y("Column"),l=y("DataTable");return E(),I(l,{onRowClick:s,value:r.transitions,tableStyle:"min-width: 100%"},{header:g(()=>[c("div",le,[re,p(t,{icon:f(A).PLUS,rounded:"",raised:"",onClick:b},null,8,["icon"])])]),default:g(()=>[p(d,{field:"name",header:"Nom",style:{width:"25%"}}),p(d,{header:"Transició",style:{width:"50%"}},{body:g(_=>[H(J(m(_.data)),1)]),_:1}),p(d,{style:{width:"25%"}},{body:g(_=>[c("i",{class:S([f(A).TIMES,"grid_delete_column_button"]),onClick:v=>i(v,_.data)},null,10,de)]),_:1})]),_:1},8,["value"])}}}),ue={key:0},me={class:"three-columns"},pe=c("label",{class:"block text-900 mb-2"},"Desactivat",-1),fe=$({__name:"FormLifecycle",props:{lifecycle:{}},emits:["submit","cancel"],setup(w,{emit:u}){R(),F().shape({name:B().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:B().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters")});const r=k({result:!1,errors:{}});return(m,b)=>{const s=y("Checkbox");return m.lifecycle?(E(),D("form",ue,[c("div",me,[p(L,{class:S(["mb-2",{"p-invalid":r.value.errors.name}]),label:"Nom",id:"name",modelValue:m.lifecycle.name,"onUpdate:modelValue":b[0]||(b[0]=i=>m.lifecycle.name=i)},null,8,["modelValue","class"]),p(L,{class:S(["mb-2",{"p-invalid":r.value.errors.description}]),label:"Descripció",id:"description",modelValue:m.lifecycle.description,"onUpdate:modelValue":b[1]||(b[1]=i=>m.lifecycle.description=i)},null,8,["modelValue","class"]),c("div",null,[pe,p(s,{modelValue:m.lifecycle.disabled,"onUpdate:modelValue":b[2]||(b[2]=i=>m.lifecycle.disabled=i),class:"w-full",binary:!0},null,8,["modelValue"])])])])):V("",!0)}}}),_e={class:"two-columns"},be={class:"mb-4"},ve=c("label",{class:"block text-900 mb-2"},"Deshabilitat",-1),ye=$({__name:"FormStatus",props:{formAction:{},status:{}},emits:["submit"],setup(w,{emit:u}){const r=w,m=R(),b=F().shape({name:B().required("El nom és obligatori")}),s=k({result:!1,errors:{}}),i=()=>{const e=new M(b);s.value=e.validate(r.status)},n=async()=>{if(i(),s.value.result)u("submit",r.status);else{let e="";Object.entries(s.value.errors).forEach(t=>{e+=`${t[1].map(d=>d)}.   `}),m.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const d=y("BaseInput"),l=y("Checkbox"),_=y("Button");return E(),D("form",null,[c("section",_e,[p(d,{class:S(["mb-2",{"p-invalid":s.value.errors.baseAmount}]),label:"Nom",modelValue:e.status.name,"onUpdate:modelValue":t[0]||(t[0]=v=>e.status.name=v)},null,8,["modelValue","class"]),c("div",be,[ve,p(l,{modelValue:e.status.disabled,"onUpdate:modelValue":t[1]||(t[1]=v=>e.status.disabled=v),binary:!0},null,8,["modelValue"])])]),p(_,{label:"Confirmar",onClick:n,style:{float:"right"}})])}}}),Te={class:"two-columns"},Ee=c("label",{class:"block text-900 mb-2"},"Origen",-1),we={class:"mb-4"},Ce=c("label",{class:"block text-900 mb-2"},"Destí",-1),he=$({__name:"FormStatusTransition",props:{formAction:{},transition:{},statuses:{}},emits:["submit"],setup(w,{emit:u}){const r=w,m=R(),b=F().shape({name:B().required("El nom és obligatori")}),s=k({result:!1,errors:{}}),i=()=>{const e=new M(b);s.value=e.validate(r.transition)},n=async()=>{if(r.transition.statusId===r.transition.statusToId){m.add({severity:"warn",summary:"Formulari inválid",detail:"Els estats d'origen i destí han de ser diferents",life:5e3});return}if(i(),s.value.result)u("submit",r.transition);else{let e="";Object.entries(s.value.errors).forEach(t=>{e+=`${t[1].map(d=>d)}.   `}),m.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const d=y("BaseInput"),l=y("Dropdown"),_=y("Button");return E(),D("form",null,[p(d,{class:S(["mb-2",{"p-invalid":s.value.errors.name}]),label:"Nom",modelValue:e.transition.name,"onUpdate:modelValue":t[0]||(t[0]=v=>e.transition.name=v)},null,8,["modelValue","class"]),c("section",Te,[c("div",null,[Ee,p(l,{modelValue:e.transition.statusId,"onUpdate:modelValue":t[1]||(t[1]=v=>e.transition.statusId=v),editable:"",options:e.statuses,optionValue:"id",optionLabel:"name"},null,8,["modelValue","options"])]),c("div",we,[Ce,p(l,{modelValue:e.transition.statusToId,"onUpdate:modelValue":t[2]||(t[2]=v=>e.transition.statusToId=v),editable:"",options:e.statuses,optionValue:"id",optionLabel:"name"},null,8,["modelValue","options"])])]),p(_,{label:"Confirmar",onClick:n,style:{float:"right"}})])}}}),ge={class:"container"},Ie={class:"section_lifecycle"},Ve={class:"section_status"},ke={class:"section_status_list"},Se={class:"section_statustransition_list"},$e=$({__name:"Lifecycle",setup(w){const u=k(T.EDIT),r=K(),m=Q(),b=W(),s=se(),{lifecycle:i,transitions:n}=X(s),e=k(T.CREATE),t=k(void 0),d=k(void 0),l=Y({visible:!1,title:"",closable:!0,position:"bottom",modal:!0}),_=async()=>{await s.fetchOne(m.params.id);let a="";i.value?(u.value=T.EDIT,a=`Cicle de vida ${i.value.name}`):(u.value=T.CREATE,s.setNew(m.params.id),a="Alta cicle de vida"),b.setMenuItem({icon:A.REFRESH,backButtonVisible:!0,title:a})};Z(async()=>{await _()});const v=(a,o)=>{console.log("openStatus",a),u.value!==T.CREATE&&(e.value=a,t.value=o,d.value=void 0,l.visible=!0,l.title="Introducció d'estats")},j=async a=>{if(n.value.find(h=>h.statusId===a.id||h.statusToId===a.id)){N.add({severity:"warn",summary:"Estat dependent",detail:`L'estat ${a.name} forma part d'una transició`,life:5e3});return}await s.deleteStatus(a.id)},O=async a=>{let o;e.value==T.CREATE?o=s.createStatus(a):o=s.updateStatus(a.id,a),l.visible=!await o},x=(a,o)=>{u.value!==T.CREATE&&(e.value=a,t.value=void 0,d.value=o,l.visible=!0,l.title="Introducció de transicions")},q=async a=>await s.deleteTransition(a.id),z=async a=>{let o;e.value==T.CREATE?o=s.createTransition(a):o=s.updateTransition(a.id,a),l.visible=!await o},N=R(),P=async()=>{const a=i.value;let o=!1,h="";u.value===T.CREATE?(o=await s.create(a),h="Cicle de vida creat correctament"):(o=await s.update(a.id,a),h="Cicle de vida actualizat correctament"),o&&(N.add({severity:"success",summary:h,life:5e3}),u.value===T.EDIT?r.back():await _())};return(a,o)=>{const h=y("Button"),G=y("Dialog");return E(),D(ee,null,[c("main",ge,[p(h,{label:"Guardar",class:"grid_add_row_button",onClick:P}),c("section",Ie,[f(i)?(E(),I(fe,{key:0,lifecycle:f(i)},null,8,["lifecycle"])):V("",!0)]),c("section",Ve,[c("div",ke,[f(i)?(E(),I(ie,{key:0,"lifecycle-id":f(i).id,statuses:f(i).statuses,transitions:f(s).transitions,onAdd:o[0]||(o[0]=C=>v(f(T).CREATE,C)),onEdit:o[1]||(o[1]=C=>v(f(T).EDIT,C)),onDelete:j},null,8,["lifecycle-id","statuses","transitions"])):V("",!0)]),c("div",Se,[f(i)?(E(),I(ce,{key:0,statuses:f(i).statuses,transitions:f(s).transitions,onAdd:o[2]||(o[2]=C=>x(f(T).CREATE,C)),onEdit:o[3]||(o[3]=C=>x(f(T).EDIT,C)),onDelete:q},null,8,["statuses","transitions"])):V("",!0)])])]),p(G,{visible:l.visible,"onUpdate:visible":o[4]||(o[4]=C=>l.visible=C),header:l.title,closable:l.closable,modal:l.modal},{default:g(()=>[t.value?(E(),I(ye,{key:0,status:t.value,formAction:e.value,onSubmit:O},null,8,["status","formAction"])):V("",!0),d.value?(E(),I(he,{key:1,transition:d.value,statuses:f(i).statuses,formAction:e.value,onSubmit:z},null,8,["transition","statuses","formAction"])):V("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}});const Le=te($e,[["__scopeId","data-v-46873134"]]);export{Le as default};
