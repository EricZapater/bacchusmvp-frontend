import{u as H,_ as ee}from"./productionpart-ee9d07a6.js";import{_ as re}from"./DropdownReference.vue_vue_type_script_setup_true_lang-81ba6276.js";import{c as te,d as Q,a as j,F as oe}from"./form-validator-f8953ae6.js";import{d as q,j as z,r as B,h as _,c as R,e as o,i as r,y as F,k as p,n as O,l as C,a as V,s as A,E as G,x as ae,w as s,P as W,C as g,D,m as $,G as J,K as se,v as le,g as de,u as ne,z as ie,o as ue,p as ce,b as me,f as pe}from"./index-555c6e5a.js";import{u as L}from"./lifecycle-5c68e723.js";import{_ as fe,a as ke}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-46ab2685.js";import{g as K,e as we,f as be,c as ye}from"./functions-79f2dbc4.js";import{u as x}from"./plantmodel-978ee1cf.js";import{u as _e}from"./reference-82dd30df.js";import{u as he}from"./workorder-b497e7ed.js";import"./index-dda8c344.js";import"./base.service-fff6fc35.js";import"./_commonjsHelpers-725317a4.js";import"./index-8611458c.js";import"./reference.service-fdfd63b3.js";import"./v4-a960c1f4.js";const ve={key:0},Ie=o("br",null,null,-1),ge={class:"four-columns"},Pe=o("label",{class:"block text-900 mb-2"},"Data Prevista",-1),Te={class:"four-columns"},Ve=o("label",{class:"block text-900 mb-2"},"Data Inici",-1),De=o("label",{class:"block text-900 mb-2"},"Data Fi",-1),Se=o("label",{class:"block text-900 mb-2"},"Comentari Fabricació",-1),Oe=q({__name:"FormWorkorder",props:{workorder:{}},emits:["submit","cancel"],setup(P,{emit:T}){const v=P;L();const h=z(),b=te().shape({plannedQuantity:Q().min(1,"La quantitat ha de ser superior a 0").required("La quanitat és obligatoria"),referenceId:j().required("La referència és obligatoria"),order:Q().required("L'ordre és obligatori"),plannedDate:j().required("La data prevista és obligatoria")}),l=B({result:!1,errors:{}}),y=()=>{const e=new oe(b);l.value=e.validate(v.workorder)},d=async()=>{if(y(),l.value.result)T("submit",v.workorder);else{let e="";Object.entries(l.value.errors).forEach(t=>{e+=`${t[1].map(f=>f)}.   `}),h.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const f=_("Button"),k=_("Calendar"),I=_("Textarea");return e.workorder?(V(),R("form",ve,[o("div",null,[r(f,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:d}),Ie]),o("section",ge,[o("div",null,[r(F,{label:"Codi",modelValue:e.workorder.code,"onUpdate:modelValue":t[0]||(t[0]=a=>e.workorder.code=a),disabled:""},null,8,["modelValue"])]),o("div",null,[r(re,{label:"Referència",modelValue:e.workorder.referenceId,"onUpdate:modelValue":t[1]||(t[1]=a=>e.workorder.referenceId=a),fullName:!0,disabled:""},null,8,["modelValue"])]),o("div",null,[r(F,{type:p(A).NUMERIC,label:"Quantitat",modelValue:e.workorder.plannedQuantity,"onUpdate:modelValue":t[2]||(t[2]=a=>e.workorder.plannedQuantity=a),class:O({"p-invalid":l.value.errors.plannedQuantity})},null,8,["type","modelValue","class"])]),o("div",null,[Pe,r(k,{modelValue:e.workorder.plannedDate,"onUpdate:modelValue":t[3]||(t[3]=a=>e.workorder.plannedDate=a),dateFormat:"dd/mm/yy",class:O(["mt-2",{"p-invalid":l.value.errors.plannedDate}])},null,8,["modelValue","class"])])]),o("section",Te,[o("div",null,[r(fe,{label:"Estat",modelValue:e.workorder.statusId,"onUpdate:modelValue":t[4]||(t[4]=a=>e.workorder.statusId=a),class:O({"p-invalid":l.value.errors.statusId})},null,8,["modelValue","class"])]),o("div",null,[Ve,r(k,{modelValue:e.workorder.startTime,"onUpdate:modelValue":t[5]||(t[5]=a=>e.workorder.startTime=a),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),o("div",null,[De,r(k,{modelValue:e.workorder.endTime,"onUpdate:modelValue":t[6]||(t[6]=a=>e.workorder.endTime=a),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),o("div",null,[r(F,{type:p(A).NUMERIC,label:"Ordre",modelValue:e.workorder.order,"onUpdate:modelValue":t[7]||(t[7]=a=>e.workorder.order=a),class:O({"p-invalid":l.value.errors.plannedorderQuantity})},null,8,["type","modelValue","class"])])]),o("div",null,[Se,r(I,{class:"w-full",modelValue:e.workorder.comment,"onUpdate:modelValue":t[8]||(t[8]=a=>e.workorder.comment=a)},null,8,["modelValue"])])])):C("",!0)}}}),Ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},$e=o("span",{class:"text-xl text-900 font-bold"},"Fases",-1),Be=["onClick"],We=q({__name:"TableWorkorderPhases",props:{workorder:{},workorderPhases:{}},emits:["add","edit","delete"],setup(P,{emit:T}){const v=P,h=G({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),b=ae(),l=x(),y=L(),d=n=>{var c;if(!l.workcenterTypes)return"";const i=(c=l.workcenterTypes)==null?void 0:c.find(u=>n===u.id);return i?i.name:""},e=n=>{var c;if(!l.workcenters)return"";const i=(c=l.workcenters)==null?void 0:c.find(u=>n===u.id);return i?i.name:""},t=n=>{var c;if(!l.operatorTypes)return"";const i=(c=l.operatorTypes)==null?void 0:c.find(u=>n===u.id);return i?i.name:""},f=n=>{var c;if(!y.lifecycle||!y.lifecycle.statuses)return"";const i=(c=y.lifecycle.statuses)==null?void 0:c.find(u=>n===u.id);return i?i.name:""},k=B({}),I=()=>{k.value={id:K(),workOrderId:v.workorder.id,disabled:!1,code:((v.workorder.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,statusId:"",startTime:null,endTime:null,workOrderPhaseDetails:[],workOrderPhaseBillOfMaterials:[]},h.visible=!0},a=n=>{h.visible=!1,T("add",n)},N=n=>{n.originalEvent.target.className.includes("grid_delete_column_button")||T("edit",n.data)},E=(n,i)=>{b.require({target:n.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{T("delete",i)}})};return(n,i)=>{const c=_("Button"),u=_("Column"),U=_("BooleanColumn"),m=_("DataTable"),S=_("Dialog");return V(),R(J,null,[r(m,{onRowClick:N,value:n.workorderPhases,tableStyle:"min-width: 100%"},{header:s(()=>[o("div",Ce,[$e,r(c,{icon:p(W).PLUS,rounded:"",raised:"",onClick:I},null,8,["icon"])])]),default:s(()=>[r(u,{field:"code",header:"Codi",style:{width:"10%"}}),r(u,{field:"description",header:"Descripció",style:{width:"15%"}}),r(u,{header:"Tipus de màquina",style:{width:"15%"}},{body:s(w=>[g(D(d(w.data.workcenterTypeId)),1)]),_:1}),r(u,{header:"Màquina preferida",style:{width:"15%"}},{body:s(w=>[g(D(e(w.data.preferredWorkcenterId)),1)]),_:1}),r(u,{header:"Tipus d'operari",style:{width:"15%"}},{body:s(w=>[g(D(t(w.data.operatorTypeId)),1)]),_:1}),r(u,{header:"Estat",style:{width:"15%"}},{body:s(w=>[g(D(f(w.data.statusId)),1)]),_:1}),r(u,{header:"Extern",style:{width:"5%"}},{body:s(w=>[r(U,{value:w.data.isExternalWork},null,8,["value"])]),_:1}),r(u,{style:{width:"5%"}},{body:s(w=>[o("i",{class:O([p(W).TIMES,"grid_delete_column_button"]),onClick:M=>E(M,w.data)},null,10,Be)]),_:1})]),_:1},8,["value"]),r(S,{visible:h.visible,"onUpdate:visible":i[0]||(i[0]=w=>h.visible=w),header:h.title,closable:h.closable,modal:h.modal},{default:s(()=>[k.value?(V(),$(ke,{key:0,workorder:n.workorder,phase:k.value,onSubmit:a},null,8,["workorder","phase"])):C("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),qe=q({__name:"TableProductionParts",setup(P){const T=H(),v=x(),h=b=>{if(!b)return"";if(b.workOrderPhase&&b.workOrderPhaseDetail){const l=v.getMachineStatusNameById(b.workOrderPhaseDetail.machineStatusId);return`(${b.workOrderPhase.code}) ${b.workOrderPhase.description} - ${l}`}};return(b,l)=>{const y=_("Column"),d=_("DataTable");return V(),$(d,{value:p(T).productionParts,class:"p-datatable-sm",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"40vh"},{header:s(()=>[se(b.$slots,"header")]),empty:s(()=>[g(" No s'han trobat tiquets. ")]),loading:s(()=>[g(" Carregant tiquets. Si us plau espera. ")]),default:s(()=>[r(y,{field:"operatorId",header:"Operari",style:{width:"15%"}},{body:s(e=>[g(D(p(v).getOperatorNameById(e.data.operatorId)),1)]),_:1}),r(y,{field:"workcenterId",header:"Màquina",style:{width:"20%"}},{body:s(e=>[g(D(p(v).getWorkcenterNameById(e.data.workcenterId)),1)]),_:1}),r(y,{field:"workOrderPhaseId",header:"Fase/Estat",style:{width:"20%"}},{body:s(e=>[g(D(h(e.data)),1)]),_:1}),r(y,{field:"date",header:"Data",style:{width:"15%"}},{body:s(e=>[g(D(p(we)(e.data.date)),1)]),_:1}),r(y,{field:"quantity",header:"Quantitat",style:{width:"15%"}}),r(y,{field:"time",header:"Temps",style:{width:"15%"}})]),_:3},8,["value"])}}}),Ne=P=>(ce("data-v-ba14fff5"),P=P(),me(),P),Ee={class:"main"},Ue={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Me=Ne(()=>o("span",{class:"text-xl text-900 font-bold"},"Hores",-1)),Fe=q({__name:"Workorder",setup(P){const T=le(),v=de(),h=ne(),b=z(),l=L(),y=_e(),d=he(),e=x(),t=H(),{workorder:f}=ie(d),k=B(""),I=G({visible:!1,title:"Crear tíquet de producció",closable:!0,position:"center",modal:!0});ue(async()=>{k.value=T.params.id,d.detailedWorkOrders=void 0,await a();let m="";m="Ordre de fabricació",f.value&&(m=`${m} ${f.value.code}`),h.setMenuItem({icon:W.BUILDING,backButtonVisible:!0,title:m})});const a=async()=>{await y.fetchReferencesByModule("sales"),await d.fetchOne(k.value),e.fetchActiveModel(),l.fetchOneByName("WorkOrder"),t.fetchByWorkOrderId(k.value),d.workorder&&(d.workorder.plannedDate=be(d.workorder.plannedDate))},N=async m=>{d.workorder&&(d.workorder.plannedDate=ye(d.workorder.plannedDate)),await d.update(k.value,m)&&await a()},E=async m=>{await d.createPhase(m)?v.push({path:`/workorder/${k.value}/phase/${m.id}`}):b.add({severity:"error",summary:"Error al crear la fase",detail:"Revisi el log per a més informació"})},n=m=>{v.push({path:`/workorder/${k.value}/phase/${m.id}`})},i=async m=>{await d.deletePhase(m.id)},c=B({}),u=()=>{c.value={id:K(),workOrderId:k.value,workOrderPhaseId:"",workOrderPhaseDetailId:"",operatorId:"",workcenterId:"",time:0,quantity:0,date:new Date},f.value&&d.fetchByWorkOrderId(f.value.id),I.visible=!0},U=async()=>{I.visible=!1,await t.create(c.value)&&t.fetchByWorkOrderId(k.value)};return(m,S)=>{const w=_("TabPanel"),M=_("Button"),X=_("TabView"),Y=_("Dialog");return V(),R(J,null,[o("header",null,[p(f)?(V(),$(Oe,{key:0,workorder:p(f),onSubmit:N},null,8,["workorder"])):C("",!0)]),o("main",Ee,[r(X,null,{default:s(()=>[r(w,{header:"Fases"},{default:s(()=>[p(f)&&p(f).phases?(V(),$(We,{key:0,workorder:p(f),workorderPhases:p(f).phases,onAdd:E,onEdit:n,onDelete:i},null,8,["workorder","workorderPhases"])):C("",!0)]),_:1}),r(w,{header:"Hores"},{default:s(()=>[p(t).productionParts?(V(),$(qe,{key:0,productionParts:p(t).productionParts},{header:s(()=>[o("div",Ue,[Me,r(M,{icon:p(W).PLUS,rounded:"",raised:"",onClick:u},null,8,["icon"])])]),_:1},8,["productionParts"])):C("",!0)]),_:1})]),_:1})]),r(Y,{visible:I.visible,"onUpdate:visible":S[0]||(S[0]=Z=>I.visible=Z),header:I.title,closable:I.closable,modal:I.modal},{default:s(()=>[r(ee,{productionPart:c.value,"avoid-work-order-refresh":!0,onSubmit:U},null,8,["productionPart"])]),_:1},8,["visible","header","closable","modal"])],64)}}});const tr=pe(Fe,[["__scopeId","data-v-ba14fff5"]]);export{tr as default};
