import{u as M}from"./useconfirm.esm-4982caff.js";import{u as L}from"./usetoast.esm-82b2df9e.js";import{u as T}from"./vue-router-b024814c.js";import{j as E,u as O,k as R,M as U,P as I,f as c,c as j,h as s,w as d,l as u,o as G,e as i,a0 as h,t as _,q as J,s as $}from"./index-2bfc80b2.js";import{u as q,a as A}from"./purchaseInvoices-e022a5b2.js";import{a as f,f as b}from"./functions-028ffd6d.js";import{v as H}from"./v4-a960c1f4.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./exercise.service-65855d63.js";import"./base.service-8b4a1a4e.js";import"./paymentmethod.service-1ada7ddf.js";import"./tax.service-2ace897f.js";import"./index-78dd0e83.js";import"./suppliers.service-82e016ae.js";const S=p=>(J("data-v-c22d8d14"),p=p(),$(),p),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Y={class:"datatable-filter"},z={class:"filter-field"},W=S(()=>i("label",{class:"block text-900 mb-2"},"Període",-1)),X={class:"filter-field"},Z=S(()=>i("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),ee={class:"datatable-buttons"},w="temges.purchaseinvoice.filter",te=E({__name:"PurchaseInvoices",setup(p){const N=L();M();const y=T(),P=O(),m=q(),D=A(),t=R({dates:void 0,supplierId:void 0});U(async()=>{await m.fetchMasterData();const e=localStorage.getItem(w);if(e!==null)t.value=JSON.parse(e),t.value.dates&&(t.value.dates[0]=new Date(t.value.dates[0]),t.value.dates[1]=new Date(t.value.dates[1])),await g();else{let a=new Date,r=new Date;a.setDate(r.getDate()-30);const l=f(a),v=f(r);await D.GetFiltered(l,v)}P.setMenuItem({icon:I.MONEY_BILL,text:"Factures de compra"})});const g=async()=>{if(t.value.dates){const e=f(t.value.dates[0]),a=f(t.value.dates[1]);await D.GetFiltered(e,a,void 0,void 0,t.value.supplierId),localStorage.setItem(w,JSON.stringify(t.value))}else N.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},C=e=>{var r;const a=(r=m.masterData.suppliers)==null?void 0:r.find(l=>l.id===e);return a?a.comercialName:""},x=e=>{var r;const a=(r=m.masterData.statuses)==null?void 0:r.find(l=>l.id===e);return a?a.name:""},V=e=>e.purchaseInvoiceDueDates?e.purchaseInvoiceDueDates.length===0?b(e.purchaseInvoiceDate):b(e.purchaseInvoiceDueDates[e.purchaseInvoiceDueDates.length-1].dueDate):"",B=()=>{y.push({path:`/purchaseInvoice/${H()}`})},k=e=>{console.log("edit",e.data),e.originalEvent.target.className.includes("grid_delete_column_button")||y.push({path:`/purchaseinvoice/${e.data.id}`})};return(e,a)=>{const r=c("Calendar"),l=c("Dropdown"),v=c("Button"),n=c("Column"),F=c("DataTable");return G(),j("div",null,[s(F,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"75vh",sortMode:"multiple",value:u(D).purchaseInvoices,onRowClick:k},{header:d(()=>[i("div",Q,[i("div",Y,[i("div",z,[W,s(r,{modelValue:t.value.dates,"onUpdate:modelValue":a[0]||(a[0]=o=>t.value.dates=o),selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),i("div",X,[Z,s(l,{modelValue:t.value.supplierId,"onUpdate:modelValue":a[1]||(a[1]=o=>t.value.supplierId=o),editable:"",options:u(m).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),i("div",ee,[s(v,{class:"datatable-button",icon:u(I).FILTER,rounded:"",raised:"",onClick:g},null,8,["icon"]),s(v,{icon:u(I).PLUS,rounded:"",raised:"",onClick:B},null,8,["icon"])])])]),default:d(()=>[s(n,{field:"number",header:"Número",sortable:!0,style:{width:"10%"}}),s(n,{header:"Proveïdor",style:{width:"15%"}},{body:d(o=>[h(_(C(o.data.supplierId)),1)]),_:1}),s(n,{header:"Num Fra. Proveïdor",style:{width:"12%"},field:"supplierNumber"}),s(n,{header:"Estat",style:{width:"15%"}},{body:d(o=>[h(_(x(o.data.purchaseInvoiceStatusId)),1)]),_:1}),s(n,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:d(o=>[h(_(u(b)(o.data.purchaseInvoiceDate)),1)]),_:1}),s(n,{header:"Venciment",style:{width:"15%"}},{body:d(o=>[h(_(V(o.data)),1)]),_:1}),s(n,{field:"baseAmount",header:"Import Base",style:{width:"15%"}})]),_:1},8,["value"])])}}});const _e=K(te,[["__scopeId","data-v-c22d8d14"]]);export{_e as default};
