import{_ as M}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-3d658f8a.js";import{d as R,j as $,x as j,g as q,u as Y,r as A,o as H,P as p,h as v,c as x,i as s,w as n,k as l,a as w,e as u,C as h,D as f,n as O,l as U}from"./index-9ee31eec.js";import{u as z,a as G}from"./purchaseInvoices-4531cd05.js";import{a as k,f as I}from"./functions-afe9fe15.js";import{v as J}from"./v4-a960c1f4.js";import"./index-e87db629.js";import"./base.service-aa9daa2d.js";import"./reference.service-8d98e13b.js";import"./index-d9be8c9b.js";import"./suppliers.service-57b3f8a5.js";const K={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Q={class:"datatable-filter"},W={class:"filter-field"},X={class:"filter-field"},Z=u("label",{class:"block text-900 mb-2"},"Proveïdor",-1),ee={class:"datatable-buttons"},te=["onClick"],ae="temges.purchaseinvoice.filter",he=R({__name:"PurchaseInvoices",setup(se){const b=$(),S=j(),y=q(),o=Y(),d=z(),D=G(),m=A({supplierId:void 0,exercise:void 0});H(async()=>{o.setMenuItem({icon:p.MONEY_BILL,title:"Factures de compra"}),await d.fetchMasterData(),P(),await _()});const P=()=>{var r;const e=new Date().getFullYear().toString(),t=(r=d.masterData.exercises)==null?void 0:r.find(i=>i.name===e);t&&(o.exercisePicker.exercise=t,o.exercisePicker.dates=[new Date(o.exercisePicker.exercise.startDate),new Date(o.exercisePicker.exercise.endDate)])},C=()=>{o.cleanExercisePicker(),m.value.supplierId=void 0},_=async()=>{if(o.exercisePicker.dates){const e=k(o.exercisePicker.dates[0]),t=k(o.exercisePicker.dates[1]);await D.GetFiltered(e,t,void 0,void 0,m.value.supplierId),localStorage.setItem(ae,JSON.stringify(m.value))}else b.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},N=e=>{var r;const t=(r=d.masterData.suppliers)==null?void 0:r.find(i=>i.id===e);return t?t.comercialName:""},g=e=>{var r;const t=(r=d.masterData.statuses)==null?void 0:r.find(i=>i.id===e);return t?t.name:""},E=e=>e.purchaseInvoiceDueDates?e.purchaseInvoiceDueDates.length===0?I(e.purchaseInvoiceDate):I(e.purchaseInvoiceDueDates[e.purchaseInvoiceDueDates.length-1].dueDate):"",T=()=>{y.push({path:`/purchaseInvoice/${J()}`})},B=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||y.push({path:`/purchaseinvoice/${e.data.id}`})},F=(e,t)=>{S.require({target:e.currentTarget,message:`Està segur que vol eliminar la factura ${t.number}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await D.Delete(t.id)&&(b.add({severity:"success",summary:"Eliminada",life:3e3}),await _())}})};return(e,t)=>{const r=v("Dropdown"),i=v("Button"),c=v("Column"),L=v("DataTable");return w(),x("div",null,[s(L,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",value:l(D).purchaseInvoices,onRowClick:B},{header:n(()=>[u("div",K,[u("div",Q,[u("div",W,[s(M,{exercises:l(d).masterData.exercises,onRangeSelected:_},null,8,["exercises"])]),u("div",X,[Z,s(r,{modelValue:m.value.supplierId,"onUpdate:modelValue":t[0]||(t[0]=a=>m.value.supplierId=a),editable:"",options:l(d).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),u("div",ee,[s(i,{class:"datatable-button mr-2",icon:l(p).FILTER,rounded:"",raised:"",onClick:_},null,8,["icon"]),s(i,{class:"datatable-button mr-2",icon:l(p).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),s(i,{icon:l(p).PLUS,rounded:"",raised:"",onClick:T},null,8,["icon"])])])]),default:n(()=>[s(c,{field:"number",header:"Número",sortable:!0,style:{width:"10%"}}),s(c,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"10%"}},{body:n(a=>[h(f(l(I)(a.data.purchaseInvoiceDate)),1)]),_:1}),s(c,{header:"Proveïdor",style:{width:"15%"}},{body:n(a=>[h(f(N(a.data.supplierId)),1)]),_:1}),s(c,{header:"Núm. Fra. Proveïdor",style:{width:"15%"},field:"supplierNumber"}),s(c,{header:"Estat",style:{width:"15%"}},{body:n(a=>[h(f(g(a.data.purchaseInvoiceStatusId)),1)]),_:1}),s(c,{header:"Venciment",style:{width:"10%"}},{body:n(a=>[h(f(E(a.data)),1)]),_:1}),s(c,{header:"Import",style:{width:"10%"}},{body:n(a=>[h(f(a.data.netAmount)+" € ",1)]),_:1}),s(c,{style:{width:"5%"}},{body:n(a=>[g(a.data.purchaseInvoiceStatusId)==="Nova"?(w(),x("i",{key:0,class:O([l(p).TIMES,"grid_delete_column_button"]),onClick:V=>F(V,a.data)},null,10,te)):U("",!0)]),_:1})]),_:1},8,["value"])])}}});export{he as default};
