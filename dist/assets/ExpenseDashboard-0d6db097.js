import{d as S,h as b,a as f,m as T,w as c,i as l,e as t,D as V,k as u,u as N,r as i,o as F,P as v,J as R,c as G,n as D,C as j,G as H,p as U,b as W,L as w,l as I,f as z}from"./index-75cc375f.js";import{_ as J}from"./lodash-e1855bb1.js";import{f as K,a as k}from"./functions-224f323d.js";import{E as Q}from"./index-c88663a4.js";import"./v4-a960c1f4.js";import"./base.service-c816a16d.js";import"./suppliers.service-1600800e.js";const Y=S({__name:"TableConsolidatedExpenses",props:{expenses:{}},setup(p){const g=p;return(x,d)=>{const s=b("Column"),h=b("DataTable");return f(),T(h,{value:g.expenses,tableStyle:"min-width: 100%"},{default:c(()=>[l(s,{field:"type",header:"Tipus de despesa",style:{width:"10%"}}),l(s,{field:"typeDetail",header:"Detall",style:{width:"15%"}}),l(s,{field:"paymentDate",header:"Data pagament",sortable:"",style:{width:"10%"}},{body:c(m=>[t("span",null,V(u(K)(m.data.paymentDate)),1)]),_:1}),l(s,{field:"amount",header:"Import",style:{width:"10%"}},{body:c(m=>[t("span",null,V(m.data.amount)+" €",1)]),_:1}),l(s,{field:"description",header:"Descripció",style:{width:"30%"}})]),_:1},8,["value"])}}}),y=p=>(U("data-v-5da8d0e7"),p=p(),W(),p),Z={class:"dashboard-filter"},$={class:"dashboard-filter-field"},q=y(()=>t("label",{class:"block text-900"},"Període",-1)),X={class:"dashboard-filter-field"},ee={class:"block text-900"},te=y(()=>t("span",null,"Gràfics",-1)),ae={class:"dashboard-container"},se={class:"dashboard-item"},oe=y(()=>t("header",{class:"dashboard-item-header"}," Agrupat despeses mensual ",-1)),le={class:"dashboard-item-chart"},ne={class:"dashboard-item"},de=y(()=>t("header",{class:"dashboard-item-header"}," Gràfic de despeses per tipologia ",-1)),re={class:"dashboard-item-chart"},ce=y(()=>t("span",null,"Llistat",-1)),ie=S({__name:"ExpenseDashboard",setup(p){const g=N(),x=i(0),d=i({dates:void 0,excludeManaged:!1}),s=i([]);F(async()=>{g.setMenuItem({icon:v.MONEY_BILL,title:"Dashboard despeses"})});const h=i(void 0),m=i({plugins:{legend:{labels:{usePointStyle:!0}}}}),C=i(void 0),B=i({scales:{y:{beginAtZero:!0}}}),A=R(()=>{let n=0;return s.value.length>0&&s.value.forEach(e=>n+=e.amount),n}),L=async()=>{if(d.value.dates&&d.value.dates[0]&&d.value.dates[1]){const n=k(d.value.dates[0]),e=k(d.value.dates[1]),a=await Q.Expense.getConsolidated(n,e);a&&(s.value=a),C.value=P(s.value,"monthPaymentKey"),h.value=P(s.value,"typeDetail")}},P=(n,e)=>{const a={},o=J.groupBy(n,e);a.labels=Object.keys(o);const r=M(a.labels.length);return a.datasets=[{label:"Despeses",data:[],backgroundColor:r,borderColor:r,borderWidth:1}],Object.keys(o).forEach(_=>{let E=0;o[_].forEach(O=>{E+=O.amount}),a.datasets[0].data.push(E)}),a},M=n=>{const e=getComputedStyle(document.body),a=[e.getPropertyValue("--blue-400"),e.getPropertyValue("--green-400"),e.getPropertyValue("--yellow-400"),e.getPropertyValue("--cyan-400"),e.getPropertyValue("--pink-400"),e.getPropertyValue("--indigo-400"),e.getPropertyValue("--orange-400"),e.getPropertyValue("--purple-400"),e.getPropertyValue("--red-400")],o=[];for(;o.length<n;)for(let r=0;r<a.length;r++)o.push(a[r]);return o};return(n,e)=>{const a=b("Calendar"),o=b("TabPanel"),r=b("TabView");return f(),G(H,null,[t("div",Z,[t("div",$,[q,l(a,{modelValue:d.value.dates,"onUpdate:modelValue":e[0]||(e[0]=_=>d.value.dates=_),selectionMode:"range",dateFormat:"dd/mm/yy",onDateSelect:L},null,8,["modelValue"])]),t("div",X,[t("label",ee,[t("i",{class:D(u(v).WALLET)},null,2),j("   Total despesa "),t("b",null,V(A.value.toFixed(2))+" € ",1)])])]),l(r,{activeIndex:x.value,"onUpdate:activeIndex":e[1]||(e[1]=_=>x.value=_)},{default:c(()=>[l(o,null,{header:c(()=>[t("i",{class:D([u(v).CHART_BAR,"mr-2"])},null,2),te]),default:c(()=>[t("div",ae,[t("section",se,[oe,t("div",le,[C.value?(f(),T(u(w),{key:0,type:"bar",data:C.value,options:B.value},null,8,["data","options"])):I("",!0)])]),t("section",ne,[de,t("div",re,[h.value?(f(),T(u(w),{key:0,type:"pie",data:h.value,options:m.value},null,8,["data","options"])):I("",!0)])])])]),_:1}),l(o,null,{header:c(()=>[t("i",{class:D([u(v).LIST,"mr-2"])},null,2),ce]),default:c(()=>[l(Y,{scrollable:"",scrollHeight:"75vh",expenses:s.value},null,8,["expenses"])]),_:1})]),_:1},8,["activeIndex"])],64)}}});const ve=z(ie,[["__scopeId","data-v-5da8d0e7"]]);export{ve as default};
