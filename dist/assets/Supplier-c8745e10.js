import{b as j}from"./vue-router-c71b0622.js";import{u as $}from"./suppliers-3ee00375.js";import{j as q,aw as B,M as R,k as S,f as y,l as o,o as _,c as F,e as n,h as t,n as c,d as I,a as T,P as k,w as E,a0 as O,t as P,F as z,u as H}from"./index-0e14a554.js";import{B as V}from"./BaseInput-9aa79c5a.js";import{u as J}from"./geography-384161c0.js";import{c as L,a as v,F as A,d as D}from"./form-validator-88e54800.js";import{u as M}from"./usetoast.esm-2dfabc60.js";import{u as K}from"./paymentMethod-328a547e.js";import{F as N}from"./component-45e7825d.js";import{u as Q}from"./useconfirm.esm-6f798407.js";import{v as W}from"./v4-a960c1f4.js";import"./base.service-431caa23.js";import"./_plugin-vue_export-helper-c27b6911.js";const X={key:0},Y={class:"three-columns"},Z={class:"three-columns mb-2"},ee=n("label",{class:"block text-900 mb-2"},"País",-1),ae=n("label",{class:"block text-900 mb-2"},"Província",-1),oe=n("label",{class:"block text-900 mb-2"},"Municipi",-1),le={class:"three-columns mb-2"},te={class:"three-columns"},se=n("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),ne=n("label",{class:"block text-900 mb-2"},"Tipus Proveïdor",-1),re=n("label",{class:"block text-900 mb-2"},"Observacions",-1),ie={class:"mt-2"},ue=q({__name:"FormSupplier",emits:["submit"],setup(U,{emit:f}){const C=J(),h=$(),p=K(),{supplier:e}=B(h),b=M();R(async()=>{await p.fetchAll()});const g=L().shape({comercialName:v().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),vatNumber:v().required("El CIF és obligatori").max(15,"El CIF no pot superar els 15 carácters"),taxName:v().required("El nom fiscal és obligatori"),region:v().required("La província és obligatoria"),city:v().required("El municipi és obligatori"),postalCode:v().required("El codi postal és obligatori"),address:v().required("La direcció és obligatoria"),phone:v().required("El telèfon és obligatori"),accountNumber:v().required("El número de compte és obligatori").max(35,"El número de compte no pot superar el 35 dígits"),supplierTypeId:v().required("El tipus de proveïdor és obligatori"),paymentMethodId:v().required("La forma de pagament és obligatoria")}),d=S({result:!1,errors:{}}),i=()=>{e.value.address=""},u=()=>{const r=new A(g);d.value=r.validate(e.value)},m=async()=>{if(u(),d.value.result)f("submit",e.value);else{let r="";Object.entries(d.value.errors).forEach(a=>{r+=`${a[1].map(l=>l)}.   `}),b.add({severity:"warn",summary:"Formulari inválid",detail:r,life:5e3})}};return(r,a)=>{const l=y("Dropdown"),w=y("Textarea"),x=y("Button");return o(e)?(_(),F("form",X,[n("section",Y,[t(V,{name:"comercialName",class:c(["mb-2",{"p-invalid":d.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:o(e).comercialName,"onUpdate:modelValue":a[0]||(a[0]=s=>o(e).comercialName=s)},null,8,["modelValue","class"]),t(V,{class:c(["mb-2",{"p-invalid":d.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:o(e).taxName,"onUpdate:modelValue":a[1]||(a[1]=s=>o(e).taxName=s)},null,8,["modelValue","class"]),t(V,{label:"CIF",id:"vatNumber",modelValue:o(e).vatNumber,"onUpdate:modelValue":a[2]||(a[2]=s=>o(e).vatNumber=s),class:c({"p-invalid":d.value.errors.vatNumber})},null,8,["modelValue","class"])]),n("section",Z,[n("div",null,[ee,t(l,{modelValue:o(e).country,"onUpdate:modelValue":a[3]||(a[3]=s=>o(e).country=s),editable:"",options:["Espanya"],class:c(["w-full",{"p-invalid":d.value.errors.country}])},null,8,["modelValue","class"])]),n("div",null,[ae,t(l,{modelValue:o(e).region,"onUpdate:modelValue":a[4]||(a[4]=s=>o(e).region=s),editable:"",options:o(C).regions,optionValue:"nm",optionLabel:"nm",onChange:i,class:c(["w-full",{"p-invalid":d.value.errors.region}])},null,8,["modelValue","options","class"])]),n("div",null,[oe,t(l,{modelValue:o(e).city,"onUpdate:modelValue":a[5]||(a[5]=s=>o(e).city=s),editable:"",options:o(C).getTownsByRegionName(o(e).region),optionValue:"nm",optionLabel:"nm",class:c(["w-full",{"p-invalid":d.value.errors.city}])},null,8,["modelValue","options","class"])])]),n("section",le,[t(V,{label:"Codi Postal",id:"postalCode",modelValue:o(e).postalCode,"onUpdate:modelValue":a[6]||(a[6]=s=>o(e).postalCode=s),class:c({"p-invalid":d.value.errors.postalCode})},null,8,["modelValue","class"]),t(V,{label:"Direcció",id:"address",modelValue:o(e).address,"onUpdate:modelValue":a[7]||(a[7]=s=>o(e).address=s),class:c({"p-invalid":d.value.errors.address})},null,8,["modelValue","class"]),t(V,{label:"Telèfon",id:"phone",modelValue:o(e).phone,"onUpdate:modelValue":a[8]||(a[8]=s=>o(e).phone=s),class:c({"p-invalid":d.value.errors.phone})},null,8,["modelValue","class"])]),n("section",te,[n("div",null,[se,t(l,{modelValue:o(e).paymentMethodId,"onUpdate:modelValue":a[9]||(a[9]=s=>o(e).paymentMethodId=s),editable:"",options:o(p).paymentMethods,optionValue:"id",optionLabel:"name",class:c(["w-full",{"p-invalid":d.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])]),t(V,{label:"Número de compte",id:"accountNumber",modelValue:o(e).accountNumber,"onUpdate:modelValue":a[10]||(a[10]=s=>o(e).accountNumber=s),class:c({"p-invalid":d.value.errors.accountNumber})},null,8,["modelValue","class"]),n("div",null,[ne,t(l,{modelValue:o(e).supplierTypeId,"onUpdate:modelValue":a[11]||(a[11]=s=>o(e).supplierTypeId=s),editable:"",options:o(h).supplierTypes,optionValue:"id",optionLabel:"name",class:c(["w-full",{"p-invalid":d.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),n("div",null,[re,t(w,{modelValue:o(e).observations,"onUpdate:modelValue":a[12]||(a[12]=s=>o(e).observations=s),class:"w-full"},null,8,["modelValue"])]),n("div",ie,[t(x,{label:"Guardar",class:"mr-2",onClick:m})])])):I("",!0)}}}),de={key:0},ce={class:"three-columns"},me={class:"three-columns"},pe=n("label",{class:"block text-900 mb-2"},"Predeterminat",-1),ve=n("label",{class:"block text-900 mb-2"},"Observacions",-1),be={class:"mt-2"},fe=q({__name:"FormSupplierContact",props:{contact:{}},emits:["submit","cancel"],setup(U,{emit:f}){const C=U,h=M(),p=L().shape({firstName:v().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:v().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:v(),email:v().required("El correu és obligatori").email("Correu electrònic invàlid"),phone:v().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),phoneExtension:v(),observations:v(),disabled:D().required(),default:D().required()}),e=S({result:!1,errors:{}}),b=()=>{const i=new A(p);e.value=i.validate(C.contact)},g=async()=>{if(b(),e.value.result)f("submit",C.contact);else{let i="";Object.entries(e.value.errors).forEach(u=>{i+=`${u[1].map(m=>m)}.   `}),h.add({severity:"warn",summary:"Formulari inválid",detail:i,life:5e3})}},d=()=>{f("cancel")};return(i,u)=>{const m=y("Checkbox"),r=y("Textarea"),a=y("Button");return i.contact?(_(),F("form",de,[n("section",ce,[t(V,{label:"Nom",id:"firstName",modelValue:i.contact.firstName,"onUpdate:modelValue":u[0]||(u[0]=l=>i.contact.firstName=l),class:c(["mb-2",{"p-invalid":e.value.errors.firstName}])},null,8,["modelValue","class"]),t(V,{label:"Cognoms",id:"lastName",modelValue:i.contact.lastName,"onUpdate:modelValue":u[1]||(u[1]=l=>i.contact.lastName=l),class:c(["mb-2",{"p-invalid":e.value.errors.lastName}])},null,8,["modelValue","class"]),t(V,{label:"Càrrec",id:"charge",modelValue:i.contact.charge,"onUpdate:modelValue":u[2]||(u[2]=l=>i.contact.charge=l),class:c(["mb-2",{"p-invalid":e.value.errors.charge}])},null,8,["modelValue","class"])]),n("section",me,[t(V,{class:c(["mb-2",{"p-invalid":e.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:i.contact.email,"onUpdate:modelValue":u[3]||(u[3]=l=>i.contact.email=l)},null,8,["modelValue","class"]),t(V,{class:c(["mb-2",{"p-invalid":e.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:i.contact.phone,"onUpdate:modelValue":u[4]||(u[4]=l=>i.contact.phone=l)},null,8,["modelValue","class"]),n("div",null,[pe,t(m,{modelValue:i.contact.default,"onUpdate:modelValue":u[5]||(u[5]=l=>i.contact.default=l),class:"w-full",binary:!0},null,8,["modelValue"])])]),n("div",null,[ve,t(r,{modelValue:i.contact.observations,"onUpdate:modelValue":u[6]||(u[6]=l=>i.contact.observations=l),class:"w-full"},null,8,["modelValue"])]),n("div",be,[t(a,{label:"Guardar",class:"mr-2",onClick:g}),t(a,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:d})])])):I("",!0)}}}),Ve={key:2},ye=["onClick"],Ce=q({__name:"SupplierContacts",emits:["create","update","delete"],setup(U,{emit:f}){const C=Q(),h=$(),{supplier:p}=B(h),e=S(N.CREATE),b=S(void 0),g=()=>{var m;b.value={supplierId:(m=p.value)==null?void 0:m.id,id:W(),firstName:"",lastName:"",email:"",phone:"",phoneExtension:"",charge:"",disabled:!1,default:!1,observations:""},e.value=N.CREATE},d=m=>{m.originalEvent.target.className.includes("grid_delete_column_button")||(b.value=m.data,e.value=N.EDIT)},i=()=>{const m=b.value;e.value===N.CREATE?f("create",m):f("update",m),b.value=void 0},u=(m,r)=>{C.require({target:m.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{f("delete",r)}})};return(m,r)=>{var x;const a=y("Button"),l=y("Column"),w=y("DataTable");return _(),F(z,null,[b.value?I("",!0):(_(),T(a,{key:0,icon:o(k).PLUS,class:"grid_add_row_button",rounded:"",onClick:g},null,8,["icon"])),b.value?(_(),T(fe,{key:1,contact:b.value,onSubmit:i,onCancel:r[0]||(r[0]=()=>b.value=void 0)},null,8,["contact"])):(_(),F("div",Ve,[(x=o(p))!=null&&x.contacts?(_(),T(w,{key:0,value:o(p).contacts,tableStyle:"min-width: 100%",onRowClick:d},{default:E(()=>[t(l,{header:"Nom",style:{width:"25%"}},{body:E(s=>[O(P(s.data.firstName)+" "+P(s.data.lastName),1)]),_:1}),t(l,{header:"Càrrec",field:"charge",style:{width:"25%"}}),t(l,{header:"Correu",field:"email",style:{width:"25%"}}),t(l,{header:"Telèfon",field:"phone",style:{width:"25%"}}),t(l,null,{body:E(s=>[n("i",{class:c([o(k).TIMES,"grid_delete_column_button"]),onClick:G=>u(G,s.data)},null,10,ye)]),_:1})]),_:1},8,["value"])):I("",!0)]))],64)}}}),ge=n("span",null,"Proveïdor",-1),_e=n("span",null,"Contactes",-1),Be=q({__name:"Supplier",setup(U){const f=S(N.EDIT),C=j(),h=H(),p=$(),{supplier:e}=B(p),b=async()=>{await p.fetchSupplier(C.params.id),p.fetchSupplierTypes();let r="";e.value?(f.value=N.EDIT,r=`Proveïdor ${e.value.comercialName}`):(f.value=N.CREATE,p.setNewSupplier(C.params.id),r="Alta de proveïdor"),h.setMenuItem({icon:k.BUILDING,text:r,backButtonVisible:!0})};R(async()=>{await b()});const g=M(),d=async()=>{const r=e.value;let a=!1,l="";f.value===N.CREATE?(a=await p.createSupplier(r),l="Proveïdor creat correctament"):(a=await p.updateSupplier(r.id,r),l="Proveïdor actualizat correctament"),a&&(g.add({severity:"success",summary:l,life:5e3}),await b())},i=async r=>{await p.addContactToSupplier(r)&&g.add({severity:"success",summary:"Contacte afegit",life:5e3})},u=async r=>{await p.updateContactFromSupplier(r)&&g.add({severity:"success",summary:"Contacte actualizat",life:5e3})},m=async r=>{await p.removeContactFromSupplier(r)&&g.add({severity:"success",summary:"Contacte eliminat",life:5e3})};return(r,a)=>{const l=y("TabPanel"),w=y("TabView");return _(),T(w,null,{default:E(()=>[t(l,null,{header:E(()=>[n("i",{class:c([o(k).BUILDING,"mr-2"])},null,2),ge]),default:E(()=>[t(ue,{onSubmit:d})]),_:1}),f.value===o(N).EDIT?(_(),T(l,{key:0},{header:E(()=>[n("i",{class:c([o(k).USERS,"mr-2"])},null,2),_e]),default:E(()=>[t(Ce,{onCreate:i,onUpdate:u,onDelete:m})]),_:1})):I("",!0)]),_:1})}}});export{Be as default};
