import{d as I,r as v,g as P,j as N,c as h,k as t,n as C,e as V,l as S,v as B,x as k,y as F,p as A,b as M,a as y,z as E,f as O,i as R,A as z,u as q,o as T,P as D,U as j,C as x}from"./index-7ccc629f.js";import{c as G,a as U,b as W,F as L}from"./form-validator-58b9052d.js";const H=i=>(A("data-v-057dead0"),i=i(),M(),i),J=["onSubmit"],K={class:"two-columns"},Q={key:0,class:"form-user-changepassword"},X=H(()=>V("label",{class:"block mb-2",style:{color:"#fff"}},"...",-1)),Y={class:"mt-2"},Z=I({__name:"FormUser",props:{user:{}},emits:["submit","change-password"],setup(i,{emit:b}){const d=i,f=v(!1),a=v(""),l=v(""),w=P(),m=G().shape({username:U().required("El correu és obligatori").max(250,"El nom d'usuari no pot superar els 250 carácters"),firstName:U().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:U().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),disabled:W().required()}),o=v({result:!1,errors:{}}),g=()=>{const s=new L(m);o.value=s.validate(d.user)},n=s=>{const e=d.user;e.disabled=s,c()},c=async()=>{if(g(),o.value.result)b("submit",d.user);else{let s="";Object.entries(o.value.errors).forEach(e=>{s+=`${e[1].map(u=>u)}.   `}),w.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}},_=()=>{f.value=!0},$=()=>{var e;if(!(a.value.length>4==l.value.length>4&&a.value===l.value)){w.add({severity:"warn",summary:"Contrasenya invàlida",detail:"Les contrasenyes han de coincidir i contenir més de 4 caràcters"});return}b("change-password",{username:(e=d.user)==null?void 0:e.username,password:a.value})};return(s,e)=>{const u=N("BaseInput"),p=N("Button");return s.user?(y(),h("form",{key:0,onSubmit:F(c,["prevent"])},[t(u,{id:"username",class:C(["mb-2",{"p-invalid":o.value.errors.email}]),label:"Nom d'usuari",modelValue:s.user.username,"onUpdate:modelValue":e[0]||(e[0]=r=>s.user.username=r),disabled:"true"},null,8,["modelValue","class"]),V("section",K,[t(u,{id:"firstName",class:C(["mb-2",{"p-invalid":o.value.errors.firstName}]),label:"Nom",modelValue:s.user.firstName,"onUpdate:modelValue":e[1]||(e[1]=r=>s.user.firstName=r)},null,8,["modelValue","class"]),t(u,{id:"lastName",class:C(["mb-2",{"p-invalid":o.value.errors.lastName}]),label:"Cognoms",modelValue:s.user.lastName,"onUpdate:modelValue":e[2]||(e[2]=r=>s.user.lastName=r)},null,8,["modelValue","class"])]),f.value===!0?(y(),h("section",Q,[t(u,{type:S(E).PASSWORD,id:"passwordOne",class:"mb-2 w-full",label:"Contrasenya",modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value=r)},null,8,["type","modelValue"]),t(u,{type:S(E).PASSWORD,id:"passwordTwo",class:"mb-2",label:"Repetir contrasenya",modelValue:l.value,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value=r)},null,8,["type","modelValue"]),V("div",null,[X,t(p,{label:"Modificar",class:"mr-2",onClick:$})])])):B("",!0),V("div",Y,[t(p,{type:"submit",label:"Guardar",class:"mr-2"}),s.user.disabled?(y(),k(p,{key:0,severity:"success",label:"Activar",class:"mr-2",onClick:e[5]||(e[5]=r=>n(!1))})):(y(),k(p,{key:1,label:"Desactivar",severity:"danger",class:"mr-2",onClick:e[6]||(e[6]=r=>n(!0))})),t(p,{severity:"secondary",label:"Canviar contrasenya",class:"mr-2",onClick:_})])],40,J)):B("",!0)}}});const ee=O(Z,[["__scopeId","data-v-057dead0"]]),re=I({__name:"User",setup(i){const b=R(),d=z(),f=q(),a=v(void 0),l=new j,w=async()=>{a.value=await l.GetById(d.params.id),a.value&&f.setMenuItem({icon:D.USER,text:`Usuari ${a.value.username}`,backButtonVisible:!0})};T(async()=>{await w()});const m=P(),o=async()=>{const n=a.value;let c="Usuari actualizat correctament";await l.Update(n)&&(m.add({severity:"success",summary:c,life:5e3}),b.back())},g=async n=>{await new x().ChangePassword(n)?m.add({severity:"success",summary:"Canvi de contrasenya",detail:"Contrasenya actualitzada",life:1e4}):m.add({severity:"error",summary:"Canvi de contrasenya",detail:"Error al actualitzar contrasenya",life:1e4})};return(n,c)=>(y(),k(ee,{user:a.value,onChangePassword:g,onSubmit:o},null,8,["user"]))}});export{re as default};
