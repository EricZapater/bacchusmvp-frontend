import{d as L,o as M,h as v,m as U,w as r,a as E,Q as P,i as s,C as h,D,k as c,c as F,n as j,P as C,l as O,j as G,x as Q,g as z,u as A,r as q,E as H,G as Y,e as u}from"./index-cfd694c0.js";import{u as J}from"./lifecycle-1b439e74.js";import{f as V,a as w,g as K}from"./functions-c791afc8.js";import{u as W}from"./invoice-ef80c52e.js";import{u as X}from"./customers-f6dffffc.js";import{u as Z}from"./masterData-4015308d.js";import{_ as ee}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-306770e5.js";import"./index-e82487dd.js";import"./base.service-a4c32e6e.js";import"./v4-a960c1f4.js";import"./index-89203afb.js";import"./reference.service-e68ff47f.js";import"./form-validator-9c61cd26.js";const te=["onClick"],ae=L({__name:"TableInvoices",props:{invoices:{},customers:{}},emits:["edit","delete"],setup(x,{emit:f}){const S=x,m=J();M(async()=>{await m.fetchOneByName("SalesInvoice")});const k=e=>{var t;const l=(t=S.customers)==null?void 0:t.find(d=>d.id===e);return l?l.comercialName:""},N=e=>{var t;const l=(t=m.lifecycle)==null?void 0:t.statuses.find(d=>d.id===e);return l?l.name:""},_=e=>e.salesInvoiceDueDates?e.salesInvoiceDueDates.length===0?V(e.invoiceDate):V(e.salesInvoiceDueDates[e.salesInvoiceDueDates.length-1].dueDate):"",p=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||f("edit",e.data)},n=(e,l)=>{f("delete",l)};return(e,l)=>{const t=v("Column"),d=v("DataTable");return E(),U(d,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"75vh",sortMode:"multiple",value:e.invoices,onRowClick:p},{header:r(()=>[P(e.$slots,"filter")]),default:r(()=>[s(t,{field:"invoiceNumber",header:"Número",sortable:!0,style:{width:"10%"}}),s(t,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:r(a=>[h(D(c(V)(a.data.invoiceDate)),1)]),_:1}),s(t,{header:"Client",style:{width:"15%"}},{body:r(a=>[h(D(k(a.data.customerId)),1)]),_:1}),s(t,{header:"Estat",style:{width:"15%"}},{body:r(a=>[h(D(N(a.data.statusId)),1)]),_:1}),s(t,{header:"Venciment",style:{width:"15%"}},{body:r(a=>[h(D(_(a.data)),1)]),_:1}),s(t,{header:"Import",style:{width:"15%"}},{body:r(a=>[h(D(a.data.netAmount)+" € ",1)]),_:1}),s(t,{style:{width:"5%"}},{body:r(a=>{var y;return[a.data.statusId===((y=c(m).lifecycle)==null?void 0:y.initialStatusId)?(E(),F("i",{key:0,class:j([c(C).TIMES,"grid_delete_column_button"]),onClick:B=>n(B,a.data)},null,10,te)):O("",!0)]}),_:1})]),_:3},8,["value"])}}}),se={class:"flex flex-wrap align-items-center justify-content-between gap-2"},oe={class:"datatable-filter"},le={class:"filter-field"},ie=u("label",{class:"block text-900 mb-2"},"Període",-1),ne={class:"filter-field"},re=u("label",{class:"block text-900 mb-2"},"Client",-1),ce={class:"datatable-buttons"},we=L({__name:"SalesInvoices",setup(x){const f=G(),S=Q(),m=z(),k=A(),N=Z(),_=X(),p=W(),n=q({dates:void 0,customerId:void 0}),e=H({visible:!1,title:"Crear factura",closable:!0,position:"center",modal:!0});M(async()=>{N.fetchMasterData(),_.fetchCustomers(),await l(),k.setMenuItem({icon:C.MONEY_BILL,title:"Factures de venta"})});const l=async()=>{let o="",i="";if(n.value.dates)o=w(n.value.dates[0]),i=w(n.value.dates[1]);else{let I=new Date,g=new Date;I.setDate(g.getDate()-30),o=w(I),i=w(g)}await p.GetFiltered(o,i,void 0,void 0,n.value.customerId)},t=q({}),d=()=>({id:K(),customerId:"",exerciseId:"",date:new Date}),a=()=>{t.value=d(),e.visible=!0},y=async()=>{const o=await p.Create(t.value);if(console.log("createInvoice",o),!o.result){f.add({summary:"Error al crear detall",detail:o.errors.length>0?o.errors[0]:"",severity:"error"});return}m.push({path:`/sales-invoice/${t.value.id}`})},B=o=>{m.push({path:`/sales-invoice/${o.id}`})},$=o=>{S.require({message:"Està segur que vol eliminar la factura?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await p.Delete(o.id)&&(f.add({severity:"success",summary:"Eliminada",life:3e3}),await l())}})};return(o,i)=>{const I=v("Calendar"),g=v("Dropdown"),T=v("Button"),R=v("Dialog");return E(),F(Y,null,[s(ae,{invoices:c(p).invoices,customers:c(_).customers,onEdit:B,onDelete:$},{filter:r(()=>[u("div",se,[u("div",oe,[u("div",le,[ie,s(I,{modelValue:n.value.dates,"onUpdate:modelValue":i[0]||(i[0]=b=>n.value.dates=b),selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),u("div",ne,[re,s(g,{modelValue:n.value.customerId,"onUpdate:modelValue":i[1]||(i[1]=b=>n.value.customerId=b),editable:"",options:c(_).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),u("div",ce,[s(T,{class:"datatable-button mr-2",icon:c(C).FILTER,rounded:"",raised:"",onClick:l},null,8,["icon"]),s(T,{icon:c(C).PLUS,rounded:"",raised:"",onClick:a},null,8,["icon"])])])]),_:1},8,["invoices","customers"]),s(R,{visible:e.visible,"onUpdate:visible":i[2]||(i[2]=b=>e.visible=b),header:e.title,closable:e.closable,modal:e.modal},{default:r(()=>[s(ee,{"create-request":t.value,onSubmit:y},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{we as default};
