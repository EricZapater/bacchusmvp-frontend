import{_ as U}from"./DropdownReference.vue_vue_type_script_setup_true_lang-a946ca4e.js";import{c as O,d as j,a as L,F as z}from"./form-validator-f8953ae6.js";import{d as S,j as x,H as A,r as V,h as y,c as W,e,i as r,C as $,k as f,y as Q,D as w,l as M,a as g,s as G,E as H,x as J,w as h,G as E,P as B,n as K,m as P,v as X,g as Y,u as Z,z as ee,o as te,f as se}from"./index-98d6f8aa.js";import{g as ae}from"./functions-552e18f7.js";import{u as D}from"./plantmodel-3866c95d.js";import{_ as oe}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-ef5dd5a2.js";import{u as re}from"./reference-73298289.js";import{u as le}from"./workmaster-bd2ddef8.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./index-a7eaf997.js";import"./base.service-e22fe275.js";import"./reference.service-3d8d19cf.js";const ne={key:0},ie={class:"grid_add_row_button"},ce=e("br",null,null,-1),de={class:"three-columns"},ue=e("label",{class:"block text-900 mb-2"},"Desactivat",-1),me={class:"five-columns"},pe={class:"mt-1"},_e=e("label",{class:"block text-900 mb-2"},"Cost Operari:",-1),ke={class:"summary-field"},fe={class:"mt-1"},be=e("label",{class:"block text-900 mb-2"},"Cost Màquina:",-1),he={class:"summary-field"},we={class:"mt-1"},ye=e("label",{class:"block text-900 mb-2"},"Cost Material:",-1),ve={class:"summary-field"},Ce={class:"mt-1"},ge=e("label",{class:"block text-900 mb-2"},"Cost Extern:",-1),Te={class:"summary-field"},Ie={class:"mt-1"},$e=e("label",{class:"block text-900 mb-2"},"Cost Total:",-1),Me={class:"summary-field"},Be=S({__name:"FormWorkmaster",props:{workmaster:{}},emits:["submit","calculateCost","cancel"],setup(I,{emit:b}){const c=I,d=x(),v=A(()=>c.workmaster.operatorCost+c.workmaster.machineCost+c.workmaster.materialCost+c.workmaster.externalCost),m=O().shape({baseQuantity:j().min(1,"La quantitat base ha de ser superior a 0").required("La quanitat base és obligatoria"),referenceId:L().required("La referència és obligatoria")}),n=V({result:!1,errors:{}}),C=()=>{const s=new z(m);n.value=s.validate(c.workmaster)},u=async()=>{if(C(),n.value.result)b("submit",c.workmaster);else{let s="";Object.entries(n.value.errors).forEach(i=>{s+=`${i[1].map(k=>k)}.   `}),d.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}},p=()=>{if(C(),n.value.result)b("calculateCost",c.workmaster);else{let s="";Object.entries(n.value.errors).forEach(i=>{s+=`${i[1].map(k=>k)}.   `}),d.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,i)=>{const k=y("Button"),T=y("Checkbox");return s.workmaster?(g(),W("form",ne,[e("div",ie,[r(k,{label:"Calcular Cost",size:"small",onClick:p}),$("   "),r(k,{label:"Guardar",size:"small",onClick:u}),ce]),e("section",de,[e("div",null,[r(U,{label:"Referència",modelValue:s.workmaster.referenceId,"onUpdate:modelValue":i[0]||(i[0]=a=>s.workmaster.referenceId=a),fullName:!0},null,8,["modelValue"])]),e("div",null,[r(Q,{type:f(G).NUMERIC,label:"Quantitat Base",decimals:2,modelValue:s.workmaster.baseQuantity,"onUpdate:modelValue":i[1]||(i[1]=a=>s.workmaster.baseQuantity=a)},null,8,["type","modelValue"])]),e("div",null,[ue,r(T,{modelValue:s.workmaster.disabled,"onUpdate:modelValue":i[2]||(i[2]=a=>s.workmaster.disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),e("section",me,[e("div",pe,[_e,e("span",ke,w(s.workmaster.operatorCost)+" €",1)]),e("div",fe,[be,e("span",he,w(s.workmaster.machineCost)+" €",1)]),e("div",we,[ye,e("span",ve,w(s.workmaster.materialCost)+" €",1)]),e("div",Ce,[ge,e("span",Te,w(s.workmaster.externalCost)+" €",1)]),e("div",Ie,[$e,e("span",Me,w(v.value)+" €",1)])])])):M("",!0)}}}),Pe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Se=e("span",{class:"text-xl text-900 font-bold"},"Fases de la ruta",-1),Ve=["onClick"],We=S({__name:"TableWorkmasterPhases",props:{workmaster:{},workmasterPhases:{}},emits:["add","edit","delete"],setup(I,{emit:b}){const c=I,d=H({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),v=J(),m=D(),n=a=>{var t;if(!m.workcenterTypes)return"";const l=(t=m.workcenterTypes)==null?void 0:t.find(o=>a===o.id);return l?l.name:""},C=a=>{var t;if(!m.workcenters)return"";const l=(t=m.workcenters)==null?void 0:t.find(o=>a===o.id);return l?l.name:""},u=a=>{var t;if(!m.operatorTypes)return"";const l=(t=m.operatorTypes)==null?void 0:t.find(o=>a===o.id);return l?l.name:""},p=V({}),s=()=>{p.value={id:ae(),workMasterId:c.workmaster.id,disabled:!1,code:((c.workmaster.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,workmasterPhaseDetails:[],workmasterPhaseBillOfMaterials:[]},d.visible=!0},i=a=>{d.visible=!1,b("add",a)},k=a=>{a.originalEvent.target.className.includes("grid_delete_column_button")||b("edit",a.data)},T=(a,l)=>{v.require({target:a.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",l)}})};return(a,l)=>{const t=y("Button"),o=y("Column"),N=y("BooleanColumn"),R=y("DataTable"),q=y("Dialog");return g(),W(E,null,[r(R,{onRowClick:k,value:a.workmasterPhases,tableStyle:"min-width: 100%"},{header:h(()=>[e("div",Pe,[Se,r(t,{icon:f(B).PLUS,rounded:"",raised:"",onClick:s},null,8,["icon"])])]),default:h(()=>[r(o,{field:"code",header:"Codi",style:{width:"10%"}}),r(o,{field:"description",header:"Descripció",style:{width:"20%"}}),r(o,{header:"Tipus de màquina",style:{width:"15%"}},{body:h(_=>[$(w(n(_.data.workcenterTypeId)),1)]),_:1}),r(o,{header:"Màquina preferida",style:{width:"15%"}},{body:h(_=>[$(w(C(_.data.preferredWorkcenterId)),1)]),_:1}),r(o,{header:"Tipus d'operari",style:{width:"15%"}},{body:h(_=>[$(w(u(_.data.operatorTypeId)),1)]),_:1}),r(o,{header:"Extern",style:{width:"10%"}},{body:h(_=>[r(N,{value:_.data.isExternalWork},null,8,["value"])]),_:1}),r(o,{style:{width:"10%"}},{body:h(_=>[e("i",{class:K([f(B).TIMES,"grid_delete_column_button"]),onClick:F=>T(F,_.data)},null,10,Ve)]),_:1})]),_:1},8,["value"]),r(q,{visible:d.visible,"onUpdate:visible":l[0]||(l[0]=_=>d.visible=_),header:d.title,closable:d.closable,modal:d.modal},{default:h(()=>[p.value?(g(),P(oe,{key:0,workmaster:a.workmaster,phase:p.value,onSubmit:i},null,8,["workmaster","phase"])):M("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),xe={class:"main"},Ee=S({__name:"Workmaster",setup(I){const b=X(),c=Y(),d=Z(),v=x(),m=re(),n=le(),C=D(),{workmaster:u}=ee(n),p=V("");te(async()=>{p.value=b.params.id,await s();let t="";t="Ruta de fabricació",u.value&&(t=`${t} ${m.getFullName(u.value.reference)}`),d.setMenuItem({icon:B.BUILDING,backButtonVisible:!0,title:t})});const s=async()=>{await m.fetchReferencesByModule("sales"),await n.fetchOne(p.value),C.fetchActiveModel()},i=async t=>{await n.update(p.value,t)&&await s()},k=async t=>{const o=await n.calculate(t.id);o.result?v.add({severity:"success",summary:"Cálcul de cost",detail:`${o.content} €`}):v.add({severity:"warn",summary:"Cálcul de cost",detail:o.errors.length>0?o.errors[0]:"Errors detectats durant el cálcul",life:1e4})},T=async t=>{await n.createPhase(t)&&c.push({path:`/workmaster/${p.value}/phase/${t.id}`})},a=t=>{c.push({path:`/workmaster/${p.value}/phase/${t.id}`})},l=async t=>{await n.deletePhase(t.id)};return(t,o)=>(g(),W(E,null,[e("header",null,[f(u)?(g(),P(Be,{key:0,workmaster:f(u),onCalculateCost:k,onSubmit:i},null,8,["workmaster"])):M("",!0)]),e("main",xe,[f(u)&&f(u).phases?(g(),P(We,{key:0,workmaster:f(u),workmasterPhases:f(u).phases,onAdd:T,onEdit:a,onDelete:l},null,8,["workmaster","workmasterPhases"])):M("",!0)])],64))}});const He=se(Ee,[["__scopeId","data-v-b77b9b04"]]);export{He as default};
