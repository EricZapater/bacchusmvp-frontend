import{d as E,x as q,z as D,J as A,r as P,h as I,m as $,w as V,l as g,a as y,e as d,i as u,k as f,P as w,n as C,p as M,b as j,f as L,j as F,c as N,y as B,F as T,v as R,u as z,o as O,H as G,K as H}from"./index-521883f7.js";import{u as U}from"./purchaseInvoiceStatus-f32e95b7.js";import{v as J}from"./v4-a960c1f4.js";import{c as K,a as x,F as Q}from"./form-validator-332bcf89.js";import"./index-f4f30149.js";import"./base.service-05d1da00.js";import"./suppliers.service-cf3d9ddf.js";const W=p=>(M("data-v-73dec45e"),p=p(),j(),p),X={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Y=W(()=>d("span",{class:"text-xl text-900 font-bold"},"Transicions",-1)),Z=["onClick"],ee=E({__name:"TablePurchaseInvoiceStatusTransitions",props:{purchaseInvoiceStatus:{}},emits:["add","delete"],setup(p,{emit:m}){const r=p,S=q(),c=U(),{purchaseInvoiceStatuses:o}=D(c),_=A(()=>{var e;let s=[];return(e=o.value)==null||e.forEach(t=>{var v,b,h;!((b=(v=r.purchaseInvoiceStatus)==null?void 0:v.transitions)==null?void 0:b.find(k=>k.id===t.id))&&t.id!==((h=r.purchaseInvoiceStatus)==null?void 0:h.id)&&s.push(t)}),s}),i=P(void 0),a=()=>{var e,t;const s={id:J(),fromStatusId:(e=r.purchaseInvoiceStatus)==null?void 0:e.id,toStatusId:(t=i.value)==null?void 0:t.id};m("add",s)},n=(s,e)=>{S.require({target:s.currentTarget,message:"Está segur que vol eliminar la transició?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{var t,l;m("delete",{id:(t=i.value)==null?void 0:t.id,fromStatusId:(l=r.purchaseInvoiceStatus)==null?void 0:l.id,toStatusId:e.id})}})};return(s,e)=>{const t=I("Dropdown"),l=I("Button"),v=I("Column"),b=I("DataTable");return s.purchaseInvoiceStatus?(y(),$(b,{key:0,class:"p-datatable-small",value:s.purchaseInvoiceStatus.transitions},{header:V(()=>[d("div",X,[Y,d("div",null,[u(t,{class:"status-selector",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=h=>i.value=h),options:_.value,placeholder:"Selecc. un estat",optionLabel:"name"},null,8,["modelValue","options"]),u(l,{icon:f(w).PLUS,rounded:"",raised:"",onClick:a},null,8,["icon"])])])]),default:V(()=>[u(v,{field:"name",header:"Nom"}),u(v,{field:"description",header:"Descripció"}),u(v,null,{body:V(h=>[d("i",{class:C([f(w).TIMES,"grid_delete_column_button"]),onClick:k=>n(k,h.data)},null,10,Z)]),_:1})]),_:1},8,["value"])):g("",!0)}}});const te=L(ee,[["__scopeId","data-v-73dec45e"]]),ae={key:0},se={class:"three-columns"},oe=d("label",{class:"block text-900 mb-2"},"Desactivat",-1),ne={class:"mt-2"},ce=E({__name:"FormPurchaseInvoiceStatus",props:{purchaseInvoiceStatus:{}},emits:["submit","cancel"],setup(p,{emit:m}){const r=p,S=F(),c=K().shape({name:x().required("El nom de l'estat és obligatori").max(50,"El nom de l'estat no pot superar els 50 caràcters"),description:x().required("La descripció de l'estat és obligatòri").max(250,"La descripció de l'estat no pot superar els 50 caràcters")}),o=P({result:!1,errors:{}}),_=()=>{const a=new Q(c);o.value=a.validate(r.purchaseInvoiceStatus)},i=async()=>{if(_(),o.value.result)m("submit",r.purchaseInvoiceStatus);else{let a="";Object.entries(o.value.errors).forEach(n=>{a+=`${n[1].map(s=>s)}.   `}),S.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,n)=>{const s=I("Checkbox"),e=I("Button");return a.purchaseInvoiceStatus?(y(),N("form",ae,[d("div",se,[u(B,{name:"name",class:C(["mb-2",{"p-invalid":o.value.errors.name}]),label:"Nom de l'estat",id:"name",modelValue:a.purchaseInvoiceStatus.name,"onUpdate:modelValue":n[0]||(n[0]=t=>a.purchaseInvoiceStatus.name=t)},null,8,["modelValue","class"]),u(B,{name:"description",class:C(["mb-2",{"p-invalid":o.value.errors.description}]),label:"Descripció",id:"description",modelValue:a.purchaseInvoiceStatus.description,"onUpdate:modelValue":n[1]||(n[1]=t=>a.purchaseInvoiceStatus.description=t)},null,8,["modelValue","class"]),d("div",null,[oe,u(s,{modelValue:a.purchaseInvoiceStatus.disabled,"onUpdate:modelValue":n[2]||(n[2]=t=>a.purchaseInvoiceStatus.disabled=t),class:"w-full",binary:!0},null,8,["modelValue"])])]),d("div",ne,[u(e,{label:"Guardar",class:"mr-2",onClick:i})])])):g("",!0)}}}),re=d("br",null,null,-1),he=E({__name:"PurchaseInvoiceStatus",setup(p){const m=P(T.EDIT),r=R(),S=z(),c=U(),{purchaseInvoiceStatus:o}=D(c),_=async()=>{await c.fetchPurchaseInvoiceStatus(r.params.id);let e="";o.value?(m.value=T.EDIT,e=`Estat de factura: ${o.value.name}`):(m.value=T.CREATE,c.setNewPurchaseInvoiceStatus(r.params.id),e="Alta d'estat de factura'"),S.setMenuItem({icon:w.POUND,backButtonVisible:!0,title:e})};O(async()=>{await _()});const i=F(),a=async()=>{const e=o.value;let t=!1,l="";m.value===T.CREATE?(t=await c.createPurchaseInvoiceStatus(e),l="Estat de factura creat correctament"):(t=await c.updatePurchaseInvoiceStatus(e.id,e),l="Estat de factura actualitzat correctament"),t&&(i.add({severity:"success",summary:l,life:5e3}),H.back())},n=async e=>{await c.createPurchaseInvoiceStatusTransition(e)||i.add({severity:"error",detail:"Error al crear la transició"})},s=async e=>{await c.deletePurchaseInvoiceStatusTransition(e)||i.add({severity:"error",detail:"Error al eliminar la transició"})};return(e,t)=>(y(),N(G,null,[f(o)?(y(),$(ce,{key:0,purchaseInvoiceStatus:f(o),onSubmit:a},null,8,["purchaseInvoiceStatus"])):g("",!0),re,u(te,{purchaseInvoiceStatus:f(o),onAdd:n,onDelete:s},null,8,["purchaseInvoiceStatus"])],64))}});export{he as default};
