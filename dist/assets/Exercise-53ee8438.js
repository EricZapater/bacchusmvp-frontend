import{d as _,j as C,r as I,h as p,c as N,e as o,i as n,n as v,y as V,l as F,a as h,F as b,g as T,v as g,u as U,z as $,o as L,k as y,m as R,P as S}from"./index-9ee31eec.js";import{c as q,a as E,e as k,f as A,F as M}from"./form-validator-7a510593.js";import{c as w}from"./functions-afe9fe15.js";import{u as z}from"./exercise-63354d5d.js";import"./v4-a960c1f4.js";import"./index-e87db629.js";import"./base.service-aa9daa2d.js";import"./reference.service-8d98e13b.js";const O={key:0},j={class:"two-columns"},G={class:"two-columns",style:{"margin-bottom":"1rem"}},P=o("label",{class:"block text-900 mb-2"},"Data inici",-1),J=o("label",{class:"block text-900 mb-2"},"Data fi",-1),H={class:"two-columns"},K=o("label",{class:"block text-900 mb-2"},"Comptador factures de compra",-1),Q=o("label",{class:"block text-900 mb-2"},"Desactivat",-1),W={class:"mt-2"},X=_({__name:"FormExercise",props:{exercise:{}},emits:["submit","cancel"],setup(D,{emit:d}){const i=D,u=C(),f=q().shape({name:E().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:E().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),startDate:k().required("La data d'inici es obligatoria"),endDate:k().required("La data final es obligatoria").min(A("startDate"),"La data final de l'exercici ha de ser posterior a l'inici")}),s=I({result:!1,errors:{}}),r=()=>{const e=new M(f);s.value=e.validate(i.exercise)},x=async()=>{if(r(),s.value.result)i.exercise.startDate=w(i.exercise.startDate),i.exercise.endDate=w(i.exercise.endDate),d("submit",i.exercise);else{let e="";Object.entries(s.value.errors).forEach(a=>{e+=`${a[1].map(t=>t)}.   `}),u.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,a)=>{const t=p("Calendar"),c=p("InputNumber"),m=p("Checkbox"),B=p("Button");return e.exercise?(h(),N("form",O,[o("div",j,[n(V,{class:v(["mb-2",{"p-invalid":s.value.errors.name}]),label:"Nom",id:"name",modelValue:e.exercise.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.exercise.name=l)},null,8,["modelValue","class"]),n(V,{class:v(["mb-2",{"p-invalid":s.value.errors.description}]),label:"Descripció",id:"description",modelValue:e.exercise.description,"onUpdate:modelValue":a[1]||(a[1]=l=>e.exercise.description=l)},null,8,["modelValue","class"])]),o("div",G,[o("div",null,[P,n(t,{modelValue:e.exercise.startDate,"onUpdate:modelValue":a[2]||(a[2]=l=>e.exercise.startDate=l),dateFormat:"dd/mm/yy",class:v({"p-invalid":s.value.errors.startDate})},null,8,["modelValue","class"])]),o("div",null,[J,n(t,{modelValue:e.exercise.endDate,"onUpdate:modelValue":a[3]||(a[3]=l=>e.exercise.endDate=l),dateFormat:"dd/mm/yy",class:v({"p-invalid":s.value.errors.endDate})},null,8,["modelValue","class"])])]),o("div",H,[o("div",null,[K,n(c,{modelValue:e.exercise.purchaseInvoiceCounter,"onUpdate:modelValue":a[4]||(a[4]=l=>e.exercise.purchaseInvoiceCounter=l),class:"w-full mb-2"},null,8,["modelValue"])]),o("div",null,[Q,n(m,{modelValue:e.exercise.disabled,"onUpdate:modelValue":a[5]||(a[5]=l=>e.exercise.disabled=l),class:"w-full",binary:!0},null,8,["modelValue"])])]),o("div",W,[n(B,{label:"Guardar",class:"mr-2",onClick:x})])])):F("",!0)}}}),le=_({__name:"Exercise",setup(D){const d=I(b.EDIT),i=T(),u=g(),f=U(),s=z(),{exercise:r}=$(s),x=async()=>{await s.fetchOne(u.params.id);let t="";r.value?(d.value=b.EDIT,t=`Exercici ${r.value.name}`,r.value.startDate=new Date(r.value.startDate),r.value.endDate=new Date(r.value.endDate)):(d.value=b.CREATE,s.setNew(u.params.id),t="Alta d'exercici"),f.setMenuItem({icon:S.BUILDING,backButtonVisible:!0,title:t})};L(async()=>{await x()});const e=C(),a=async()=>{const t=r.value;let c=!1,m="";d.value===b.CREATE?(c=await s.create(t),m="Exercici creat correctament"):(c=await s.update(t.id,t),m="Exercici actualizat correctament"),c&&(e.add({severity:"success",summary:m,life:5e3}),i.back())};return(t,c)=>y(r)?(h(),R(X,{key:0,exercise:y(r),onSubmit:a},null,8,["exercise"])):F("",!0)}});export{le as default};
