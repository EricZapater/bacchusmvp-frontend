import{_ as H}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-5542092c.js";import{_ as Y}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-afb24e99.js";import{d as z,g as Q,j as J,x as K,u as W,r as I,E as X,o as Z,P as m,h as f,c as k,i as a,w as c,k as r,G as ee,a as N,e as u,C as y,D as h,n as te,l as ae}from"./index-357c9d4c.js";import{u as se}from"./reference-35a8c4f2.js";import{u as oe}from"./customers-fff5daf9.js";import{u as ie}from"./lifecycle-1e4e7269.js";import{a as E,f as P,g as re}from"./functions-afe9fe15.js";import{u as le}from"./deliveryNote-b4efa973.js";import{u as ne}from"./masterData-e8e1356d.js";import"./form-validator-9d0a56f8.js";import"./reference.service-387fdae1.js";import"./base.service-d0780977.js";import"./index-44203410.js";import"./v4-a960c1f4.js";import"./index-876c29fd.js";const ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},de={class:"datatable-filter"},ue={class:"filter-field"},me={class:"filter-field"},fe=u("label",{class:"block text-900 mb-2"},"Client",-1),pe={class:"datatable-buttons"},_e=["onClick"],Be=z({__name:"DeliveryNotes",setup(ve){const x=Q(),C=J(),R=K(),l=W(),D=ne(),p=le(),B=se(),w=oe(),g=ie(),_=I({customerId:void 0,referenceId:void 0}),d=X({visible:!1,title:"Crear albarà",closable:!0,position:"center",modal:!0});Z(async()=>{g.fetchOneByName("DeliveryNote"),B.fetchReferences(),w.fetchCustomers(),await D.fetchMasterData(),T(),await b(),l.setMenuItem({icon:m.APPLE,title:"Albarans d'entrega"})});const T=()=>{var o;const s=new Date().getFullYear().toString(),e=(o=D.exercises)==null?void 0:o.find(i=>i.name===s);e&&(l.exercisePicker.exercise=e,l.exercisePicker.dates=[new Date(l.exercisePicker.exercise.startDate),new Date(l.exercisePicker.exercise.endDate)])},F=()=>{l.cleanExercisePicker(),_.value.customerId=void 0},v=I({}),V=()=>({id:re(),customerId:"",exerciseId:"",date:new Date}),q=()=>{v.value=V(),d.visible=!0},b=async()=>{if(l.exercisePicker.dates){const s=E(l.exercisePicker.dates[0]),e=E(l.exercisePicker.dates[1]);await p.GetFiltered(s,e,_.value.customerId)}else C.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},L=s=>{var o,i;const e=(i=(o=g.lifecycle)==null?void 0:o.statuses)==null?void 0:i.find(n=>n.id===s);return e?e.name:""},M=s=>{var o;const e=(o=w.customers)==null?void 0:o.find(i=>i.id===s);return e?e.comercialName:""},U=async()=>{d.visible=!1,await p.Create(v.value)&&x.push({path:`/deliverynote/${v.value.id}`})},$=s=>{s.originalEvent.target.className.includes("grid_delete_column_button")||x.push({path:`/deliverynote/${s.data.id}`})},j=(s,e)=>{R.require({message:"Està segur que vol eliminar l'albarà?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await p.Delete(e.id)&&(C.add({severity:"success",summary:"Eliminada",life:3e3}),await b())}})};return(s,e)=>{const o=f("Dropdown"),i=f("Button"),n=f("Column"),A=f("DataTable"),O=f("Dialog");return N(),k(ee,null,[a(A,{value:r(p).deliveryNotes,class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",onRowClick:$},{header:c(()=>[u("div",ce,[u("div",de,[u("div",ue,[a(H,{exercises:r(D).exercises,onRangeSelected:b},null,8,["exercises"])]),u("div",me,[fe,a(o,{modelValue:_.value.customerId,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value.customerId=t),editable:"",options:r(w).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),u("div",pe,[a(i,{class:"datatable-button mr-2",icon:r(m).FILTER,rounded:"",raised:"",onClick:b},null,8,["icon"]),a(i,{class:"datatable-button mr-2",icon:r(m).FILTER_SLASH,rounded:"",raised:"",onClick:F},null,8,["icon"]),a(i,{icon:r(m).PLUS,rounded:"",raised:"",onClick:q},null,8,["icon"])])])]),default:c(()=>[a(n,{field:"number",header:"Número",style:{width:"15%"}}),a(n,{header:"Data Creació",style:{width:"15%"}},{body:c(t=>[y(h(r(P)(t.data.createdOn)),1)]),_:1}),a(n,{header:"Data Entrega",style:{width:"15%"}},{body:c(t=>[y(h(t.data.deliveryDate?r(P)(t.data.deliveryDate):""),1)]),_:1}),a(n,{header:"Client",style:{width:"30%"}},{body:c(t=>[y(h(M(t.data.customerId)),1)]),_:1}),a(n,{header:"Estat",style:{width:"30%"}},{body:c(t=>[y(h(L(t.data.statusId)),1)]),_:1}),a(n,{style:{width:"5%"}},{body:c(t=>{var S;return[t.data.statusId===((S=r(g).lifecycle)==null?void 0:S.initialStatusId)?(N(),k("i",{key:0,class:te([r(m).TIMES,"grid_delete_column_button"]),onClick:G=>j(G,t.data)},null,10,_e)):ae("",!0)]}),_:1})]),_:1},8,["value"]),a(O,{visible:d.visible,"onUpdate:visible":e[1]||(e[1]=t=>d.visible=t),header:d.title,closable:d.closable,modal:d.modal},{default:c(()=>[a(Y,{"create-request":v.value,onSubmit:U},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Be as default};
