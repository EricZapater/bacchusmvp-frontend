import{d as G,j as U,u as z,r as S,o as A,P as f,h as p,c as L,i as o,w as r,k as v,a as O,e as i,D,E as _,n as w,p as R,b as j,f as H}from"./index-c73e34a4.js";import{u as $,a as q,S as x}from"./purchaseInvoices-2b0e1aac.js";import{f as I,a as C,c as K}from"./functions-028ffd6d.js";import"./exercise.service-4fe4f098.js";import"./base.service-02c1db1f.js";import"./paymentmethod.service-105d0201.js";import"./tax.service-f18ef59d.js";import"./index-c36f6e5b.js";import"./suppliers.service-c2e91e78.js";const M=h=>(R("data-v-d9b040c5"),h=h(),j(),h),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},W={class:"datatable-filter"},J={class:"filter-field"},X=M(()=>i("label",{class:"block text-900 mb-2"},"Període",-1)),Y={class:"filter-field"},Z=M(()=>i("label",{class:"block text-900 mb-2 mr-3"},"Amagar Gestionades",-1)),ee={class:"flex flex-wrap gap-3"},te={class:"flex align-items-center"},ae={class:"datatable-buttons"},se=["onClick"],oe=G({__name:"PurchaseInvoicesByDates",setup(h){const g=U(),B=z(),u=$(),b=q(),l=S({dates:void 0,startDate:void 0,endDate:void 0,excludeManaged:!1}),m=S([]);A(async()=>{u.fetchMasterData(),B.setMenuItem({icon:f.SERVER,title:"Comptabilització de factures"})});const k=t=>{var a;const e=(a=u.masterData.suppliers)==null?void 0:a.find(n=>n.id===t);return e?e.comercialName:""},F=t=>{var a;const e=(a=u.masterData.statuses)==null?void 0:a.find(n=>n.id===t);return e?e.name:""},N=t=>t.purchaseInvoiceDueDates?t.purchaseInvoiceDueDates.length===0?I(t.purchaseInvoiceDate):I(t.purchaseInvoiceDueDates[t.purchaseInvoiceDueDates.length-1].dueDate):"",P=t=>{var a;const e=(a=u.masterData.statuses)==null?void 0:a.find(n=>n.name==="Gestionada");return e&&e.id===t},y=async()=>{var t;if(l.value.dates){let e;l.value.excludeManaged===!0&&(e=(t=u.masterData.statuses)==null?void 0:t.find(d=>d.name==="Gestionada"));const a=C(l.value.dates[0]),n=C(l.value.dates[1]),c=e?e.id:void 0;await b.GetFiltered(a,n,void 0,c)}else g.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},V=async()=>{var e;const t=(e=u.masterData.statuses)==null?void 0:e.find(a=>a.name==="Gestionada");if(t){const n={ids:m.value.map(d=>d.id),statusToId:t.id},c=await b.UpdateInvoicesStatus(n);console.log("UpdateInvoicesStatus",c),c&&(g.add({severity:"success",summary:"Comptabilització de factures",detail:`Factures comptabilitzades: ${m.value.length}`,life:5e3}),await y())}},T=async t=>{const e=await x.File.GetEntityFiles("PurchaseInvoice",t.id);e&&e.forEach(async a=>{const n=await x.File.Download(a);K(a.originalName,n)})};return(t,e)=>{const a=p("Calendar"),n=p("Checkbox"),c=p("Button"),d=p("Column"),E=p("DataTable");return O(),L("div",null,[o(E,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"70vh",sortMode:"multiple",value:v(b).purchaseInvoices,selection:m.value,"onUpdate:selection":e[2]||(e[2]=s=>m.value=s)},{header:r(()=>[i("div",Q,[i("div",W,[i("div",J,[X,o(a,{modelValue:l.value.dates,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.dates=s),numberOfMonths:2,selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),i("div",Y,[Z,i("div",ee,[i("div",te,[o(n,{modelValue:l.value.excludeManaged,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.excludeManaged=s),binary:!0,onChange:y},null,8,["modelValue"])])])])]),i("div",ae,[o(c,{class:"datatable-button",icon:v(f).FILTER,rounded:"",raised:"",onClick:y},null,8,["icon"]),o(c,{icon:v(f).CHECK,disabled:m.value.length===0,rounded:"",raised:"",severity:"success",onClick:V},null,8,["icon","disabled"])])])]),default:r(()=>[o(d,{selectionMode:"multiple",style:{width:"2%"}}),o(d,{field:"number",header:"Número",sortable:"",style:{width:"10%"}}),o(d,{header:"Proveïdor",style:{width:"15%"}},{body:r(s=>[D(_(k(s.data.supplierId)),1)]),_:1}),o(d,{header:"Num Fra. Proveïdor",style:{width:"12%"},field:"supplierNumber"}),o(d,{header:"Estat",style:{width:"15%"}},{body:r(s=>[i("span",{class:w({"managed-status":P(s.data.purchaseInvoiceStatusId)})},_(F(s.data.purchaseInvoiceStatusId)),3)]),_:1}),o(d,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:r(s=>[D(_(v(I)(s.data.purchaseInvoiceDate)),1)]),_:1}),o(d,{header:"Venciment",style:{width:"15%"}},{body:r(s=>[D(_(N(s.data)),1)]),_:1}),o(d,{field:"baseAmount",header:"Import Base",style:{width:"15%"}}),o(d,{style:{width:"2%"}},{body:r(s=>[i("i",{class:w([v(f).DOWNLOAD,"download_column"]),onClick:ne=>T(s.data)},null,10,se)]),_:1})]),_:1},8,["value","selection"])])}}});const he=H(oe,[["__scopeId","data-v-d9b040c5"]]);export{he as default};
