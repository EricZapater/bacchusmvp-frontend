import{d as k,j as w,r as C,h as u,c as B,e as t,i,n as m,y as V,l as _,a as I,F as p,v as N,u as g,z as T,o as U,k as D,m as $,P as L,C as q}from"./index-8ef16467.js";import{c as A,a as y,e as E,f as M,F as R}from"./form-validator-167199ef.js";import{u as S}from"./exercise-94099bb1.js";import"./exercise.service-bb122a0d.js";import"./base.service-01d8aabb.js";const z={key:0},j={class:"two-columns"},G={class:"two-columns",style:{"margin-bottom":"1rem"}},O=t("label",{class:"block text-900 mb-2"},"Data inici",-1),P=t("label",{class:"block text-900 mb-2"},"Data fi",-1),H={class:"two-columns"},J=t("label",{class:"block text-900 mb-2"},"Comptador factures de compra",-1),K=t("label",{class:"block text-900 mb-2"},"Desactivat",-1),Q={class:"mt-2"},W=k({__name:"FormExercise",props:{exercise:{}},emits:["submit","cancel"],setup(x,{emit:n}){const c=x,v=w(),l=A().shape({name:y().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:y().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),startDate:E().required("La data d'inici es obligatoria"),endDate:E().required("La data final es obligatoria").min(M("startDate"),"La data final de l'exercici ha de ser posterior a l'inici")}),s=C({result:!1,errors:{}}),b=()=>{const a=new R(l);s.value=a.validate(c.exercise)},f=async()=>{if(b(),s.value.result)n("submit",c.exercise);else{let a="";Object.entries(s.value.errors).forEach(e=>{a+=`${e[1].map(r=>r)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const r=u("Calendar"),d=u("InputNumber"),F=u("Checkbox"),h=u("Button");return a.exercise?(I(),B("form",z,[t("div",j,[i(V,{class:m(["mb-2",{"p-invalid":s.value.errors.name}]),label:"Nom",id:"name",modelValue:a.exercise.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.exercise.name=o)},null,8,["modelValue","class"]),i(V,{class:m(["mb-2",{"p-invalid":s.value.errors.description}]),label:"Descripció",id:"description",modelValue:a.exercise.description,"onUpdate:modelValue":e[1]||(e[1]=o=>a.exercise.description=o)},null,8,["modelValue","class"])]),t("div",G,[t("div",null,[O,i(r,{modelValue:a.exercise.startDate,"onUpdate:modelValue":e[2]||(e[2]=o=>a.exercise.startDate=o),dateFormat:"dd/mm/yy",class:m({"p-invalid":s.value.errors.startDate})},null,8,["modelValue","class"])]),t("div",null,[P,i(r,{modelValue:a.exercise.endDate,"onUpdate:modelValue":e[3]||(e[3]=o=>a.exercise.endDate=o),dateFormat:"dd/mm/yy",class:m({"p-invalid":s.value.errors.endDate})},null,8,["modelValue","class"])])]),t("div",H,[t("div",null,[J,i(d,{modelValue:a.exercise.purchaseInvoiceCounter,"onUpdate:modelValue":e[4]||(e[4]=o=>a.exercise.purchaseInvoiceCounter=o),class:"w-full mb-2"},null,8,["modelValue"])]),t("div",null,[K,i(F,{modelValue:a.exercise.disabled,"onUpdate:modelValue":e[5]||(e[5]=o=>a.exercise.disabled=o),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("div",Q,[i(h,{label:"Guardar",class:"mr-2",onClick:f})])])):_("",!0)}}}),se=k({__name:"Exercise",setup(x){const n=C(p.EDIT),c=N(),v=g(),l=S(),{exercise:s}=T(l),b=async()=>{await l.fetchOne(c.params.id);let e="";s.value?(n.value=p.EDIT,e=`Exercici ${s.value.name}`,s.value.startDate=new Date(s.value.startDate),s.value.endDate=new Date(s.value.endDate)):(n.value=p.CREATE,l.setNew(c.params.id),e="Alta d'exercici"),v.setMenuItem({icon:L.BUILDING,backButtonVisible:!0,title:e})};U(async()=>{await b()});const f=w(),a=async()=>{const e=s.value;let r=!1,d="";n.value===p.CREATE?(r=await l.create(e),d="Exercici creat correctament"):(r=await l.update(e.id,e),d="Exercici actualizat correctament"),r&&(f.add({severity:"success",summary:d,life:5e3}),q.back())};return(e,r)=>D(s)?(I(),$(W,{key:0,exercise:D(s),onSubmit:a},null,8,["exercise"])):_("",!0)}});export{se as default};
