import{d as b,D as y,b as V,r as S,g as I,i as n,a as E,c as k,h as v,n as f,E as T,j as C,p as F,G as u,z as x,u as N,o as g,q as h,P as D,I as $}from"./index-97eeca01.js";import{u as B}from"./suppliers-91d30246.js";import{c as A,a as _,F as M}from"./form-validator-58b9052d.js";const R={key:0},q={class:"mt-2"},z=b({__name:"FormSupplierType",emits:["submit"],setup(w,{emit:i}){const c=B(),{supplierType:s}=y(c),t=V(),l=A().shape({name:_().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),description:_().required("La descripció és obligatori").max(250,"La descripció no pot superar els 250 carácters")}),o=S({result:!1,errors:{}}),p=()=>{const e=new M(l);o.value=e.validate(s.value)},m=async()=>{if(p(),o.value.result)i("submit",s.value);else{let e="";Object.entries(o.value.errors).forEach(a=>{e+=`${a[1].map(r=>r)}.   `}),t.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,a)=>{const r=I("Button");return n(s)?(E(),k("form",R,[v(T,{class:f(["mb-2",{"p-invalid":o.value.errors.name}]),label:"Nom",id:"name",modelValue:n(s).name,"onUpdate:modelValue":a[0]||(a[0]=d=>n(s).name=d)},null,8,["modelValue","class"]),v(T,{class:f(["mb-2",{"p-invalid":o.value.errors.description}]),label:"Descripció",id:"description",modelValue:n(s).description,"onUpdate:modelValue":a[1]||(a[1]=d=>n(s).description=d)},null,8,["modelValue","class"]),C("div",q,[v(r,{label:"Guardar",class:"mr-2",onClick:m})])])):F("",!0)}}}),j=b({__name:"SupplierType",setup(w){const i=S(u.EDIT),c=x(),s=N(),t=B(),{supplierType:l}=y(t),o=async()=>{await t.fetchSupplierType(c.params.id);let e="";l.value?(i.value=u.EDIT,e=`Tipus de proveïdor ${l.value.name}`):(i.value=u.CREATE,t.setNewSupplierType(c.params.id),e="Alta de tipus de proveïdor"),s.setMenuItem({icon:D.BUILDING,backButtonVisible:!0,text:e})};g(async()=>{await o()});const p=V(),m=async()=>{const e=l.value;let a=!1,r="";i.value===u.CREATE?(a=await t.createSupplierType(e),r="Tipus de proveïdor creat correctament"):(a=await t.updateSupplierType(e.id,e),r="Tipus de proveïdor actualizat correctament"),a&&(p.add({severity:"success",summary:r,life:5e3}),$.back())};return(e,a)=>(E(),h(z,{onSubmit:m}))}});export{j as default};
