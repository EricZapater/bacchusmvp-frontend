import{K as se,a as D,c as P,e as s,L as j,M as R,d as K,j as W,r as z,o as H,h as F,i as n,w as C,D as Y,k as a,P as S,G as le,N as ne,n as g,l as M,f as X,z as Z,m as q,y as A,s as U,C as ie,p as re,b as ue,F as L,v as de,g as ce,u as pe}from"./index-c46bd0de.js";import{a as ee,u as te}from"./purchaseInvoices-06c31911.js";import{c as me,a as Q,F as ve}from"./form-validator-55828ee4.js";import{F as be}from"./file.service-ee93ebfd.js";import{c as fe,f as ye}from"./functions-028ffd6d.js";import"./index-1652550b.js";import"./base.service-a5cc43bf.js";import"./index-ba0630fe.js";import"./suppliers.service-338b0447.js";var ae={name:"Toolbar",extends:se,props:{"aria-labelledby":{type:String,default:null}}};const Ie=["aria-labelledby"];function _e(i,b,I,d,p,u){return D(),P("div",R({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":i.ariaLabelledby},i.ptm("root")),[s("div",R({class:"p-toolbar-group-start p-toolbar-group-left"},i.ptm("start")),[j(i.$slots,"start")],16),s("div",R({class:"p-toolbar-group-center"},i.ptm("center")),[j(i.$slots,"center")],16),s("div",R({class:"p-toolbar-group-end p-toolbar-group-right"},i.ptm("end")),[j(i.$slots,"end")],16)],16,Ie)}function he(i,b){b===void 0&&(b={});var I=b.insertAt;if(!(!i||typeof document>"u")){var d=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css",I==="top"&&d.firstChild?d.insertBefore(p,d.firstChild):d.appendChild(p),p.styleSheet?p.styleSheet.cssText=i:p.appendChild(document.createTextNode(i))}}var xe=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;he(xe);ae.render=_e;const Ve={class:"base_input"},ge={class:"file-viewer"},De={class:"file-viewer-item-type"},we={class:"file-viewer-item-actions"},Fe=["onClick"],Ae=["onClick"],Pe=K({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(i){const b=i,I=W(),d=new be,p=z(void 0),u=async()=>{p.value=await d.GetEntityFiles(b.entity,b.id)};H(async()=>{await u()});const e=async()=>{const l=document.createElement("input");l.type="file",l.onchange=async V=>{const w=V.target.files[0];if(!await d.Upload(w,b.entity,b.id)){I.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await u()},l.click()},m=async l=>{const V=await d.Download(l);fe(l.originalName,V)},$=async l=>{var V=await d.Delete(l.id);if(!V){I.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await u()};return(l,V)=>{const w=F("Button");return D(),P("div",Ve,[n(a(ae),null,{start:C(()=>[s("h4",null,Y(l.title),1)]),end:C(()=>[n(w,{size:"small",rounded:"",icon:a(S).UPLOAD,onClick:e},null,8,["icon"])]),_:1}),s("section",ge,[(D(!0),P(le,null,ne(p.value,r=>(D(),P("article",{class:"file-viewer-item",key:l.id},[s("div",De,[r.type===0?(D(),P("i",{key:0,class:g(a(S).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):M("",!0),r.type===1?(D(),P("i",{key:1,class:g(a(S).IMAGE),style:{"font-size":"3.5rem"}},null,2)):M("",!0),s("p",null,Y(r.originalName.substring(0,20)),1)]),s("div",we,[s("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:_=>m(r)},[s("i",{class:g(a(S).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,Fe),s("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:_=>$(r)},[s("i",{class:g(a(S).TIMES)},null,2)],8,Ae)])]))),128))])])}}});const Ce=X(Pe,[["__scopeId","data-v-dd7a228d"]]),T=i=>(re("data-v-1d4a3b00"),i=i(),ue(),i),Te={key:0},ke={class:"four-columns"},Se=T(()=>s("label",{class:"block text-900 mb-2"},"Exercici",-1)),$e=T(()=>s("label",{class:"block text-900 mb-2"},"Sèrie",-1)),Ee=T(()=>s("label",{class:"block text-900 mb-2"},"Estat",-1)),Ne={class:"four-columns"},Ue={class:"mt-1"},Me=T(()=>s("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),Be={class:"mt-1"},Re={class:"mt-1"},Le=T(()=>s("label",{class:"block text-900 mb-2"},"Data Factura",-1)),ze={class:"mt-1"},Ge=T(()=>s("label",{class:"block text-900 mb-2"},"Forma de pagament",-1)),Oe={class:"four-columns"},je={class:"mt-1"},Ye={class:"mt-1"},qe={class:"mt-1"},Ke=T(()=>s("label",{class:"block text-900 mb-2"},"IVA",-1)),We={class:"mt-1"},He={class:"four-columns"},Je={class:"mt-1"},Qe={class:"mt-1"},Xe={class:"mt-3"},Ze=K({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(i,{emit:b}){const I=i,d=z(),p=ee(),u=te(),{purchaseInvoice:e}=Z(p),m=W(),$=me().shape({exerciceId:Q().required("L'exercici es obligatori"),supplierId:Q().required("El proveïdor es obligatori")}),l=z({result:!1,errors:{}}),V=()=>{const v=new ve($);l.value=v.validate(I.purchaseInvoice)};let w=!1;H(()=>{setTimeout(()=>w=!0,1e3),d.value=I.purchaseInvoice.id});const r=async()=>{if(V(),l.value.result)b("submit",e.value);else{let v="";Object.entries(l.value.errors).forEach(t=>{v+=`${t[1].map(c=>c)}.   `}),m.add({severity:"warn",summary:"Formulari inválid",detail:v,life:5e3})}},_=()=>{var t;const v=(t=u.masterData.suppliers)==null?void 0:t.find(c=>{var h;return c.id===((h=e.value)==null?void 0:h.supplierId)});v&&(e.value.paymentMethodId=v.paymentMethodId)},f=async()=>{var t;if(w&&e.value&&e.value.baseAmount!==0){let c=0,h=0,x=0,y=0,k=0,E=0,N=0,o=0,B=0,G=0,O=0;e.value.baseAmount&&(c=parseFloat(e.value.baseAmount.toFixed(2))),e.value.transportAmount&&(h=parseFloat(e.value.transportAmount.toFixed(2))),e.value.discountPercentage&&(o=parseFloat(e.value.discountPercentage.toFixed(2))),e.value.extraTaxPercentatge&&(G=e.value.extraTaxPercentatge);var v=(t=u.masterData.taxes)==null?void 0:t.find(oe=>{var J;return oe.id===((J=e.value)==null?void 0:J.taxId)});v&&(y=parseFloat(v.percentatge.toFixed(2))),x=(c+h)*1,k=x*(y/100),O=x*(G/100),B=x+k*1-O*1,N=B*(1*o)/100,E=parseFloat((B-N).toFixed(2)),e.value.baseAmount=c,e.value.transportAmount=h,e.value.subtotal=x,e.value.taxAmount=k,e.value.grossAmount=B,e.value.netAmount=E,e.value.discountPercentage=o,e.value.discountAmount=N,e.value.extraTaxPercentatge=G,e.value.extraTaxAmount=O,e.value.purchaseInvoiceDueDates=await p.GetDueDates(e.value)}};return(v,t)=>{const c=F("Dropdown"),h=F("Calendar"),x=F("Column"),y=F("DataTable"),k=F("Button"),E=F("TabPanel"),N=F("TabView");return D(),q(N,null,{default:C(()=>[n(E,{header:"Factura"},{default:C(()=>[a(e)?(D(),P("form",Te,[s("section",ke,[n(A,{label:"Num. Fra. Intern",id:"number",modelValue:a(e).number,"onUpdate:modelValue":t[0]||(t[0]=o=>a(e).number=o),disabled:""},null,8,["modelValue"]),s("div",null,[Se,n(c,{modelValue:a(e).exerciceId,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).exerciceId=o),editable:"",options:a(u).masterData.exercises,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":l.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),s("div",null,[$e,n(c,{modelValue:a(e).purchaseInvoiceSerieId,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).purchaseInvoiceSerieId=o),editable:"",options:a(u).masterData.series,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":l.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),s("div",null,[Ee,n(c,{modelValue:a(e).purchaseInvoiceStatusId,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).purchaseInvoiceStatusId=o),editable:"",options:a(u).masterData.statuses,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":l.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),s("section",Ne,[s("div",Ue,[Me,n(c,{modelValue:a(e).supplierId,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).supplierId=o),editable:"",options:a(u).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",onChange:_,class:g(["w-full",{"p-invalid":l.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),s("div",Be,[n(A,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:a(e).supplierNumber,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).supplierNumber=o)},null,8,["modelValue"])]),s("div",Re,[Le,n(h,{id:"purchaseInvoiceDate",modelValue:a(e).purchaseInvoiceDate,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).purchaseInvoiceDate=o),onDateSelect:t[7]||(t[7]=o=>f())},null,8,["modelValue"])]),s("div",ze,[Ge,n(c,{modelValue:a(e).paymentMethodId,"onUpdate:modelValue":[t[8]||(t[8]=o=>a(e).paymentMethodId=o),t[9]||(t[9]=o=>f())],editable:"",options:a(u).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":l.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])])]),s("section",Oe,[s("div",je,[n(A,{type:a(U).CURRENCY,label:"Base",id:"baseAmount",modelValue:a(e).baseAmount,"onUpdate:modelValue":[t[10]||(t[10]=o=>a(e).baseAmount=o),t[11]||(t[11]=o=>f())]},null,8,["type","modelValue"])]),s("div",Ye,[n(A,{type:a(U).CURRENCY,label:"Ports",id:"transportAmount",modelValue:a(e).transportAmount,"onUpdate:modelValue":[t[12]||(t[12]=o=>a(e).transportAmount=o),t[13]||(t[13]=o=>f())]},null,8,["type","modelValue"])]),s("div",qe,[Ke,n(c,{modelValue:a(e).taxId,"onUpdate:modelValue":[t[14]||(t[14]=o=>a(e).taxId=o),t[15]||(t[15]=o=>f())],editable:"",options:a(u).masterData.taxes,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":l.value.errors.taxId}])},null,8,["modelValue","options","class"])]),s("div",We,[n(A,{type:a(U).NUMERIC,label:"IRPF",id:"extraTaxPercentatge",modelValue:a(e).extraTaxPercentatge,"onUpdate:modelValue":[t[16]||(t[16]=o=>a(e).extraTaxPercentatge=o),t[17]||(t[17]=o=>f())]},null,8,["type","modelValue"])])]),s("section",He,[s("div",Je,[n(A,{type:a(U).NUMERIC,decimals:2,label:"% Dto.",id:"discountPercentage",modelValue:a(e).discountPercentage,"onUpdate:modelValue":[t[18]||(t[18]=o=>a(e).discountPercentage=o),t[19]||(t[19]=o=>f())]},null,8,["type","modelValue"])]),s("div",Qe,[n(A,{type:a(U).CURRENCY,label:"Total",id:"netAmount",modelValue:a(e).netAmount,"onUpdate:modelValue":t[20]||(t[20]=o=>a(e).netAmount=o),disabled:""},null,8,["type","modelValue"])])])])):M("",!0),s("div",Xe,[n(y,{value:a(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:C(()=>[n(x,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:C(o=>[ie(Y(a(ye)(o.data.dueDate)),1)]),_:1}),n(x,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),n(k,{label:"Guardar",class:"save_button",onClick:r})]),_:1}),n(E,{header:"Fitxers"},{default:C(()=>[n(k,{label:"Guardar",class:"save_button",onClick:r}),d.value?(D(),q(Ce,{key:0,title:"Factures",entity:"PurchaseInvoice",id:d.value},null,8,["id"])):M("",!0)]),_:1})]),_:1})}}});const et=X(Ze,[["__scopeId","data-v-1d4a3b00"]]),dt=K({__name:"PurchaseInvoice",setup(i){const b=z(L.EDIT),I=de(),d=ce(),p=pe(),u=te(),e=ee(),{purchaseInvoice:m}=Z(e),$=async()=>{await e.GetById(I.params.id);let r="";m.value?(b.value=L.EDIT,r=`Factura de compra: ${m.value.number}`,m.value.purchaseInvoiceDate=new Date(m.value.purchaseInvoiceDate)):(b.value=L.CREATE,e.setNewPurchaseInvoice(I.params.id),r="Alta de factures de compra",l()),p.setMenuItem({icon:S.POUND,backButtonVisible:!0,title:r})},l=()=>{var r,_,f,v;if(m.value){const t=(r=u.masterData.exercises)==null?void 0:r.find(y=>y.name===new Date().getFullYear().toString());t&&(m.value.exerciceId=t.id);const c=(_=u.masterData.series)==null?void 0:_.find(y=>y.name==="Nacional");c&&(m.value.purchaseInvoiceSerieId=c.id);const h=(f=u.masterData.statuses)==null?void 0:f.find(y=>y.name==="Nova");h&&(m.value.purchaseInvoiceStatusId=h.id);const x=(v=u.masterData.taxes)==null?void 0:v.find(y=>y.name==="IVA 21%");x&&(m.value.taxId=x.id)}};H(async()=>{await $()});const V=W(),w=async()=>{const r=m.value;let _=!1,f="";b.value===L.CREATE?await e.Create(r)===!0&&(_=!0,f="Factura creada correctament"):await e.Update(r)===!0&&(_=!0,f="Factura actualizada correctament"),_&&(V.add({severity:"success",summary:f,life:5e3}),d.back())};return(r,_)=>a(m)?(D(),q(et,{key:0,purchaseInvoice:a(m),onSubmit:w},null,8,["purchaseInvoice"])):M("",!0)}});export{dt as default};
