import{_ as oe}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-b9108072.js";import{d as $,x as O,h as p,a as g,m as S,w as v,e as o,i as s,k as d,P as B,C as L,D as W,B as ie,n as D,j as A,r as P,c as U,s as T,y as C,l as M,v as ne,u as re,z as de,E as me,o as ue,F as k,G as ce}from"./index-3b8fad0b.js";import{g as j}from"./functions-2e154ea4.js";import{u as q}from"./plantmodel-4f98e0d8.js";import{u as z}from"./workmaster-f910fa28.js";import{c as G,d as N,F as x,a as pe}from"./form-validator-f8953ae6.js";import{u as F}from"./reference-e0518f57.js";import{_ as fe}from"./DropdownReference.vue_vue_type_script_setup_true_lang-f8a66cf5.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./index-60183c2e.js";import"./base.service-95f208f7.js";import"./reference.service-d6c42ab4.js";const be={class:"flex flex-wrap align-items-center justify-content-between gap-2"},he=o("span",{class:"text-xl text-900 font-bold"},"Pasos de fabricació",-1),ve=["onClick"],ye=$({__name:"TableWorkmasterPhaseDetails",props:{workmasterPhase:{},details:{}},emits:["add","edit","delete"],setup(V,{emit:c}){const f=V,w=O();z();const b=q(),y=a=>{var m;if(!b.machineStatuses)return"";const t=(m=b.machineStatuses)==null?void 0:m.find(h=>a===h.id);return t?t.name:""},r=()=>{const a={id:j(),workMasterPhaseId:f.workmasterPhase.id,estimatedTime:0,isCycleTime:!1,machineStatusId:"",comment:"",order:_()};c("add",a)},_=()=>{let a=10;return f.details?(f.details.length+1)*10:a},l=a=>{a.originalEvent.target.className.includes("grid_delete_column_button")||c("edit",a.data)},e=(a,t)=>{w.require({target:a.currentTarget,message:"Está segur que vol eliminar el pas de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{c("delete",t)}})};return(a,t)=>{const m=p("Button"),h=p("Column"),u=p("DataTable");return g(),S(u,{onRowClick:l,value:a.details,tableStyle:"min-width: 100%","sort-field":"order","sort-order":1},{header:v(()=>[o("div",be,[he,s(m,{icon:d(B).PLUS,rounded:"",raised:"",onClick:r},null,8,["icon"])])]),default:v(()=>[s(h,{sortable:"",field:"order",header:"Ordre",style:{width:"10%"}}),s(h,{header:"Estat de màquina",style:{width:"25%"}},{body:v(n=>[L(W(y(n.data.machineStatusId)),1)]),_:1}),s(h,{field:"estimatedTime",header:"Temps (min)",style:{width:"25%"}}),s(h,{header:"Temps de cicle",style:{width:"25%"}},{body:v(n=>[s(ie,{value:n.data.isCycleTime},null,8,["value"])]),_:1}),s(h,{style:{width:"25%"}},{body:v(n=>[o("i",{class:D([d(B).TIMES,"grid_delete_column_button"]),onClick:E=>e(E,n.data)},null,10,ve)]),_:1})]),_:1},8,["value"])}}}),_e={key:0},Ie={class:"four-columns"},we=o("label",{class:"block text-900 mb-2"},"Estat",-1),ke=o("label",{class:"block text-900v mb-1"},"Temps de cicle",-1),ge={class:"mt-3"},Ve=o("label",{class:"block text-900v mb-1"},"Comentari fabricació",-1),Te=o("br",null,null,-1),Ce=$({__name:"FormWorkmasterPhaseDetail",props:{detail:{}},emits:["submit","cancel"],setup(V,{emit:c}){const f=V,w=q(),b=A(),y=G().shape({order:N().required("L'ordre és obligatori").positive("L'ordre ha de ser positiu"),estimatedTime:N().required("El temps estimat és obligatori")}),r=P({result:!1,errors:{}}),_=()=>{const e=new x(y);r.value=e.validate(f.detail)},l=async()=>{if(_(),r.value.result)c("submit",f.detail);else{let e="";Object.entries(r.value.errors).forEach(a=>{e+=`${a[1].map(t=>t)}.   `}),b.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,a)=>{const t=p("Dropdown"),m=p("Checkbox"),h=p("Textarea"),u=p("Button");return e.detail?(g(),U("form",_e,[o("section",Ie,[o("div",null,[s(C,{type:d(T).NUMERIC,label:"Ordre",modelValue:e.detail.order,"onUpdate:modelValue":a[0]||(a[0]=n=>e.detail.order=n),class:D({"p-invalid":r.value.errors.order})},null,8,["type","modelValue","class"])]),o("div",null,[we,s(t,{modelValue:e.detail.machineStatusId,"onUpdate:modelValue":a[1]||(a[1]=n=>e.detail.machineStatusId=n),editable:"",options:d(w).machineStatuses,optionValue:"id",optionLabel:"description",class:D(["w-full",{"p-invalid":r.value.errors.machineStatusId}])},null,8,["modelValue","options","class"])]),o("div",null,[ke,s(m,{modelValue:e.detail.isCycleTime,"onUpdate:modelValue":a[2]||(a[2]=n=>e.detail.isCycleTime=n),class:"w-full",binary:!0},null,8,["modelValue"])]),o("div",null,[s(C,{type:d(T).NUMERIC,decimals:2,label:"Temps estimat (min)",modelValue:e.detail.estimatedTime,"onUpdate:modelValue":a[3]||(a[3]=n=>e.detail.estimatedTime=n),class:D({"p-invalid":r.value.errors.estimatedTime})},null,8,["type","modelValue","class"])])]),o("div",ge,[Ve,s(h,{class:"w-full",modelValue:e.detail.comment,"onUpdate:modelValue":a[4]||(a[4]=n=>e.detail.comment=n)},null,8,["modelValue"])]),Te,o("div",null,[s(u,{label:"Guardar pas",style:{float:"right"},size:"small",onClick:l})])])):M("",!0)}}}),Ee={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Pe=o("span",{class:"text-xl text-900 font-bold"},"Materials de fabricació",-1),Me=["onClick"],De=$({__name:"TableWorkmasterPhaseBillOfMaterials",props:{workmasterPhase:{},billOfMaterials:{}},emits:["add","edit","delete"],setup(V,{emit:c}){const f=V,w=O(),b=F(),y=e=>{var t;if(!b.references)return"";const a=(t=b.references)==null?void 0:t.find(m=>e===m.id);return a?b.getFullName(a):""},r=()=>{const e={id:j(),workMasterPhaseId:f.workmasterPhase.id,referenceId:"",quantity:0,width:0,diameter:0,height:0,length:0,thickness:0};c("add",e)},_=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||c("edit",e.data)},l=(e,a)=>{w.require({target:e.currentTarget,message:"Está segur que vol eliminar el material de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{c("delete",a)}})};return(e,a)=>{const t=p("Button"),m=p("Column"),h=p("DataTable");return g(),S(h,{onRowClick:_,value:e.billOfMaterials,tableStyle:"min-width: 100%"},{header:v(()=>[o("div",Ee,[Pe,s(t,{icon:d(B).PLUS,rounded:"",raised:"",onClick:r},null,8,["icon"])])]),default:v(()=>[s(m,{header:"Material consum",style:{width:"30%"}},{body:v(u=>[L(W(y(u.data.referenceId)),1)]),_:1}),s(m,{field:"quantity",header:"Consum",style:{width:"15%"}}),s(m,{field:"width",header:"Ample (x) mm",style:{width:"12%"}}),s(m,{field:"length",header:"Llarg (y) mm",style:{width:"12%"}}),s(m,{field:"height",header:"Alt (z) mm",style:{width:"12%"}}),s(m,{field:"diameter",header:"Diàmetre mm",style:{width:"12%"}}),s(m,{field:"thickness",header:"Gruix mm",style:{width:"12%"}}),s(m,{style:{width:"10%"}},{body:v(u=>[o("i",{class:D([d(B).TIMES,"grid_delete_column_button"]),onClick:n=>l(n,u.data)},null,10,Me)]),_:1})]),_:1},8,["value"])}}}),Se={key:0},Be={class:"three-columns"},$e={class:"three-columns"},Re={class:"mt-2"},Ue={class:"mt-2"},Ne={class:"mt-2"},Ae=o("br",null,null,-1),qe=$({__name:"FormWorkmasterPhaseBomItem",props:{bomItem:{}},emits:["submit","cancel"],setup(V,{emit:c}){const f=V;F();const w=A(),b=G().shape({referenceId:pe().required("El material de consum és obligatori"),quantity:N().min(1,"La quantitat a consumir ha de ser positiva").required("La quantitat a consumir és obligatoria")}),y=P({result:!1,errors:{}}),r=()=>{const l=new x(b);y.value=l.validate(f.bomItem)},_=async()=>{if(r(),y.value.result)c("submit",f.bomItem);else{let l="";Object.entries(y.value.errors).forEach(e=>{l+=`${e[1].map(a=>a)}.   `}),w.add({severity:"warn",summary:"Formulari inválid",detail:l,life:5e3})}};return(l,e)=>{const a=p("Button");return l.bomItem?(g(),U("form",Se,[o("div",null,[s(fe,{label:"Material",fullName:!0,modelValue:l.bomItem.referenceId,"onUpdate:modelValue":e[0]||(e[0]=t=>l.bomItem.referenceId=t),class:D({"p-invalid":y.value.errors.referenceId})},null,8,["modelValue","class"])]),o("section",Be,[o("div",null,[s(C,{type:d(T).NUMERIC,label:"Quantitat",modelValue:l.bomItem.quantity,"onUpdate:modelValue":e[1]||(e[1]=t=>l.bomItem.quantity=t)},null,8,["type","modelValue"])]),o("div",null,[s(C,{type:d(T).NUMERIC,label:"Amplada (mm)",decimals:2,modelValue:l.bomItem.width,"onUpdate:modelValue":e[2]||(e[2]=t=>l.bomItem.width=t)},null,8,["type","modelValue"])]),o("div",null,[s(C,{type:d(T).NUMERIC,decimals:2,label:"Alçada (mm)",modelValue:l.bomItem.height,"onUpdate:modelValue":e[3]||(e[3]=t=>l.bomItem.height=t)},null,8,["type","modelValue"])])]),o("section",$e,[o("div",Re,[s(C,{type:d(T).NUMERIC,decimals:2,label:"Longitud (mm)",modelValue:l.bomItem.length,"onUpdate:modelValue":e[4]||(e[4]=t=>l.bomItem.length=t)},null,8,["type","modelValue"])]),o("div",Ue,[s(C,{type:d(T).NUMERIC,decimals:2,label:"Diàmetre (mm)",modelValue:l.bomItem.diameter,"onUpdate:modelValue":e[5]||(e[5]=t=>l.bomItem.diameter=t)},null,8,["type","modelValue"])]),o("div",Ne,[s(C,{type:d(T).NUMERIC,decimals:2,label:"Gruix (mm)",modelValue:l.bomItem.thickness,"onUpdate:modelValue":e[6]||(e[6]=t=>l.bomItem.thickness=t)},null,8,["type","modelValue"])])]),Ae,o("div",null,[s(a,{label:"Guardar material",style:{float:"right"},size:"small",onClick:_})])])):M("",!0)}}}),Fe={key:0,class:"main"},Ze=$({__name:"WorkmasterPhase",setup(V){const c=ne(),f=A(),w=re(),b=F(),y=q(),r=z(),{workmaster:_,workmasterPhase:l}=de(r),e=P(""),a=P(""),t=me({visible:!1,title:"Linea",closable:!0,position:"center",modal:!0});ue(async()=>{e.value=c.params.id,a.value=c.params.phaseid,await m();let i="";i="Ruta de fabricació",_.value&&l.value&&(i=`${i} ${b.getFullName(_.value.reference)} - Fase ${l.value.code}`),w.setMenuItem({icon:B.BUILDING,backButtonVisible:!0,title:i}),b.fetchReferencesByModule("purchase"),y.fetchActiveModel()});const m=async()=>{await r.fetchPhaseById(a.value)},h=async i=>{await r.updatePhase(a.value,i)&&f.add({severity:"success",summary:"Fase actualitzada",detail:`La fase ${i.code} ha estat actualitzada correctament`})},u=P(k.CREATE),n=P(void 0),E=P(void 0),H=()=>{n.value=void 0,E.value=void 0},Q=i=>{u.value=k.CREATE,n.value=i,t.title="Afegir pas de fabricació",t.visible=!0},J=i=>{u.value=k.EDIT,n.value=i,t.title="Modificar pas de fabricació",t.visible=!0},K=i=>{r.deletePhaseDetail(i.id)},X=async i=>{let I;u.value===k.CREATE?I=r.createPhaseDetail(i):u.value===k.EDIT&&(I=r.updatePhaseDetail(i.id,i)),await I&&(t.visible=!1)},Y=i=>{u.value=k.CREATE,E.value=i,t.title="Afegir material",t.visible=!0},Z=i=>{u.value=k.EDIT,E.value=i,t.title="Modificar material",t.visible=!0},ee=i=>{r.deletePhaseBomItem(i.id)},te=async i=>{let I;u.value===k.CREATE?I=r.createPhaseBomItem(i):u.value===k.EDIT&&(I=r.updatePhaseBomItem(i.id,i)),await I&&(t.visible=!1)};return(i,I)=>{const R=p("TabPanel"),ae=p("TabView"),le=p("Dialog");return g(),U(ce,null,[o("header",null,[d(_)&&d(l)?(g(),S(oe,{key:0,workmaster:d(_),phase:d(l),onSubmit:h},null,8,["workmaster","phase"])):M("",!0)]),d(l)?(g(),U("main",Fe,[s(ae,null,{default:v(()=>[s(R,{header:"Pasos"},{default:v(()=>[s(ye,{workmasterPhase:d(l),details:d(l).details,onAdd:Q,onEdit:J,onDelete:K},null,8,["workmasterPhase","details"])]),_:1}),s(R,{header:"Materials"},{default:v(()=>[s(De,{workmasterPhase:d(l),billOfMaterials:d(l).billOfMaterials,onAdd:Y,onEdit:Z,onDelete:ee},null,8,["workmasterPhase","billOfMaterials"])]),_:1})]),_:1}),s(le,{visible:t.visible,"onUpdate:visible":I[0]||(I[0]=se=>t.visible=se),header:t.title,closable:t.closable,modal:t.modal,onHide:H},{default:v(()=>[n.value?(g(),S(Ce,{key:0,detail:n.value,onSubmit:X},null,8,["detail"])):M("",!0),E.value?(g(),S(qe,{key:1,bomItem:E.value,onSubmit:te},null,8,["bomItem"])):M("",!0)]),_:1},8,["visible","header","closable","modal"])])):M("",!0)],64)}}});export{Ze as default};
