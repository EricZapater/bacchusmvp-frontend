import{K as oe,a as D,c as C,e as s,L as G,M,d as j,j as Y,r as q,o as K,h as w,i as l,w as T,D as O,k as a,P as $,G as se,N as le,n as V,l as R,f as J,z as Q,m as X,y as P,s as N,C as ne,p as ie,b as re,F as B,v as ue,g as de,u as ce}from"./index-ed8fb5bb.js";import{a as Z,u as ee}from"./purchaseInvoices-069f4a13.js";import{c as pe,a as H,F as me}from"./form-validator-95718e4a.js";import{F as ve}from"./file.service-767658e1.js";import{c as be,f as fe}from"./functions-028ffd6d.js";import"./index-f2c65ad9.js";import"./base.service-1efb2a9b.js";import"./index-ca372a93.js";import"./suppliers.service-20ad155d.js";var te={name:"Toolbar",extends:oe,props:{"aria-labelledby":{type:String,default:null}}};const ye=["aria-labelledby"];function _e(i,v,x,p,n,e){return D(),C("div",M({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":i.ariaLabelledby},i.ptm("root")),[s("div",M({class:"p-toolbar-group-start p-toolbar-group-left"},i.ptm("start")),[G(i.$slots,"start")],16),s("div",M({class:"p-toolbar-group-center"},i.ptm("center")),[G(i.$slots,"center")],16),s("div",M({class:"p-toolbar-group-end p-toolbar-group-right"},i.ptm("end")),[G(i.$slots,"end")],16)],16,ye)}function Ie(i,v){v===void 0&&(v={});var x=v.insertAt;if(!(!i||typeof document>"u")){var p=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",x==="top"&&p.firstChild?p.insertBefore(n,p.firstChild):p.appendChild(n),n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i))}}var he=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;Ie(he);te.render=_e;const xe={class:"base_input"},Ve={class:"file-viewer"},ge={class:"file-viewer-item-type"},De={class:"file-viewer-item-actions"},we=["onClick"],Fe=["onClick"],Ae=j({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(i){const v=i,x=Y(),p=new ve,n=q(void 0),e=async()=>{n.value=await p.GetEntityFiles(v.entity,v.id)};K(async()=>{await e()});const g=async()=>{const b=document.createElement("input");b.type="file",b.onchange=async _=>{const F=_.target.files[0];if(!await p.Upload(F,v.entity,v.id)){x.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await e()},b.click()},m=async b=>{const _=await p.Download(b);be(b.originalName,_)},f=async b=>{var _=await p.Delete(b.id);if(!_){x.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await e()};return(b,_)=>{const F=w("Button");return D(),C("div",xe,[l(a(te),null,{start:T(()=>[s("h4",null,O(b.title),1)]),end:T(()=>[l(F,{size:"small",rounded:"",icon:a($).UPLOAD,onClick:g},null,8,["icon"])]),_:1}),s("section",Ve,[(D(!0),C(se,null,le(n.value,r=>(D(),C("article",{class:"file-viewer-item",key:b.id},[s("div",ge,[r.type===0?(D(),C("i",{key:0,class:V(a($).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):R("",!0),r.type===1?(D(),C("i",{key:1,class:V(a($).IMAGE),style:{"font-size":"3.5rem"}},null,2)):R("",!0),s("p",null,O(r.originalName.substring(0,20)),1)]),s("div",De,[s("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:d=>m(r)},[s("i",{class:V(a($).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,we),s("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:d=>f(r)},[s("i",{class:V(a($).TIMES)},null,2)],8,Fe)])]))),128))])])}}});const Pe=J(Ae,[["__scopeId","data-v-dd7a228d"]]),S=i=>(ie("data-v-20f34598"),i=i(),re(),i),Ce={key:0},Te={class:"four-columns"},Se=S(()=>s("label",{class:"block text-900 mb-2"},"Exercici",-1)),$e=S(()=>s("label",{class:"block text-900 mb-2"},"Sèrie",-1)),Ee=S(()=>s("label",{class:"block text-900 mb-2"},"Estat",-1)),ke={class:"four-columns"},Ne={class:"mt-1"},Ue=S(()=>s("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),Me={class:"mt-1"},Be={class:"mt-1"},Re=S(()=>s("label",{class:"block text-900 mb-2"},"Data Factura",-1)),Le={class:"mt-1"},ze=S(()=>s("label",{class:"block text-900 mb-2"},"Forma de pagament",-1)),Ge={class:"four-columns"},Oe={class:"mt-1"},je={class:"mt-1"},Ye={class:"mt-1"},qe=S(()=>s("label",{class:"block text-900 mb-2"},"IVA",-1)),Ke={class:"mt-1"},We={class:"four-columns"},He={class:"mt-1"},Je={class:"mt-1"},Qe={class:"mt-3"},Xe=j({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(i,{emit:v}){const x=i,p=Z(),n=ee(),{purchaseInvoice:e}=Q(p),g=Y(),m=pe().shape({exerciceId:H().required("L'exercici es obligatori"),supplierId:H().required("El proveïdor es obligatori")}),f=q({result:!1,errors:{}}),b=()=>{const u=new me(m);f.value=u.validate(x.purchaseInvoice)};let _=!1;K(()=>{setTimeout(()=>_=!0,1e3)});const F=async()=>{if(b(),f.value.result)v("submit",e.value);else{let u="";Object.entries(f.value.errors).forEach(t=>{u+=`${t[1].map(c=>c)}.   `}),g.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},r=()=>{var t;const u=(t=n.masterData.suppliers)==null?void 0:t.find(c=>{var I;return c.id===((I=e.value)==null?void 0:I.supplierId)});u&&(e.value.paymentMethodId=u.paymentMethodId)},d=async()=>{var t;if(_&&e.value&&e.value.baseAmount!==0){let c=0,I=0,h=0,A=0,y=0,E=0,k=0,o=0,U=0,L=0,z=0;e.value.baseAmount&&(c=parseFloat(e.value.baseAmount.toFixed(2))),e.value.transportAmount&&(I=parseFloat(e.value.transportAmount.toFixed(2))),e.value.discountPercentage&&(o=parseFloat(e.value.discountPercentage.toFixed(2))),e.value.extraTaxPercentatge&&(L=e.value.extraTaxPercentatge);var u=(t=n.masterData.taxes)==null?void 0:t.find(ae=>{var W;return ae.id===((W=e.value)==null?void 0:W.taxId)});u&&(A=parseFloat(u.percentatge.toFixed(2))),h=(c+I)*1,y=h*(A/100),z=h*(L/100),U=h+y*1-z*1,k=U*(1*o)/100,E=parseFloat((U-k).toFixed(2)),e.value.baseAmount=c,e.value.transportAmount=I,e.value.subtotal=h,e.value.taxAmount=y,e.value.grossAmount=U,e.value.netAmount=E,e.value.discountPercentage=o,e.value.discountAmount=k,e.value.extraTaxPercentatge=L,e.value.extraTaxAmount=z,e.value.purchaseInvoiceDueDates=await p.GetDueDates(e.value)}};return(u,t)=>{const c=w("Dropdown"),I=w("Calendar"),h=w("Column"),A=w("DataTable"),y=w("Button"),E=w("TabPanel"),k=w("TabView");return D(),X(k,null,{default:T(()=>[l(E,{header:"Factura"},{default:T(()=>[a(e)?(D(),C("form",Ce,[s("section",Te,[l(P,{label:"Num. Fra. Intern",id:"number",modelValue:a(e).number,"onUpdate:modelValue":t[0]||(t[0]=o=>a(e).number=o),disabled:""},null,8,["modelValue"]),s("div",null,[Se,l(c,{modelValue:a(e).exerciceId,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).exerciceId=o),editable:"",options:a(n).masterData.exercises,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),s("div",null,[$e,l(c,{modelValue:a(e).purchaseInvoiceSerieId,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).purchaseInvoiceSerieId=o),editable:"",options:a(n).masterData.series,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),s("div",null,[Ee,l(c,{modelValue:a(e).purchaseInvoiceStatusId,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).purchaseInvoiceStatusId=o),editable:"",options:a(n).masterData.statuses,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),s("section",ke,[s("div",Ne,[Ue,l(c,{modelValue:a(e).supplierId,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).supplierId=o),editable:"",options:a(n).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",onChange:r,class:V(["w-full",{"p-invalid":f.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),s("div",Me,[l(P,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:a(e).supplierNumber,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).supplierNumber=o)},null,8,["modelValue"])]),s("div",Be,[Re,l(I,{id:"purchaseInvoiceDate",modelValue:a(e).purchaseInvoiceDate,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).purchaseInvoiceDate=o),onDateSelect:t[7]||(t[7]=o=>d())},null,8,["modelValue"])]),s("div",Le,[ze,l(c,{modelValue:a(e).paymentMethodId,"onUpdate:modelValue":[t[8]||(t[8]=o=>a(e).paymentMethodId=o),t[9]||(t[9]=o=>d())],editable:"",options:a(n).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])])]),s("section",Ge,[s("div",Oe,[l(P,{type:a(N).CURRENCY,label:"Base",id:"baseAmount",modelValue:a(e).baseAmount,"onUpdate:modelValue":[t[10]||(t[10]=o=>a(e).baseAmount=o),t[11]||(t[11]=o=>d())]},null,8,["type","modelValue"])]),s("div",je,[l(P,{type:a(N).CURRENCY,label:"Ports",id:"transportAmount",modelValue:a(e).transportAmount,"onUpdate:modelValue":[t[12]||(t[12]=o=>a(e).transportAmount=o),t[13]||(t[13]=o=>d())]},null,8,["type","modelValue"])]),s("div",Ye,[qe,l(c,{modelValue:a(e).taxId,"onUpdate:modelValue":[t[14]||(t[14]=o=>a(e).taxId=o),t[15]||(t[15]=o=>d())],editable:"",options:a(n).masterData.taxes,optionValue:"id",optionLabel:"name",class:V(["w-full",{"p-invalid":f.value.errors.taxId}])},null,8,["modelValue","options","class"])]),s("div",Ke,[l(P,{type:a(N).NUMERIC,label:"IRPF",id:"extraTaxPercentatge",modelValue:a(e).extraTaxPercentatge,"onUpdate:modelValue":[t[16]||(t[16]=o=>a(e).extraTaxPercentatge=o),t[17]||(t[17]=o=>d())]},null,8,["type","modelValue"])])]),s("section",We,[s("div",He,[l(P,{type:a(N).NUMERIC,decimals:2,label:"% Dto.",id:"discountPercentage",modelValue:a(e).discountPercentage,"onUpdate:modelValue":[t[18]||(t[18]=o=>a(e).discountPercentage=o),t[19]||(t[19]=o=>d())]},null,8,["type","modelValue"])]),s("div",Je,[l(P,{type:a(N).CURRENCY,label:"Total",id:"netAmount",modelValue:a(e).netAmount,"onUpdate:modelValue":t[20]||(t[20]=o=>a(e).netAmount=o),disabled:""},null,8,["type","modelValue"])])])])):R("",!0),s("div",Qe,[l(A,{value:a(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:T(()=>[l(h,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:T(o=>[ne(O(a(fe)(o.data.dueDate)),1)]),_:1}),l(h,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),l(y,{label:"Guardar",class:"save_button",onClick:F})]),_:1}),l(E,{header:"Fitxers"},{default:T(()=>[l(Pe,{title:"Factures",entity:"PurchaseInvoice",id:a(e).id},null,8,["id"])]),_:1})]),_:1})}}});const Ze=J(Xe,[["__scopeId","data-v-20f34598"]]),ut=j({__name:"PurchaseInvoice",setup(i){const v=q(B.EDIT),x=ue(),p=de(),n=ce(),e=ee(),g=Z(),{purchaseInvoice:m}=Q(g),f=async()=>{await g.GetById(x.params.id);let r="";m.value?(v.value=B.EDIT,r=`Factura de compra: ${m.value.number}`,m.value.purchaseInvoiceDate=new Date(m.value.purchaseInvoiceDate)):(v.value=B.CREATE,g.setNewPurchaseInvoice(x.params.id),r="Alta de factures de compra",b()),n.setMenuItem({icon:$.POUND,backButtonVisible:!0,title:r})},b=()=>{var r,d,u,t;if(m.value){const c=(r=e.masterData.exercises)==null?void 0:r.find(y=>y.name===new Date().getFullYear().toString());c&&(m.value.exerciceId=c.id);const I=(d=e.masterData.series)==null?void 0:d.find(y=>y.name==="Nacional");I&&(m.value.purchaseInvoiceSerieId=I.id);const h=(u=e.masterData.statuses)==null?void 0:u.find(y=>y.name==="Nova");h&&(m.value.purchaseInvoiceStatusId=h.id);const A=(t=e.masterData.taxes)==null?void 0:t.find(y=>y.name==="IVA 21%");A&&(m.value.taxId=A.id)}};K(async()=>{await f()});const _=Y(),F=async()=>{const r=m.value;let d=!1,u="";v.value===B.CREATE?await g.Create(r)===!0&&(d=!0,u="Factura creada correctament"):await g.Update(r)===!0&&(d=!0,u="Factura actualizada correctament"),d&&(_.add({severity:"success",summary:u,life:5e3}),p.back())};return(r,d)=>a(m)?(D(),X(Ze,{key:0,purchaseInvoice:a(m),onSubmit:F},null,8,["purchaseInvoice"])):R("",!0)}});export{ut as default};
