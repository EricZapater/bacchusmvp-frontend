import{d as B,j as F,x as M,g as E,u as L,r as T,o as O,P as _,h as c,c as R,i as o,w as i,k as u,a as U,e as d,D as p,E as m}from"./index-c73e34a4.js";import{u as j,a as G}from"./purchaseInvoices-2b0e1aac.js";import{a as f,f as I}from"./functions-028ffd6d.js";import{v as J}from"./v4-a960c1f4.js";import"./exercise.service-4fe4f098.js";import"./base.service-02c1db1f.js";import"./paymentmethod.service-105d0201.js";import"./tax.service-f18ef59d.js";import"./index-c36f6e5b.js";import"./suppliers.service-c2e91e78.js";const $={class:"flex flex-wrap align-items-center justify-content-between gap-2"},A={class:"datatable-filter"},H={class:"filter-field"},K=d("label",{class:"block text-900 mb-2"},"Període",-1),Q={class:"filter-field"},Y=d("label",{class:"block text-900 mb-2"},"Proveïdor",-1),q={class:"datatable-buttons"},g="temges.purchaseinvoice.filter",ne=B({__name:"PurchaseInvoices",setup(z){const w=F();M();const b=E(),S=L(),v=j(),D=G(),t=T({dates:void 0,supplierId:void 0});O(async()=>{await v.fetchMasterData();const e=localStorage.getItem(g);if(e!==null)t.value=JSON.parse(e),t.value.dates&&(t.value.dates[0]=new Date(t.value.dates[0]),t.value.dates[1]=new Date(t.value.dates[1])),await y();else{let a=new Date,l=new Date;a.setDate(l.getDate()-30);const r=f(a),h=f(l);await D.GetFiltered(r,h)}S.setMenuItem({icon:_.MONEY_BILL,title:"Factures de compra"})});const y=async()=>{if(t.value.dates){const e=f(t.value.dates[0]),a=f(t.value.dates[1]);await D.GetFiltered(e,a,void 0,void 0,t.value.supplierId),localStorage.setItem(g,JSON.stringify(t.value))}else w.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},N=e=>{var l;const a=(l=v.masterData.suppliers)==null?void 0:l.find(r=>r.id===e);return a?a.comercialName:""},C=e=>{var l;const a=(l=v.masterData.statuses)==null?void 0:l.find(r=>r.id===e);return a?a.name:""},P=e=>e.purchaseInvoiceDueDates?e.purchaseInvoiceDueDates.length===0?I(e.purchaseInvoiceDate):I(e.purchaseInvoiceDueDates[e.purchaseInvoiceDueDates.length-1].dueDate):"",V=()=>{b.push({path:`/purchaseInvoice/${J()}`})},k=e=>{console.log("edit",e.data),e.originalEvent.target.className.includes("grid_delete_column_button")||b.push({path:`/purchaseinvoice/${e.data.id}`})};return(e,a)=>{const l=c("Calendar"),r=c("Dropdown"),h=c("Button"),n=c("Column"),x=c("DataTable");return U(),R("div",null,[o(x,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"75vh",sortMode:"multiple",value:u(D).purchaseInvoices,onRowClick:k},{header:i(()=>[d("div",$,[d("div",A,[d("div",H,[K,o(l,{modelValue:t.value.dates,"onUpdate:modelValue":a[0]||(a[0]=s=>t.value.dates=s),selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),d("div",Q,[Y,o(r,{modelValue:t.value.supplierId,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.supplierId=s),editable:"",options:u(v).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),d("div",q,[o(h,{class:"datatable-button",icon:u(_).FILTER,rounded:"",raised:"",onClick:y},null,8,["icon"]),o(h,{icon:u(_).PLUS,rounded:"",raised:"",onClick:V},null,8,["icon"])])])]),default:i(()=>[o(n,{field:"number",header:"Número",sortable:!0,style:{width:"10%"}}),o(n,{header:"Proveïdor",style:{width:"15%"}},{body:i(s=>[p(m(N(s.data.supplierId)),1)]),_:1}),o(n,{header:"Num Fra. Proveïdor",style:{width:"12%"},field:"supplierNumber"}),o(n,{header:"Estat",style:{width:"15%"}},{body:i(s=>[p(m(C(s.data.purchaseInvoiceStatusId)),1)]),_:1}),o(n,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:i(s=>[p(m(u(I)(s.data.purchaseInvoiceDate)),1)]),_:1}),o(n,{header:"Venciment",style:{width:"15%"}},{body:i(s=>[p(m(P(s.data)),1)]),_:1}),o(n,{header:"Import",style:{width:"15%"}},{body:i(s=>[p(m(s.data.netAmount)+" € ",1)]),_:1})]),_:1},8,["value"])])}}});export{ne as default};
