import{b as W}from"./vue-router-ffe4063c.js";import{j as A,ax as S,k as I,f,l as r,o as _,c as F,e as l,h as t,n as b,d as T,a as k,P as $,w as h,F as j,a0 as H,t as x,u as J,M as K}from"./index-a2430148.js";import{u as D}from"./customers-00488387.js";import{u as M}from"./usetoast.esm-261cff49.js";import{F as w}from"./component-c8ee66ae.js";import{c as R,a as g,F as L,b as q}from"./form-validator-1a569dfe.js";import{u as Q}from"./paymentMethod-e4170f58.js";import{B as P}from"./BaseInput-59304a19.js";import{u as X}from"./geography-dfaf4123.js";import{u as G}from"./useconfirm.esm-ca9e0456.js";import{v as O}from"./v4-a960c1f4.js";import"./base.service-ac28cfab.js";import"./paymentmethod.service-65f61ad5.js";import"./runtime-dom.esm-bundler-ee5f76e0.js";import"./_plugin-vue_export-helper-c27b6911.js";const Y={key:0},Z={class:"three-columns"},ee=l("label",{class:"block text-900 mb-2"},"Tipus Client",-1),ae={class:"two-columns mb-2"},oe={class:"two-columns mb-2"},se=l("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),te=l("label",{class:"block text-900 mb-2"},"Observacions",-1),le={class:"mt-2"},ne=A({__name:"FormCustomer",emits:["submit"],setup(U,{emit:v}){const C=D(),N=Q(),{customer:s}=S(C),p=M(),n=R().shape({comercialName:g().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),taxName:g().required("El nom fiscal és obligatori"),vatNumber:g().required("El CIF és obligatori"),accountNumber:g().required("El número de compte es obligatori")}),c=I({result:!1,errors:{}}),E=()=>{const a=new L(n);c.value=a.validate(s.value)},d=async()=>{if(E(),c.value.result)v("submit",s.value);else{let a="";Object.entries(c.value.errors).forEach(e=>{a+=`${e[1].map(m=>m)}.   `}),p.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const m=f("BaseInput"),y=f("Dropdown"),i=f("Textarea"),u=f("Button");return r(s)?(_(),F("form",Y,[l("section",Z,[t(m,{name:"comercialName",class:b(["mb-2",{"p-invalid":c.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:r(s).comercialName,"onUpdate:modelValue":e[0]||(e[0]=o=>r(s).comercialName=o)},null,8,["modelValue","class"]),t(m,{class:b(["mb-2",{"p-invalid":c.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:r(s).taxName,"onUpdate:modelValue":e[1]||(e[1]=o=>r(s).taxName=o)},null,8,["modelValue","class"]),l("div",null,[ee,t(y,{modelValue:r(s).customerTypeId,"onUpdate:modelValue":e[2]||(e[2]=o=>r(s).customerTypeId=o),editable:"",options:r(C).customerTypes,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":c.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),l("section",ae,[t(m,{name:"vatNumber",class:b(["mb-2",{"p-invalid":c.value.errors.vatNumber}]),label:"CIF",id:"vatNumber",modelValue:r(s).vatNumber,"onUpdate:modelValue":e[3]||(e[3]=o=>r(s).vatNumber=o)},null,8,["modelValue","class"]),t(m,{name:"web",class:b(["mb-2",{"p-invalid":c.value.errors.web}]),label:"Web",id:"web",modelValue:r(s).web,"onUpdate:modelValue":e[4]||(e[4]=o=>r(s).web=o)},null,8,["modelValue","class"])]),l("section",oe,[t(m,{name:"accountNumber",class:b(["mb-2",{"p-invalid":c.value.errors.accountNumber}]),label:"Número de compte",id:"accountNumber",modelValue:r(s).accountNumber,"onUpdate:modelValue":e[5]||(e[5]=o=>r(s).accountNumber=o)},null,8,["modelValue","class"]),l("div",null,[se,t(y,{modelValue:r(s).paymentMethodId,"onUpdate:modelValue":e[6]||(e[6]=o=>r(s).paymentMethodId=o),editable:"",options:r(N).paymentMethods,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":c.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])])]),l("div",null,[te,t(i,{modelValue:r(s).observations,"onUpdate:modelValue":e[7]||(e[7]=o=>r(s).observations=o),class:"w-full"},null,8,["modelValue"])]),l("div",le,[t(u,{label:"Guardar",class:"mr-2",onClick:d})])])):T("",!0)}}}),re={key:0},ie={class:"three-columns"},de=l("label",{class:"block text-900 mb-2"},"Principal",-1),ue=l("label",{class:"block text-900 mb-2"},"Desactivada",-1),ce={class:"three-columns mb-2"},me=l("label",{class:"block text-900 mb-2"},"País",-1),pe=l("label",{class:"block text-900 mb-2"},"Província",-1),be=l("label",{class:"block text-900 mb-2"},"Municipi",-1),ve={class:"three-columns mb-2"},fe=l("label",{class:"block text-900 mb-2"},"Observacions",-1),Ce={class:"mt-2"},_e=A({__name:"FormCustomerAddress",props:{address:{}},emits:["submit","cancel"],setup(U,{emit:v}){const C=U,N=X(),s=M(),p=R().shape({name:g().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),country:g().required("El país és obligatori"),region:g().required("La província és obligatoria"),city:g().required("El municipi és obligatori"),postalCode:g().required("El codi postal és obligatori"),address:g().required("La direcció és obligatoria"),main:q().required(),disabled:q().required()}),n=I({result:!1,errors:{}}),c=()=>{const a=C.address;a.address=""},E=()=>{const a=new L(p);n.value=a.validate(C.address)},d=async()=>{if(E(),n.value.result)v("submit",C.address);else{let a="";Object.entries(n.value.errors).forEach(e=>{a+=`${e[1].map(m=>m)}.   `}),s.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const m=f("Checkbox"),y=f("Dropdown"),i=f("Textarea"),u=f("Button");return a.address?(_(),F("form",re,[l("section",ie,[t(P,{id:"name",class:b(["mb-2",{"p-invalid":n.value.errors.name}]),label:"Nom",modelValue:a.address.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.address.name=o)},null,8,["modelValue","class"]),l("div",null,[de,t(m,{modelValue:a.address.main,"onUpdate:modelValue":e[1]||(e[1]=o=>a.address.main=o),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[ue,t(m,{modelValue:a.address.disabled,"onUpdate:modelValue":e[2]||(e[2]=o=>a.address.disabled=o),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("section",ce,[l("div",null,[me,t(y,{modelValue:a.address.country,"onUpdate:modelValue":e[3]||(e[3]=o=>a.address.country=o),editable:"",options:["Espanya"],class:b(["w-full",{"p-invalid":n.value.errors.country}])},null,8,["modelValue","class"])]),l("div",null,[pe,t(y,{modelValue:a.address.region,"onUpdate:modelValue":e[4]||(e[4]=o=>a.address.region=o),editable:"",options:r(N).regions,optionValue:"nm",optionLabel:"nm",onChange:c,class:b(["w-full",{"p-invalid":n.value.errors.region}])},null,8,["modelValue","options","class"])]),l("div",null,[be,t(y,{modelValue:a.address.city,"onUpdate:modelValue":e[5]||(e[5]=o=>a.address.city=o),editable:"",options:r(N).getTownsByRegionName(a.address.region),optionValue:"nm",optionLabel:"nm",class:b(["w-full",{"p-invalid":n.value.errors.city}])},null,8,["modelValue","options","class"])])]),l("section",ve,[t(P,{label:"Codi Postal",id:"postalCode",modelValue:a.address.postalCode,"onUpdate:modelValue":e[6]||(e[6]=o=>a.address.postalCode=o),class:b({"p-invalid":n.value.errors.postalCode})},null,8,["modelValue","class"]),t(P,{label:"Direcció",id:"address",modelValue:a.address.address,"onUpdate:modelValue":e[7]||(e[7]=o=>a.address.address=o),class:b({"p-invalid":n.value.errors.address})},null,8,["modelValue","class"])]),l("div",null,[fe,t(i,{modelValue:a.address.observations,"onUpdate:modelValue":e[8]||(e[8]=o=>a.address.observations=o),class:"w-full"},null,8,["modelValue"])]),l("div",Ce,[t(u,{label:"Guardar",class:"mr-2",onClick:d})])])):T("",!0)}}}),ye={key:2},Ve=["onClick"],ge=A({__name:"TableCustomerAddresses",emits:["create","update","delete"],setup(U,{emit:v}){const C=G(),N=D(),{customer:s}=S(N),p=I(w.CREATE),n=I(void 0),c=()=>{var e;n.value={customerId:(e=s.value)==null?void 0:e.id,id:O(),name:"",country:"",region:"",city:"",postalCode:"",address:"",main:!1,disabled:!1,observations:""},p.value=w.CREATE},E=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(n.value=e.data,p.value=w.EDIT)},d=()=>{const e=n.value;p.value===w.CREATE?v("create",e):v("update",e),n.value=void 0},a=(e,m)=>{C.require({target:e.currentTarget,message:"Está segur que vol eliminar l'adreça?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",m)}})};return(e,m)=>{var V;const y=f("Button"),i=f("Column"),u=f("BooleanColumn"),o=f("DataTable");return _(),F(j,null,[n.value?T("",!0):(_(),k(y,{key:0,icon:r($).PLUS,class:"grid_add_row_button",rounded:"",onClick:c},null,8,["icon"])),n.value?(_(),k(_e,{key:1,address:n.value,onSubmit:d,onCancel:m[0]||(m[0]=()=>n.value=void 0)},null,8,["address"])):(_(),F("div",ye,[(V=r(s))!=null&&V.address?(_(),k(o,{key:0,value:r(s).address,tableStyle:"min-width: 100%",onRowClick:E},{default:h(()=>[t(i,{header:"Nom",field:"name",style:{width:"25%"}}),t(i,{header:"Província",field:"region",style:{width:"25%"}}),t(i,{header:"Municipi",field:"city",style:{width:"25%"}}),t(i,{header:"Codi Postal",field:"postalCode",style:{width:"25%"}}),t(i,{header:"Principal"},{body:h(B=>[t(u,{value:B.data.main,"show-color":!1},null,8,["value"])]),_:1}),t(i,null,{body:h(B=>[l("i",{class:b([r($).TIMES,"grid_delete_column_button"]),onClick:z=>a(z,B.data)},null,10,Ve)]),_:1})]),_:1},8,["value"])):T("",!0)]))],64)}}}),we={key:0},he={class:"three-columns"},Ne={class:"three-columns"},Ee=l("label",{class:"block text-900 mb-2"},"Predeterminat",-1),ke={class:"mt-2"},Te=A({__name:"FormCustomerContact",props:{contact:{}},emits:["submit","cancel"],setup(U,{emit:v}){const C=U,N=M(),s=R().shape({firstName:g().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:g().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:g(),email:g().required("El correu és obligatori").email("Correu electrònic invàlid"),phoneNumber:g().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),disabled:q().required(),main:q().required()}),p=I({result:!1,errors:{}}),n=()=>{const d=new L(s);p.value=d.validate(C.contact)},c=async()=>{if(n(),p.value.result)v("submit",C.contact);else{let d="";Object.entries(p.value.errors).forEach(a=>{d+=`${a[1].map(e=>e)}.   `}),N.add({severity:"warn",summary:"Formulari inválid",detail:d,life:5e3})}},E=()=>{v("cancel")};return(d,a)=>{const e=f("BaseInput"),m=f("Checkbox"),y=f("Button");return d.contact?(_(),F("form",we,[l("section",he,[t(e,{label:"Nom",id:"firstName",modelValue:d.contact.firstName,"onUpdate:modelValue":a[0]||(a[0]=i=>d.contact.firstName=i),class:b(["mb-2",{"p-invalid":p.value.errors.firstName}])},null,8,["modelValue","class"]),t(e,{label:"Cognoms",id:"lastName",modelValue:d.contact.lastName,"onUpdate:modelValue":a[1]||(a[1]=i=>d.contact.lastName=i),class:b(["mb-2",{"p-invalid":p.value.errors.lastName}])},null,8,["modelValue","class"]),t(e,{label:"Càrrec",id:"charge",modelValue:d.contact.charge,"onUpdate:modelValue":a[2]||(a[2]=i=>d.contact.charge=i),class:b(["mb-2",{"p-invalid":p.value.errors.charge}])},null,8,["modelValue","class"])]),l("section",Ne,[t(e,{class:b(["mb-2",{"p-invalid":p.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:d.contact.email,"onUpdate:modelValue":a[3]||(a[3]=i=>d.contact.email=i)},null,8,["modelValue","class"]),t(e,{class:b(["mb-2",{"p-invalid":p.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:d.contact.phoneNumber,"onUpdate:modelValue":a[4]||(a[4]=i=>d.contact.phoneNumber=i)},null,8,["modelValue","class"]),l("div",null,[Ee,t(m,{modelValue:d.contact.main,"onUpdate:modelValue":a[5]||(a[5]=i=>d.contact.main=i),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("div",ke,[t(y,{label:"Guardar",class:"mr-2",onClick:c}),t(y,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:E})])])):T("",!0)}}}),$e={key:2},Ie=["onClick"],Ue=A({__name:"TableCustomerContacts",emits:["create","update","delete"],setup(U,{emit:v}){const C=G(),N=D(),{customer:s}=S(N),p=I(w.CREATE),n=I(void 0),c=()=>{var e;n.value={customerId:(e=s.value)==null?void 0:e.id,id:O(),charge:"",email:"",firstName:"",lastName:"",disabled:!1,main:!1,phoneNumber:""},p.value=w.CREATE},E=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(n.value=e.data,p.value=w.EDIT)},d=()=>{const e=n.value;p.value===w.CREATE?v("create",e):v("update",e),n.value=void 0},a=(e,m)=>{C.require({target:e.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",m)}})};return(e,m)=>{var o;const y=f("Button"),i=f("Column"),u=f("DataTable");return _(),F(j,null,[n.value?T("",!0):(_(),k(y,{key:0,icon:r($).PLUS,class:"grid_add_row_button",rounded:"",onClick:c},null,8,["icon"])),n.value?(_(),k(Te,{key:1,contact:n.value,onSubmit:d,onCancel:m[0]||(m[0]=()=>n.value=void 0)},null,8,["contact"])):(_(),F("div",$e,[(o=r(s))!=null&&o.contacts?(_(),k(u,{key:0,value:r(s).contacts,tableStyle:"min-width: 100%",onRowClick:E},{default:h(()=>[t(i,{header:"Nom",style:{width:"25%"}},{body:h(V=>[H(x(V.data.firstName)+" "+x(V.data.lastName),1)]),_:1}),t(i,{header:"Càrrec",field:"charge",style:{width:"25%"}}),t(i,{header:"Correu",field:"email",style:{width:"25%"}}),t(i,{header:"Telèfon",field:"phoneNumber",style:{width:"25%"}}),t(i,null,{body:h(V=>[l("i",{class:b([r($).TIMES,"grid_delete_column_button"]),onClick:B=>a(B,V.data)},null,10,Ie)]),_:1})]),_:1},8,["value"])):T("",!0)]))],64)}}}),Be=l("span",null,"Client",-1),Fe=l("span",null,"Contactes",-1),Ae=l("span",null,"Adreces",-1),Ke=A({__name:"Customer",setup(U){const v=I(w.EDIT),C=W(),N=J(),s=D(),{customer:p}=S(s),n=async()=>{await s.fetchCustomer(C.params.id),await s.fetchCustomerTypes();let u="";p.value?(v.value=w.EDIT,u=`Client ${p.value.comercialName}`):(v.value=w.CREATE,s.setNewCustomer(C.params.id),u="Alta de client"),N.setMenuItem({icon:$.BUILDING,text:u,backButtonVisible:!0})};K(async()=>{await n()});const c=M(),E=async()=>{const u=p.value;let o=!1,V="";v.value===w.CREATE?(o=await s.createCustomer(u),V="Client creat correctament"):(o=await s.updateCustomer(u.id,u),V="Client actualizat correctament"),o&&(c.add({severity:"success",summary:V,life:5e3}),await n())},d=async u=>{await s.addContactToCustomer(u)&&c.add({severity:"success",summary:"Contacte afegit",life:5e3})},a=async u=>{await s.updateContactFromCustomer(u)&&c.add({severity:"success",summary:"Contacte actualizat",life:5e3})},e=async u=>{await s.removeContactFromCustomer(u)&&c.add({severity:"success",summary:"Contacte eliminat",life:5e3})},m=async u=>{await s.addAddressToCustomer(u)&&c.add({severity:"success",summary:"Adreça afegida",life:5e3})},y=async u=>{await s.updateAddressFromCustomer(u)&&c.add({severity:"success",summary:"Adreça actualizada",life:5e3})},i=async u=>{await s.removeAddressFromCustomer(u)&&c.add({severity:"success",summary:"Adreça eliminada",life:5e3})};return(u,o)=>{const V=f("TabPanel"),B=f("TabView");return _(),k(B,null,{default:h(()=>[t(V,null,{header:h(()=>[l("i",{class:b([r($).WALLET,"mr-2"])},null,2),Be]),default:h(()=>[t(ne,{onSubmit:E})]),_:1}),v.value===r(w).EDIT?(_(),k(V,{key:0},{header:h(()=>[l("i",{class:b([r($).USERS,"mr-2"])},null,2),Fe]),default:h(()=>[t(Ue,{onCreate:d,onUpdate:a,onDelete:e})]),_:1})):T("",!0),v.value===r(w).EDIT?(_(),k(V,{key:1},{header:h(()=>[l("i",{class:b([r($).ENVELOPE,"mr-2"])},null,2),Ae]),default:h(()=>[t(ge,{onCreate:m,onUpdate:y,onDelete:i})]),_:1})):T("",!0)]),_:1})}}});export{Ke as default};
