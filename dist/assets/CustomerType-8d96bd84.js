import{b as E}from"./vue-router-c71b0622.js";import{u as k}from"./customers-bca4d3e0.js";import{j as b,k as C,f as w,c as F,h as p,n as f,e as I,d as V,o as _,u as N,aw as h,M,l as y,a as $,P as g}from"./index-0e14a554.js";import{B as T}from"./BaseInput-9aa79c5a.js";import{c as A,a as v,F as D}from"./form-validator-88e54800.js";import{u as B}from"./usetoast.esm-2dfabc60.js";import{F as c}from"./component-45e7825d.js";import{r as R}from"./router-b83aeac2.js";import"./base.service-431caa23.js";import"./_plugin-vue_export-helper-c27b6911.js";const S={key:0},L={class:"mt-2"},U=b({__name:"FormCustomerType",props:{customerType:{}},emits:["submit","cancel"],setup(d,{emit:m}){const i=d,n=B(),t=A().shape({name:v().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),description:v().required("La descripció és obligatori").max(250,"La descripció no pot superar els 250 carácters")}),o=C({result:!1,errors:{}}),l=()=>{const s=new D(t);o.value=s.validate(i.customerType)},u=async()=>{if(l(),o.value.result)m("submit",i.customerType);else{let s="";Object.entries(o.value.errors).forEach(e=>{s+=`${e[1].map(a=>a)}.   `}),n.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,e)=>{const a=w("Button");return s.customerType?(_(),F("form",S,[p(T,{class:f(["mb-2",{"p-invalid":o.value.errors.name}]),label:"Nom",id:"name",modelValue:s.customerType.name,"onUpdate:modelValue":e[0]||(e[0]=r=>s.customerType.name=r)},null,8,["modelValue","class"]),p(T,{class:f(["mb-2",{"p-invalid":o.value.errors.description}]),label:"Descripció",id:"description",modelValue:s.customerType.description,"onUpdate:modelValue":e[1]||(e[1]=r=>s.customerType.description=r)},null,8,["modelValue","class"]),I("div",L,[p(a,{label:"Guardar",class:"mr-2",onClick:u})])])):V("",!0)}}}),Q=b({__name:"CustomerType",setup(d){const m=C(c.EDIT),i=E(),n=N(),t=k(),{customerType:o}=h(t),l=async()=>{await t.fetchCustomerType(i.params.id);let e="";o.value?(m.value=c.EDIT,e=`Tipus de client ${o.value.name}`):(m.value=c.CREATE,t.setNewCustomerType(i.params.id),e="Alta de tipus de client"),n.setMenuItem({icon:g.BUILDING,backButtonVisible:!0,text:e})};M(async()=>{await l()});const u=B(),s=async()=>{const e=o.value;let a=!1,r="";m.value===c.CREATE?(a=await t.createCustomerType(e),r="Tipus de client creat correctament"):(a=await t.updateCustomerType(e.id,e),r="Tipus de client actualizat correctament"),a&&(u.add({severity:"success",summary:r,life:5e3}),R.back())};return(e,a)=>y(t).customerType?(_(),$(U,{key:0,customerType:y(t).customerType,onSubmit:s},null,8,["customerType"])):V("",!0)}});export{Q as default};
