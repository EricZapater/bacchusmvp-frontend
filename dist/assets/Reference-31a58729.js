import{d as F,j as T,z as g,o as B,r as h,h as k,c as I,i as u,k as e,e as a,n as E,y as v,m as U,l as w,G as S,a as b,s as x,F as _,v as q,u as D,P as A,K as M}from"./index-975a47bd.js";import{c as P,a as m,F as $}from"./form-validator-8b6c2b5b.js";import{F as z}from"./FileEntityPicker-1bc2515a.js";import{u as L}from"./reference-81bc0611.js";import{u as j}from"./tax-be57b46a.js";import"./file.service-b9108070.js";import"./functions-13b40d42.js";import"./v4-a960c1f4.js";import"./reference.service-beea0f30.js";import"./base.service-b690a68e.js";import"./index-790bf15b.js";const G={key:0,class:"mt-3"},Y={class:"three-columns"},K={class:"mt-1"},O={class:"mt-1"},X={class:"mt-1"},H={class:"three-columns"},J={class:"mt-1"},Q={class:"mt-1"},W={class:"mt-1"},Z=a("label",{class:"block text-900 mb-2"},"Imposts",-1),ee=a("br",null,null,-1),se=F({__name:"FormReference",props:{reference:{}},emits:["submit","cancel"],setup(C,{emit:p}){const f=C,V=T(),d=L(),i=j(),{reference:s}=g(d);B(async()=>{await i.fetchAll()});const y=P().shape({code:m().required("El codi és obligatori").max(50,"El codi no pot superar els 50 carácters"),description:m().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),version:m().required("La versió és obligatoria").max(20,"La versió pot superar els 20 carácters"),cost:m().required("El cost es obligatori"),price:m().required("El preu es obligatori"),taxId:m().required("El tipus d'iva es obligatori")}),n=h({result:!1,errors:{}}),r=()=>{const l=new $(y);n.value=l.validate(f.reference)},c=async()=>{if(r(),n.value.result)p("submit",f.reference);else{let l="";Object.entries(n.value.errors).forEach(t=>{l+=`${t[1].map(R=>R)}.   `}),V.add({severity:"warn",summary:"Formulari inválid",detail:l,life:5e3})}};return(l,t)=>{const R=k("Button"),N=k("Dropdown");return b(),I(S,null,[u(R,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:c}),e(s)?(b(),I("form",G,[a("section",Y,[a("div",K,[u(v,{class:E(["mb-2",{"p-invalid":n.value.errors.code}]),label:"Codi",id:"code",modelValue:e(s).code,"onUpdate:modelValue":t[0]||(t[0]=o=>e(s).code=o)},null,8,["modelValue","class"])]),a("div",O,[u(v,{class:E(["mb-2",{"p-invalid":n.value.errors.description}]),label:"Descripció",id:"description",modelValue:e(s).description,"onUpdate:modelValue":t[1]||(t[1]=o=>e(s).description=o)},null,8,["modelValue","class"])]),a("div",X,[u(v,{type:e(x).TEXT,label:"Versió",id:"version",modelValue:e(s).version,"onUpdate:modelValue":t[2]||(t[2]=o=>e(s).version=o)},null,8,["type","modelValue"])])]),a("section",H,[a("div",J,[u(v,{type:e(x).CURRENCY,label:"Cost",id:"cost",modelValue:e(s).cost,"onUpdate:modelValue":t[3]||(t[3]=o=>e(s).cost=o)},null,8,["type","modelValue"])]),a("div",Q,[u(v,{type:e(x).CURRENCY,label:"Preu",id:"price",modelValue:e(s).price,"onUpdate:modelValue":t[4]||(t[4]=o=>e(s).price=o)},null,8,["type","modelValue"])]),a("div",W,[Z,u(N,{modelValue:e(s).taxId,"onUpdate:modelValue":t[5]||(t[5]=o=>e(s).taxId=o),editable:"",options:e(i).taxes,optionValue:"id",optionLabel:"name",class:E(["w-full",{"p-invalid":n.value.errors.taxid}])},null,8,["modelValue","options","class"])])]),a("section",null,[ee,e(s)?(b(),U(z,{key:0,title:"Planos",entity:"referenceMaps",id:e(s).id},null,8,["id"])):w("",!0)])])):w("",!0)],64)}}}),pe=F({__name:"Reference",setup(C){const p=h(_.EDIT),f=q(),V=D(),d=L(),{reference:i}=g(d),s=async()=>{await d.fetchReference(f.params.id);let r="";i.value?(p.value=_.EDIT,r=`Referència ${i.value.description}`):(p.value=_.CREATE,d.setNewReference(f.params.id),r="Alta de referència"),V.setMenuItem({icon:A.BUILDING,backButtonVisible:!0,title:r})};B(async()=>{await s()});const y=T(),n=async()=>{const r=i.value;let c=!1,l="";p.value===_.CREATE?(c=await d.createReference(r),c?l="Referència creada correctament":l="La referència + versió introduïda ja existeix"):(c=await d.updateReference(r.id,r),l="Referència actualizada correctament"),y.add({severity:c?"success":"warn",summary:l,life:5e3}),c&&M.back()};return(r,c)=>e(i)?(b(),U(se,{key:0,reference:e(i),onSubmit:n},null,8,["reference"])):w("",!0)}});export{pe as default};
