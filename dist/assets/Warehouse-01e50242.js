import{d as E,j as I,z as g,o as x,r as B,h as w,k as e,c as D,e as c,i as p,n as _,y,l as C,a as F,F as b,v as T,u as W,m as L,P as N,L as U}from"./index-357c9d4c.js";import{c as $,a as V,F as A}from"./form-validator-9d0a56f8.js";import{u as M}from"./warehouse-5b78881a.js";import{u as R}from"./plantmodel-ce44b43b.js";import"./index-c39d6c09.js";import"./base.service-d0780977.js";import"./index-6fe49fa3.js";const q={key:0},P={class:"two-columns"},j={class:"two-columns"},G=c("label",{class:"block text-900 mb-2"},"Local",-1),O=c("label",{class:"block text-900 mb-2"},"Desactivat",-1),H={class:"mt-2"},J=E({__name:"FormWarehouse",props:{warehouse:{}},emits:["submit","cancel"],setup(k,{emit:m}){const d=k,f=I(),n=M(),r=R(),{warehouse:a}=g(n);x(async()=>{await r.fetchSites()});const v=$().shape({name:V().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:V().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),siteId:V().required("El local es obligatori")}),l=B({result:!1,errors:{}}),s=()=>{const t=new A(v);l.value=t.validate(d.warehouse)},u=async()=>{if(s(),l.value.result)m("submit",d.warehouse);else{let t="";Object.entries(l.value.errors).forEach(o=>{t+=`${o[1].map(h=>h)}.   `}),f.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,o)=>{const h=w("Dropdown"),S=w("Checkbox"),z=w("Button");return e(a)?(F(),D("form",q,[c("section",P,[p(y,{class:_(["mb-2",{"p-invalid":l.value.errors.name}]),label:"Nom",id:"name",modelValue:e(a).name,"onUpdate:modelValue":o[0]||(o[0]=i=>e(a).name=i)},null,8,["modelValue","class"]),p(y,{class:_(["mb-2",{"p-invalid":l.value.errors.description}]),label:"Descripció",id:"description",modelValue:e(a).description,"onUpdate:modelValue":o[1]||(o[1]=i=>e(a).description=i)},null,8,["modelValue","class"])]),c("section",j,[c("div",null,[G,p(h,{modelValue:e(a).siteId,"onUpdate:modelValue":o[2]||(o[2]=i=>e(a).siteId=i),editable:"",options:e(r).sites,optionValue:"id",optionLabel:"name",class:_(["w-full",{"p-invalid":l.value.errors.siteId}])},null,8,["modelValue","options","class"])]),c("div",null,[O,p(S,{modelValue:e(a).disabled,"onUpdate:modelValue":o[3]||(o[3]=i=>e(a).disabled=i),class:"w-full",binary:!0},null,8,["modelValue"])])]),c("div",H,[p(z,{label:"Guardar",class:"mr-2",onClick:u})])])):C("",!0)}}}),se=E({__name:"Warehouse",setup(k){const m=B(b.EDIT),d=T(),f=W(),n=M(),{warehouse:r}=g(n),a=async()=>{await n.fetchWarehouse(d.params.id);let s="";r.value?(m.value=b.EDIT,s=`Magatzem ${r.value.name}`):(m.value=b.CREATE,n.setNewWarehouse(d.params.id),s="Alta de magatzem"),f.setMenuItem({icon:N.BUILDING,backButtonVisible:!0,title:s})};x(async()=>{await a()});const v=I(),l=async()=>{const s=r.value;let u=!1,t="";m.value===b.CREATE?(u=await n.createWarehouse(s),t="Magatzem creat correctament"):(u=await n.updateWarehouse(s.id,s),t="Magatzem actualizat correctament"),u&&(v.add({severity:"success",summary:t,life:5e3}),U.back())};return(s,u)=>e(r)?(F(),L(J,{key:0,warehouse:e(r),onSubmit:l},null,8,["warehouse"])):C("",!0)}});export{se as default};
