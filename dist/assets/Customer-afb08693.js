import{d as F,z as D,j as S,r as $,h as f,k as r,a as y,c as A,e as t,i as l,n as b,l as T,I as H,y as P,x,F as w,m as k,P as I,w as h,H as G,C as W,D as j,v as J,u as K,o as Q}from"./index-521883f7.js";import{u as M}from"./customers-8d1cb214.js";import{c as R,a as g,F as L,b as q}from"./form-validator-332bcf89.js";import{u as X}from"./paymentMethod-8bd60aba.js";import{v as O}from"./v4-a960c1f4.js";import"./base.service-05d1da00.js";import"./index-f4759783.js";const Y={key:0},Z={class:"three-columns"},ee=t("label",{class:"block text-900 mb-2"},"Tipus Client",-1),ae={class:"two-columns mb-2"},oe={class:"two-columns mb-2"},se=t("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),le=t("label",{class:"block text-900 mb-2"},"Observacions",-1),te={class:"mt-2"},ne=F({__name:"FormCustomer",emits:["submit"],setup(U,{emit:v}){const C=M(),N=X(),{customer:s}=D(C),p=S(),n=R().shape({comercialName:g().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),taxName:g().required("El nom fiscal és obligatori"),vatNumber:g().required("El CIF és obligatori"),accountNumber:g().required("El número de compte es obligatori")}),c=$({result:!1,errors:{}}),E=()=>{const a=new L(n);c.value=a.validate(s.value)},d=async()=>{if(E(),c.value.result)v("submit",s.value);else{let a="";Object.entries(c.value.errors).forEach(e=>{a+=`${e[1].map(m=>m)}.   `}),p.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const m=f("BaseInput"),_=f("Dropdown"),i=f("Textarea"),u=f("Button");return r(s)?(y(),A("form",Y,[t("section",Z,[l(m,{name:"comercialName",class:b(["mb-2",{"p-invalid":c.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:r(s).comercialName,"onUpdate:modelValue":e[0]||(e[0]=o=>r(s).comercialName=o)},null,8,["modelValue","class"]),l(m,{class:b(["mb-2",{"p-invalid":c.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:r(s).taxName,"onUpdate:modelValue":e[1]||(e[1]=o=>r(s).taxName=o)},null,8,["modelValue","class"]),t("div",null,[ee,l(_,{modelValue:r(s).customerTypeId,"onUpdate:modelValue":e[2]||(e[2]=o=>r(s).customerTypeId=o),editable:"",options:r(C).customerTypes,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":c.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),t("section",ae,[l(m,{name:"vatNumber",class:b(["mb-2",{"p-invalid":c.value.errors.vatNumber}]),label:"CIF",id:"vatNumber",modelValue:r(s).vatNumber,"onUpdate:modelValue":e[3]||(e[3]=o=>r(s).vatNumber=o)},null,8,["modelValue","class"]),l(m,{name:"web",class:b(["mb-2",{"p-invalid":c.value.errors.web}]),label:"Web",id:"web",modelValue:r(s).web,"onUpdate:modelValue":e[4]||(e[4]=o=>r(s).web=o)},null,8,["modelValue","class"])]),t("section",oe,[l(m,{name:"accountNumber",class:b(["mb-2",{"p-invalid":c.value.errors.accountNumber}]),label:"Número de compte",id:"accountNumber",modelValue:r(s).accountNumber,"onUpdate:modelValue":e[5]||(e[5]=o=>r(s).accountNumber=o)},null,8,["modelValue","class"]),t("div",null,[se,l(_,{modelValue:r(s).paymentMethodId,"onUpdate:modelValue":e[6]||(e[6]=o=>r(s).paymentMethodId=o),editable:"",options:r(N).paymentMethods,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":c.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])])]),t("div",null,[le,l(i,{modelValue:r(s).observations,"onUpdate:modelValue":e[7]||(e[7]=o=>r(s).observations=o),class:"w-full"},null,8,["modelValue"])]),t("div",te,[l(u,{label:"Guardar",class:"mr-2",onClick:d})])])):T("",!0)}}}),re={key:0},ie={class:"three-columns"},de=t("label",{class:"block text-900 mb-2"},"Principal",-1),ue=t("label",{class:"block text-900 mb-2"},"Desactivada",-1),ce={class:"three-columns mb-2"},me=t("label",{class:"block text-900 mb-2"},"País",-1),pe=t("label",{class:"block text-900 mb-2"},"Província",-1),be=t("label",{class:"block text-900 mb-2"},"Municipi",-1),ve={class:"three-columns mb-2"},fe=t("label",{class:"block text-900 mb-2"},"Observacions",-1),Ce={class:"mt-2"},ye=F({__name:"FormCustomerAddress",props:{address:{}},emits:["submit","cancel"],setup(U,{emit:v}){const C=U,N=H(),s=S(),p=R().shape({name:g().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),country:g().required("El país és obligatori"),region:g().required("La província és obligatoria"),city:g().required("El municipi és obligatori"),postalCode:g().required("El codi postal és obligatori"),address:g().required("La direcció és obligatoria"),main:q().required(),disabled:q().required()}),n=$({result:!1,errors:{}}),c=()=>{const a=C.address;a.address=""},E=()=>{const a=new L(p);n.value=a.validate(C.address)},d=async()=>{if(E(),n.value.result)v("submit",C.address);else{let a="";Object.entries(n.value.errors).forEach(e=>{a+=`${e[1].map(m=>m)}.   `}),s.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const m=f("Checkbox"),_=f("Dropdown"),i=f("Textarea"),u=f("Button");return a.address?(y(),A("form",re,[t("section",ie,[l(P,{id:"name",class:b(["mb-2",{"p-invalid":n.value.errors.name}]),label:"Nom",modelValue:a.address.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.address.name=o)},null,8,["modelValue","class"]),t("div",null,[de,l(m,{modelValue:a.address.main,"onUpdate:modelValue":e[1]||(e[1]=o=>a.address.main=o),class:"w-full",binary:!0},null,8,["modelValue"])]),t("div",null,[ue,l(m,{modelValue:a.address.disabled,"onUpdate:modelValue":e[2]||(e[2]=o=>a.address.disabled=o),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("section",ce,[t("div",null,[me,l(_,{modelValue:a.address.country,"onUpdate:modelValue":e[3]||(e[3]=o=>a.address.country=o),editable:"",options:["Espanya"],class:b(["w-full",{"p-invalid":n.value.errors.country}])},null,8,["modelValue","class"])]),t("div",null,[pe,l(_,{modelValue:a.address.region,"onUpdate:modelValue":e[4]||(e[4]=o=>a.address.region=o),editable:"",options:r(N).regions,optionValue:"nm",optionLabel:"nm",onChange:c,class:b(["w-full",{"p-invalid":n.value.errors.region}])},null,8,["modelValue","options","class"])]),t("div",null,[be,l(_,{modelValue:a.address.city,"onUpdate:modelValue":e[5]||(e[5]=o=>a.address.city=o),editable:"",options:r(N).getTownsByRegionName(a.address.region),optionValue:"nm",optionLabel:"nm",class:b(["w-full",{"p-invalid":n.value.errors.city}])},null,8,["modelValue","options","class"])])]),t("section",ve,[l(P,{label:"Codi Postal",id:"postalCode",modelValue:a.address.postalCode,"onUpdate:modelValue":e[6]||(e[6]=o=>a.address.postalCode=o),class:b({"p-invalid":n.value.errors.postalCode})},null,8,["modelValue","class"]),l(P,{label:"Direcció",id:"address",modelValue:a.address.address,"onUpdate:modelValue":e[7]||(e[7]=o=>a.address.address=o),class:b({"p-invalid":n.value.errors.address})},null,8,["modelValue","class"])]),t("div",null,[fe,l(i,{modelValue:a.address.observations,"onUpdate:modelValue":e[8]||(e[8]=o=>a.address.observations=o),class:"w-full"},null,8,["modelValue"])]),t("div",Ce,[l(u,{label:"Guardar",class:"mr-2",onClick:d})])])):T("",!0)}}}),_e={key:2},Ve=["onClick"],ge=F({__name:"TableCustomerAddresses",emits:["create","update","delete"],setup(U,{emit:v}){const C=x(),N=M(),{customer:s}=D(N),p=$(w.CREATE),n=$(void 0),c=()=>{var e;n.value={customerId:(e=s.value)==null?void 0:e.id,id:O(),name:"",country:"",region:"",city:"",postalCode:"",address:"",main:!1,disabled:!1,observations:""},p.value=w.CREATE},E=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(n.value=e.data,p.value=w.EDIT)},d=()=>{const e=n.value;p.value===w.CREATE?v("create",e):v("update",e),n.value=void 0},a=(e,m)=>{C.require({target:e.currentTarget,message:"Está segur que vol eliminar l'adreça?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",m)}})};return(e,m)=>{var V;const _=f("Button"),i=f("Column"),u=f("BooleanColumn"),o=f("DataTable");return y(),A(G,null,[n.value?T("",!0):(y(),k(_,{key:0,icon:r(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:c},null,8,["icon"])),n.value?(y(),k(ye,{key:1,address:n.value,onSubmit:d,onCancel:m[0]||(m[0]=()=>n.value=void 0)},null,8,["address"])):(y(),A("div",_e,[(V=r(s))!=null&&V.address?(y(),k(o,{key:0,value:r(s).address,tableStyle:"min-width: 100%",onRowClick:E},{default:h(()=>[l(i,{header:"Nom",field:"name",style:{width:"25%"}}),l(i,{header:"Província",field:"region",style:{width:"25%"}}),l(i,{header:"Municipi",field:"city",style:{width:"25%"}}),l(i,{header:"Codi Postal",field:"postalCode",style:{width:"25%"}}),l(i,{header:"Principal"},{body:h(B=>[l(u,{value:B.data.main,"show-color":!1},null,8,["value"])]),_:1}),l(i,null,{body:h(B=>[t("i",{class:b([r(I).TIMES,"grid_delete_column_button"]),onClick:z=>a(z,B.data)},null,10,Ve)]),_:1})]),_:1},8,["value"])):T("",!0)]))],64)}}}),we={key:0},he={class:"three-columns"},Ne={class:"three-columns"},Ee=t("label",{class:"block text-900 mb-2"},"Predeterminat",-1),ke={class:"mt-2"},Te=F({__name:"FormCustomerContact",props:{contact:{}},emits:["submit","cancel"],setup(U,{emit:v}){const C=U,N=S(),s=R().shape({firstName:g().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:g().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:g(),email:g().required("El correu és obligatori").email("Correu electrònic invàlid"),phoneNumber:g().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),disabled:q().required(),main:q().required()}),p=$({result:!1,errors:{}}),n=()=>{const d=new L(s);p.value=d.validate(C.contact)},c=async()=>{if(n(),p.value.result)v("submit",C.contact);else{let d="";Object.entries(p.value.errors).forEach(a=>{d+=`${a[1].map(e=>e)}.   `}),N.add({severity:"warn",summary:"Formulari inválid",detail:d,life:5e3})}},E=()=>{v("cancel")};return(d,a)=>{const e=f("BaseInput"),m=f("Checkbox"),_=f("Button");return d.contact?(y(),A("form",we,[t("section",he,[l(e,{label:"Nom",id:"firstName",modelValue:d.contact.firstName,"onUpdate:modelValue":a[0]||(a[0]=i=>d.contact.firstName=i),class:b(["mb-2",{"p-invalid":p.value.errors.firstName}])},null,8,["modelValue","class"]),l(e,{label:"Cognoms",id:"lastName",modelValue:d.contact.lastName,"onUpdate:modelValue":a[1]||(a[1]=i=>d.contact.lastName=i),class:b(["mb-2",{"p-invalid":p.value.errors.lastName}])},null,8,["modelValue","class"]),l(e,{label:"Càrrec",id:"charge",modelValue:d.contact.charge,"onUpdate:modelValue":a[2]||(a[2]=i=>d.contact.charge=i),class:b(["mb-2",{"p-invalid":p.value.errors.charge}])},null,8,["modelValue","class"])]),t("section",Ne,[l(e,{class:b(["mb-2",{"p-invalid":p.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:d.contact.email,"onUpdate:modelValue":a[3]||(a[3]=i=>d.contact.email=i)},null,8,["modelValue","class"]),l(e,{class:b(["mb-2",{"p-invalid":p.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:d.contact.phoneNumber,"onUpdate:modelValue":a[4]||(a[4]=i=>d.contact.phoneNumber=i)},null,8,["modelValue","class"]),t("div",null,[Ee,l(m,{modelValue:d.contact.main,"onUpdate:modelValue":a[5]||(a[5]=i=>d.contact.main=i),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("div",ke,[l(_,{label:"Guardar",class:"mr-2",onClick:c}),l(_,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:E})])])):T("",!0)}}}),Ie={key:2},$e=["onClick"],Ue=F({__name:"TableCustomerContacts",emits:["create","update","delete"],setup(U,{emit:v}){const C=x(),N=M(),{customer:s}=D(N),p=$(w.CREATE),n=$(void 0),c=()=>{var e;n.value={customerId:(e=s.value)==null?void 0:e.id,id:O(),charge:"",email:"",firstName:"",lastName:"",disabled:!1,main:!1,phoneNumber:""},p.value=w.CREATE},E=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(n.value=e.data,p.value=w.EDIT)},d=()=>{const e=n.value;p.value===w.CREATE?v("create",e):v("update",e),n.value=void 0},a=(e,m)=>{C.require({target:e.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",m)}})};return(e,m)=>{var o;const _=f("Button"),i=f("Column"),u=f("DataTable");return y(),A(G,null,[n.value?T("",!0):(y(),k(_,{key:0,icon:r(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:c},null,8,["icon"])),n.value?(y(),k(Te,{key:1,contact:n.value,onSubmit:d,onCancel:m[0]||(m[0]=()=>n.value=void 0)},null,8,["contact"])):(y(),A("div",Ie,[(o=r(s))!=null&&o.contacts?(y(),k(u,{key:0,value:r(s).contacts,tableStyle:"min-width: 100%",onRowClick:E},{default:h(()=>[l(i,{header:"Nom",style:{width:"25%"}},{body:h(V=>[W(j(V.data.firstName)+" "+j(V.data.lastName),1)]),_:1}),l(i,{header:"Càrrec",field:"charge",style:{width:"25%"}}),l(i,{header:"Correu",field:"email",style:{width:"25%"}}),l(i,{header:"Telèfon",field:"phoneNumber",style:{width:"25%"}}),l(i,null,{body:h(V=>[t("i",{class:b([r(I).TIMES,"grid_delete_column_button"]),onClick:B=>a(B,V.data)},null,10,$e)]),_:1})]),_:1},8,["value"])):T("",!0)]))],64)}}}),Be=t("span",null,"Client",-1),Ae=t("span",null,"Contactes",-1),Fe=t("span",null,"Adreces",-1),je=F({__name:"Customer",setup(U){const v=$(w.EDIT),C=J(),N=K(),s=M(),{customer:p}=D(s),n=async()=>{await s.fetchCustomer(C.params.id),await s.fetchCustomerTypes();let u="";p.value?(v.value=w.EDIT,u=`Client ${p.value.comercialName}`):(v.value=w.CREATE,s.setNewCustomer(C.params.id),u="Alta de client"),N.setMenuItem({icon:I.BUILDING,title:u,backButtonVisible:!0})};Q(async()=>{await n()});const c=S(),E=async()=>{const u=p.value;let o=!1,V="";v.value===w.CREATE?(o=await s.createCustomer(u),V="Client creat correctament"):(o=await s.updateCustomer(u.id,u),V="Client actualizat correctament"),o&&(c.add({severity:"success",summary:V,life:5e3}),await n())},d=async u=>{await s.addContactToCustomer(u)&&c.add({severity:"success",summary:"Contacte afegit",life:5e3})},a=async u=>{await s.updateContactFromCustomer(u)&&c.add({severity:"success",summary:"Contacte actualizat",life:5e3})},e=async u=>{await s.removeContactFromCustomer(u)&&c.add({severity:"success",summary:"Contacte eliminat",life:5e3})},m=async u=>{await s.addAddressToCustomer(u)&&c.add({severity:"success",summary:"Adreça afegida",life:5e3})},_=async u=>{await s.updateAddressFromCustomer(u)&&c.add({severity:"success",summary:"Adreça actualizada",life:5e3})},i=async u=>{await s.removeAddressFromCustomer(u)&&c.add({severity:"success",summary:"Adreça eliminada",life:5e3})};return(u,o)=>{const V=f("TabPanel"),B=f("TabView");return y(),k(B,null,{default:h(()=>[l(V,null,{header:h(()=>[t("i",{class:b([r(I).WALLET,"mr-2"])},null,2),Be]),default:h(()=>[l(ne,{onSubmit:E})]),_:1}),v.value===r(w).EDIT?(y(),k(V,{key:0},{header:h(()=>[t("i",{class:b([r(I).USERS,"mr-2"])},null,2),Ae]),default:h(()=>[l(Ue,{onCreate:d,onUpdate:a,onDelete:e})]),_:1})):T("",!0),v.value===r(w).EDIT?(y(),k(V,{key:1},{header:h(()=>[t("i",{class:b([r(I).ENVELOPE,"mr-2"])},null,2),Fe]),default:h(()=>[l(ge,{onCreate:m,onUpdate:_,onDelete:i})]),_:1})):T("",!0)]),_:1})}}});export{je as default};
