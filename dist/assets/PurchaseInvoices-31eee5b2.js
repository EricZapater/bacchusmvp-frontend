import{d as B,j as F,x as M,g as L,u as T,r as E,o as O,P as _,h as u,c as R,i as o,w as i,k as c,a as U,e as d,C as p,D as m}from"./index-c46bd0de.js";import{u as j,a as G}from"./purchaseInvoices-06c31911.js";import{a as f,f as I}from"./functions-028ffd6d.js";import{v as J}from"./v4-a960c1f4.js";import"./index-1652550b.js";import"./base.service-a5cc43bf.js";import"./index-ba0630fe.js";import"./suppliers.service-338b0447.js";const $={class:"flex flex-wrap align-items-center justify-content-between gap-2"},A={class:"datatable-filter"},H={class:"filter-field"},K=d("label",{class:"block text-900 mb-2"},"Període",-1),Q={class:"filter-field"},Y=d("label",{class:"block text-900 mb-2"},"Proveïdor",-1),q={class:"datatable-buttons"},w="temges.purchaseinvoice.filter",re=B({__name:"PurchaseInvoices",setup(z){const g=F();M();const b=L(),S=T(),v=j(),D=G(),t=E({dates:void 0,supplierId:void 0});O(async()=>{await v.fetchMasterData();const e=localStorage.getItem(w);if(e!==null)t.value=JSON.parse(e),t.value.dates&&(t.value.dates[0]=new Date(t.value.dates[0]),t.value.dates[1]=new Date(t.value.dates[1])),await y();else{let a=new Date,r=new Date;a.setDate(r.getDate()-30);const l=f(a),h=f(r);await D.GetFiltered(l,h)}S.setMenuItem({icon:_.MONEY_BILL,title:"Factures de compra"})});const y=async()=>{if(t.value.dates){const e=f(t.value.dates[0]),a=f(t.value.dates[1]);await D.GetFiltered(e,a,void 0,void 0,t.value.supplierId),localStorage.setItem(w,JSON.stringify(t.value))}else g.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},N=e=>{var r;const a=(r=v.masterData.suppliers)==null?void 0:r.find(l=>l.id===e);return a?a.comercialName:""},C=e=>{var r;const a=(r=v.masterData.statuses)==null?void 0:r.find(l=>l.id===e);return a?a.name:""},P=e=>e.purchaseInvoiceDueDates?e.purchaseInvoiceDueDates.length===0?I(e.purchaseInvoiceDate):I(e.purchaseInvoiceDueDates[e.purchaseInvoiceDueDates.length-1].dueDate):"",V=()=>{b.push({path:`/purchaseInvoice/${J()}`})},k=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||b.push({path:`/purchaseinvoice/${e.data.id}`})};return(e,a)=>{const r=u("Calendar"),l=u("Dropdown"),h=u("Button"),n=u("Column"),x=u("DataTable");return U(),R("div",null,[o(x,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"75vh",sortMode:"multiple",value:c(D).purchaseInvoices,onRowClick:k},{header:i(()=>[d("div",$,[d("div",A,[d("div",H,[K,o(r,{modelValue:t.value.dates,"onUpdate:modelValue":a[0]||(a[0]=s=>t.value.dates=s),selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),d("div",Q,[Y,o(l,{modelValue:t.value.supplierId,"onUpdate:modelValue":a[1]||(a[1]=s=>t.value.supplierId=s),editable:"",options:c(v).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),d("div",q,[o(h,{class:"datatable-button",icon:c(_).FILTER,rounded:"",raised:"",onClick:y},null,8,["icon"]),o(h,{icon:c(_).PLUS,rounded:"",raised:"",onClick:V},null,8,["icon"])])])]),default:i(()=>[o(n,{field:"number",header:"Número",sortable:!0,style:{width:"10%"}}),o(n,{header:"Proveïdor",style:{width:"15%"}},{body:i(s=>[p(m(N(s.data.supplierId)),1)]),_:1}),o(n,{header:"Num Fra. Proveïdor",style:{width:"12%"},field:"supplierNumber"}),o(n,{header:"Estat",style:{width:"15%"}},{body:i(s=>[p(m(C(s.data.purchaseInvoiceStatusId)),1)]),_:1}),o(n,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:i(s=>[p(m(c(I)(s.data.purchaseInvoiceDate)),1)]),_:1}),o(n,{header:"Venciment",style:{width:"15%"}},{body:i(s=>[p(m(P(s.data)),1)]),_:1}),o(n,{header:"Import",style:{width:"15%"}},{body:i(s=>[p(m(s.data.netAmount)+" € ",1)]),_:1})]),_:1},8,["value"])])}}});export{re as default};
