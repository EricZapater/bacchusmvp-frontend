import{d as q,j as G,z as X,o as H,r as T,h as y,a as I,c as C,i as l,k as t,e as o,s as g,y as S,n as N,l as U,p as ie,b as ne,f as re,m as J,w as h,L as de,C as ce,D as A,P,v as ue,u as me,H as pe,E as fe,F as $,I as ve}from"./index-e1f2f827.js";import{u as K}from"./receipt-ca310d6a.js";import{u as be}from"./suppliers-c65ec9bd.js";import{u as Y}from"./lifecycle-558cc7d9.js";import{c as Z,a as M,F as ee,d as _e}from"./form-validator-d0c5af4e.js";import{c as ye,f as F,g as L}from"./functions-8d6e0d81.js";import{u as he}from"./masterData-22ddad59.js";import{u as te}from"./reference-ee955fc0.js";import{_ as we}from"./FormReference.vue_vue_type_script_setup_true_lang-ff0c19aa.js";import"./index-241e483d.js";import"./base.service-136124b3.js";import"./suppliers.service-63b7b07f.js";import"./index-68519385.js";import"./reference.service-89db32df.js";import"./v4-a960c1f4.js";import"./FileEntityPicker-2c4d6f3e.js";import"./file.service-c18c5abd.js";import"./tax-1cd55388.js";import"./referenceType-dcd3c232.js";const x=w=>(ie("data-v-0e818ff6"),w=w(),ne(),w),Ve=x(()=>o("br",null,null,-1)),Ie={key:0},Re={class:"three-columns"},De={class:"mt-1"},ge={class:"mt-1"},Se=x(()=>o("label",{class:"block text-900 mb-2"},"Exercici",-1)),Ce={class:"mt-1"},ke=x(()=>o("label",{class:"block text-900 mb-2"},"Data Albarà",-1)),Ee={class:"three-columns"},$e={class:"mt-1"},Te=x(()=>o("label",{class:"block text-900 mb-2"},"Estat",-1)),Ne={class:"mt-1"},Ue=x(()=>o("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),xe={class:"mt-1"},Be=q({__name:"FormReceipt",emits:["submit","cancel"],setup(w,{expose:R,emit:V}){const p=K(),f=be(),m=he(),i=Y(),d=G(),{receipt:r}=X(p);H(async()=>{await m.fetchMasterData(),await f.fetchSuppliers(),await i.fetchOneByName("Receipts")});const v=Z().shape({supplierId:M().required("El client es obligatori"),statusId:M().required("L'estat es obligatori"),exerciseId:M().required("L'exercici es obligatori")}),a=T({result:!1,errors:{}}),c=()=>{const _=new ee(v);a.value=_.validate(r.value)},u=async()=>{if(c(),a.value.result)r.value.date=ye(r.value.date),V("submit",r.value);else{let _="";Object.entries(a.value.errors).forEach(e=>{_+=`${e[1].map(k=>k)}.   `}),d.add({severity:"warn",summary:"Formulari inválid",detail:_,life:5e3})}};return R({submitForm:u}),(_,e)=>{var B;const k=y("Button"),E=y("Dropdown"),z=y("Calendar");return I(),C("div",null,[l(k,{label:"Guardar",size:"small",class:"grid_add_row_button",onClick:u}),Ve,t(r)?(I(),C("form",Ie,[o("section",Re,[o("div",De,[l(S,{type:t(g).TEXT,label:"Número",id:"number",modelValue:t(r).number,"onUpdate:modelValue":e[0]||(e[0]=b=>t(r).number=b),disabled:""},null,8,["type","modelValue"])]),o("div",ge,[Se,l(E,{modelValue:t(r).exerciseId,"onUpdate:modelValue":e[1]||(e[1]=b=>t(r).exerciseId=b),editable:"",options:t(m).exercises,optionValue:"id",optionLabel:"name",class:N(["w-full",{"p-invalid":a.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),o("div",Ce,[ke,l(z,{modelValue:t(r).date,"onUpdate:modelValue":e[2]||(e[2]=b=>t(r).date=b),dateFormat:"dd/mm/yy"},null,8,["modelValue"])])]),o("section",Ee,[o("div",$e,[Te,l(E,{modelValue:t(r).statusId,"onUpdate:modelValue":e[3]||(e[3]=b=>t(r).statusId=b),editable:"",options:(B=t(i).lifecycle)==null?void 0:B.statuses,optionValue:"id",optionLabel:"name",class:N(["w-full",{"p-invalid":a.value.errors.statusId}])},null,8,["modelValue","options","class"])]),o("div",Ne,[Ue,l(E,{modelValue:t(r).supplierId,"onUpdate:modelValue":e[4]||(e[4]=b=>t(r).supplierId=b),editable:"",options:t(f).suppliers,optionValue:"id",optionLabel:"comercialName",class:N(["w-full",{"p-invalid":a.value.errors.customerId}])},null,8,["modelValue","options","class"])]),o("div",xe,[l(S,{type:t(g).TEXT,label:"Número Proveïdor",id:"supplierNumber",modelValue:t(r).supplierNumber,"onUpdate:modelValue":e[5]||(e[5]=b=>t(r).supplierNumber=b)},null,8,["type","modelValue"])])])])):U("",!0)])}}});const Fe=re(Be,[["__scopeId","data-v-0e818ff6"]]),Le=["onClick"],Me=q({__name:"TableReceiptDetails",props:{details:{}},emits:["edit","delete"],setup(w,{emit:R}){const V=w,p=m=>{m.originalEvent.target.className.includes("grid_delete_column_button")||R("edit",m.data)},f=(m,i)=>{R("delete",i)};return(m,i)=>{const d=y("Column"),r=y("DataTable");return I(),J(r,{onRowClick:p,value:V.details,tableStyle:"min-width: 100%",class:"p-datatable-sm"},{header:h(()=>[de(m.$slots,"header")]),default:h(()=>[l(d,{field:"quantity",header:"Quantitat",style:{width:"10%"}}),l(d,{header:"Material",style:{width:"25%"}},{body:h(v=>[ce(A(v.data.reference.code)+" - "+A(v.data.reference.description),1)]),_:1}),l(d,{field:"width",header:"Amplada",style:{width:"10%"}}),l(d,{field:"height",header:"Alçada",style:{width:"10%"}}),l(d,{field:"lenght",header:"Longitud",style:{width:"10%"}}),l(d,{field:"diameter",header:"Diàmetre",style:{width:"10%"}}),l(d,{style:{width:"10%"}},{body:h(v=>[v.data.stockMovementId===null?(I(),C("i",{key:0,class:N([t(P).TIMES,"grid_delete_column_button"]),onClick:a=>f(a,v.data)},null,10,Le)):U("",!0)]),_:1})]),_:3},8,["value"])}}}),Ae={key:0},qe={class:"two-columns-7525"},ze=o("label",{class:"block text-900 mb-2"},"Material",-1),Oe={key:0,class:"flex align-items-center"},je={class:"four-columns"},Pe={class:"mt-2"},Ge={class:"mt-2"},Qe={class:"mt-2"},We={class:"mt-2"},Xe=q({__name:"FormReceiptDetail",props:{detail:{}},emits:["submit","cancel"],setup(w,{emit:R}){const V=w,p=G(),f=te(),m=()=>{V.detail},i=Z().shape({quantity:_e().min(1).required("La quantitat ha de ser superior a 1"),referenceId:M().required("La referencia és obligatoria")}),d=T({result:!1,errors:{}}),r=()=>{const a=new ee(i);d.value=a.validate(V.detail)},v=async()=>{if(r(),d.value.result)R("submit",V.detail);else{let a="";Object.entries(d.value.errors).forEach(c=>{a+=`${c[1].map(u=>u)}.   `}),p.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,c)=>{const u=y("Dropdown"),_=y("Button");return a.detail?(I(),C("form",Ae,[o("section",qe,[o("div",null,[ze,l(u,{modelValue:a.detail.referenceId,"onUpdate:modelValue":c[0]||(c[0]=e=>a.detail.referenceId=e),editable:"",options:t(f).references,optionValue:"id",optionLabel:"description",class:N(["w-full",{"p-invalid":d.value.errors.referenceId}])},{option:h(e=>[e.option?(I(),C("div",Oe,A(e.option.code)+" - "+A(e.option.description),1)):U("",!0)]),_:1},8,["modelValue","options","class"])]),o("div",null,[l(S,{type:t(g).NUMERIC,label:"Quantitat",modelValue:a.detail.quantity,"onUpdate:modelValue":[c[1]||(c[1]=e=>a.detail.quantity=e),m]},null,8,["type","modelValue"])])]),o("section",je,[o("div",Pe,[l(S,{type:t(g).NUMERIC,label:"Amplada",decimals:2,modelValue:a.detail.width,"onUpdate:modelValue":c[2]||(c[2]=e=>a.detail.width=e)},null,8,["type","modelValue"])]),o("div",Ge,[l(S,{type:t(g).NUMERIC,decimals:2,label:"Alçada",modelValue:a.detail.height,"onUpdate:modelValue":c[3]||(c[3]=e=>a.detail.height=e)},null,8,["type","modelValue"])]),o("div",Qe,[l(S,{type:t(g).NUMERIC,decimals:2,label:"Longitud",modelValue:a.detail.lenght,"onUpdate:modelValue":c[4]||(c[4]=e=>a.detail.lenght=e)},null,8,["type","modelValue"])]),o("div",We,[l(S,{type:t(g).NUMERIC,decimals:2,label:"Diàmetre",modelValue:a.detail.diameter,"onUpdate:modelValue":c[5]||(c[5]=e=>a.detail.diameter=e)},null,8,["type","modelValue"])])]),l(_,{label:"Crear",onClick:v,style:{float:"right"},size:"small",class:"mt-2"})])):U("",!0)}}}),He={key:0},Je=o("br",null,null,-1),Ke={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Ye=o("span",{class:"text-xl text-900 font-bold"},"Detall de l'albarà",-1),Ze={key:1},ht=q({__name:"Receipt",setup(w){const R=ue(),V=me(),p=te(),f=K(),m=Y(),{receipt:i}=X(f),d=T(0),r=async()=>{var s;await f.fetchReceipt(R.params.id),m.fetchOneByName("Receipts"),p.fetchReferencesByModule("purchase"),i.value&&(i.value.date=F(i.value.date)),V.setMenuItem({icon:P.BUILDING,title:`Albarà de recepció ${(s=i.value)==null?void 0:s.number}`,backButtonVisible:!0})};H(async()=>{await r()});const v=G(),a=pe(()=>{var n;if(!m.lifecycle)return!1;const s=m.lifecycle.statuses.find(D=>D.name==="Recepcionat");return s?((n=i.value)==null?void 0:n.statusId)===s.id:!1}),c=async()=>{let s=!1,n="";i.value&&(s=await f.updateReceipt(i.value.id,i.value),n="Albarà actualizat correctament",s&&(v.add({severity:"success",summary:n,life:5e3}),ve.back()))},u=fe({visible:!1,title:"Linea",closable:!0,position:"center",modal:!0}),_=T($.CREATE),e=T({}),k=()=>{_.value=$.CREATE,e.value={id:L(),receiptId:i.value.id,amount:0,diameter:0,height:0,kilogramPrice:0,lenght:0,quantity:1,thickness:0,totalWeight:0,unitPrice:0,unitWeight:0,width:0,disabled:!1},p.setNewReference(L()),u.title="Crear línia",u.visible=!0},E=s=>{_.value=$.EDIT,e.value=s,p.setNewReference(L()),u.title="Modificar línia",u.visible=!0},z=s=>{_.value===$.CREATE?B(s):_.value===$.EDIT&&b(s),u.visible=!1},B=async s=>{const n=await f.createReceiptDetail(s);i.value.date=F(i.value.date),n.result||O(n)},b=async s=>{const n=await f.updateReceiptDetail(s.id,s);i.value.date=F(i.value.date),n.result||O(n)},ae=async s=>{const n=await f.deleteReceiptDetail(s.id);i.value.date=F(i.value.date),n.result||O(n)},O=s=>{v.add({severity:"error",summary:s.errors[0],life:1e4,closable:!0})},le=async s=>{let n=!1,D="";n=await p.createReference(s),n?D="Referència creada correctament":D="La referència + versió introduïda ja existeix",v.add({severity:n?"success":"warn",summary:D,life:5e3}),n&&(e.value.referenceId=s.id,d.value=0,p.setNewReference(L()))};return(s,n)=>{var W;const D=y("Button"),Q=y("TabPanel"),se=y("TabView"),oe=y("Dialog");return t(i)?(I(),C("main",He,[l(Fe,{onSubmit:c}),Je,l(Me,{details:(W=t(i))==null?void 0:W.details,onEdit:E,onDelete:ae},{header:h(()=>[o("div",Ke,[Ye,o("div",null,[l(D,{size:"small",icon:t(P).PLUS,rounded:"",disabled:a.value,onClick:k},null,8,["icon","disabled"])])])]),_:1},8,["details"]),l(oe,{visible:u.visible,"onUpdate:visible":n[1]||(n[1]=j=>u.visible=j),header:u.title,closable:u.closable,modal:u.modal},{default:h(()=>[l(se,{activeIndex:d.value,"onUpdate:activeIndex":n[0]||(n[0]=j=>d.value=j)},{default:h(()=>[l(Q,{header:"Línea"},{default:h(()=>[l(Xe,{detail:e.value,onSubmit:z},null,8,["detail"])]),_:1}),l(Q,{header:"Referencia"},{default:h(()=>[t(p).reference?(I(),J(we,{key:0,module:"purchase",reference:t(p).reference,onSubmit:le},null,8,["reference"])):U("",!0)]),_:1})]),_:1},8,["activeIndex"])]),_:1},8,["visible","header","closable","modal"])])):(I(),C("main",Ze,"Carregant albarà ..."))}}});export{ht as default};
