import{_ as M}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-43dce955.js";import{_ as V}from"./FormCreateWorkorder.vue_vue_type_script_setup_true_lang-8ae11db6.js";import{d as A,g as $,u as Q,j,x as q,r as C,E as U,o as H,P as p,h as _,c as Y,i as e,w as i,k as s,G as z,a as G,e as n,C as w,D as x,n as J}from"./index-19723412.js";import{u as K}from"./reference-9dcfccff.js";import{a as I,f as X}from"./functions-79f2dbc4.js";import{u as Z}from"./exercise-d549878b.js";import{u as ee}from"./lifecycle-ad25beff.js";import{u as te}from"./workorder-76074e4e.js";import{u as ae}from"./workmaster-5a5400db.js";import"./form-validator-f8953ae6.js";import"./_commonjsHelpers-725317a4.js";import"./reference.service-fb6ab95a.js";import"./base.service-2e682391.js";import"./v4-a960c1f4.js";import"./index-524ef867.js";import"./index-02c37b31.js";const oe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},se={class:"datatable-filter"},re={class:"filter-field"},ie={class:"filter-field"},ne=n("label",{class:"block text-900 mb-2"},"Estat",-1),le={class:"datatable-buttons"},ce=["onClick"],Ie=A({__name:"Workorders",setup(de){const D=$(),r=Q(),g=j(),E=q(),P=ae(),l=te(),S=K(),v=Z(),b=ee(),B=()=>{var m;const o=new Date().getFullYear().toString(),t=(m=v.exercises)==null?void 0:m.find(f=>f.name===o);t&&(r.exercisePicker.exercise=t,r.exercisePicker.dates=[new Date(r.exercisePicker.exercise.startDate),new Date(r.exercisePicker.exercise.endDate)])},u=C({referenceId:void 0,statusId:void 0}),O=()=>{u.value.referenceId=void 0,u.value.statusId=void 0},k=async()=>{if(r.exercisePicker.dates){const o=I(r.exercisePicker.dates[0]),t=I(r.exercisePicker.dates[1]);await l.fetchFiltered(o,t,u.value.statusId)}else g.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},c=U({visible:!1,title:"Crear ordre",closable:!0,position:"center",modal:!0}),h=C({workMasterId:"",plannedDate:"",plannedQuantity:0,comment:""});H(async()=>{await S.fetchReferencesByModule("sales"),await v.fetchActive(),b.fetchOneByName("WorkOrder"),P.fetchAllActives(),r.setMenuItem({icon:p.CALENDAR,title:"Ordres de fabricació"}),B(),k()});const T=()=>{c.visible=!0},F=o=>{o.originalEvent.target.className.includes("grid_delete_column_button")||D.push({path:`/workorder/${o.data.id}`})},R=async()=>{if(!h.value)return;await l.create(h.value)&&l.workorder&&D.push({path:`/workorder/${l.workorder.id}`})},N=(o,t)=>{E.require({target:o.currentTarget,message:`Está segur que vol eliminar la ordre ${t.code}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await l.delete(t.id)&&(g.add({severity:"success",summary:"Eliminada",life:3e3}),k())}})};return(o,t)=>{const m=_("Dropdown"),f=_("Button"),d=_("Column"),W=_("DataTable"),L=_("Dialog");return G(),Y(z,null,[e(W,{value:s(l).workorders,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",onRowClick:F},{header:i(()=>{var a;return[n("div",oe,[n("div",se,[n("div",re,[e(M,{exercises:s(v).exercises},null,8,["exercises"])]),n("div",ie,[ne,e(m,{modelValue:u.value.statusId,"onUpdate:modelValue":t[0]||(t[0]=y=>u.value.statusId=y),editable:"",options:(a=s(b).lifecycle)==null?void 0:a.statuses,optionValue:"id",optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])])]),n("div",le,[e(f,{class:"datatable-button mr-2",icon:s(p).FILTER,rounded:"",raised:"",onClick:k},null,8,["icon"]),e(f,{class:"datatable-button mr-2",icon:s(p).FILTER_SLASH,rounded:"",raised:"",onClick:O},null,8,["icon"]),e(f,{icon:s(p).PLUS,rounded:"",raised:"",onClick:T},null,8,["icon"])])])]}),default:i(()=>[e(d,{field:"code",header:"Codi",style:{width:"15%"}}),e(d,{header:"Referencia",style:{width:"40%"}},{body:i(a=>[w(x(s(S).getFullNameById(a.data.referenceId)),1)]),_:1}),e(d,{field:"statusId",header:"Estat",style:{width:"10%"}},{body:i(a=>[w(x(s(b).getStatusName(a.data.statusId)),1)]),_:1}),e(d,{field:"plannedDate",header:"Data Prevista",style:{width:"10%"}},{body:i(a=>[w(x(s(X)(a.data.plannedDate)),1)]),_:1}),e(d,{field:"plannedQuantity",header:"Quantitat",style:{width:"10%"}}),e(d,null,{body:i(a=>[n("i",{class:J([s(p).TIMES,"grid_delete_column_button"]),onClick:y=>N(y,a.data)},null,10,ce)]),_:1})]),_:1},8,["value"]),e(L,{visible:c.visible,"onUpdate:visible":t[1]||(t[1]=a=>c.visible=a),header:c.title,closable:c.closable,modal:c.modal},{default:i(()=>[e(V,{createWorkOrderDto:h.value,onSubmit:R},null,8,["createWorkOrderDto"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Ie as default};
