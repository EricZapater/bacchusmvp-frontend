import{d as L,j as z,H as le,r as M,h as P,a as D,c as j,e,i as t,k as i,n as $,s as x,y as N,l as q,E as J,x as de,w as m,P as R,C as g,D as O,m as F,G as K,K as ne,v as ie,g as ue,u as ce,z as me,o as pe,p as ke,b as fe,f as we}from"./index-b40c6ded.js";import{u as H}from"./plantmodel-c31dbb24.js";import{u as X}from"./workorder-99068ac1.js";import{c as Y,a as S,d as Q,F as Z}from"./form-validator-f8953ae6.js";import{_ as be}from"./DropdownReference.vue_vue_type_script_setup_true_lang-8fd6db31.js";import{u as G}from"./lifecycle-5c03d44c.js";import{_ as he,a as _e}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-aef7e439.js";import{g as ee,e as ve,f as ye,c as Pe}from"./functions-79f2dbc4.js";import{u as te}from"./productionpart-465ad386.js";import{u as Ie}from"./reference-c2502c33.js";import"./index-644471ec.js";import"./base.service-265c7e5a.js";import"./_commonjsHelpers-725317a4.js";import"./index-21bedaf3.js";import"./reference.service-9da581c8.js";import"./v4-a960c1f4.js";const Oe={key:0},Ve={class:"mt-2"},Ce=e("label",{class:"block text-900 mb-2"},"Fase | Activitat",-1),Te={class:"three-columns mt-2"},ge=e("label",{class:"block text-900 mb-2"},"Operari",-1),De=e("label",{class:"block text-900 mb-2"},"Màquina",-1),$e=e("label",{class:"block text-900 mb-2"},"Data Tíquet",-1),Se={class:"two-columns mt-2"},qe=e("br",null,null,-1),We={class:"flex-right"},Be=L({__name:"FormWorkOrderProductionPart",props:{productionPart:{},avoidWorkOrderRefresh:{type:Boolean}},emits:["submit","cancel"],setup(V,{emit:C}){const v=V,y=z(),T=H(),w=X(),_=le(()=>{var p,n,k;if(!v.productionPart.workOrderPhaseId)return[];const u=(n=(p=w.workorder)==null?void 0:p.phases)==null?void 0:n.find(h=>h.id===v.productionPart.workOrderPhaseId);return u?(k=T.workcenters)==null?void 0:k.filter(h=>h.workcenterTypeId===u.workcenterTypeId):T.workcenters}),d=M(void 0),o=()=>{d.value.value&&(v.productionPart.workOrderId=d.value.value.workOrderId,v.productionPart.workOrderPhaseId=d.value.value.workOrderPhaseId,v.productionPart.workOrderPhaseDetailId=d.value.value.workOrderPhaseDetailId)},s=Y().shape({operatorId:S().required("Escull un operari"),workcenterId:S().required("Escull una màquina"),workOrderId:S().required("Escull una ordre de fabricació"),workOrderPhaseId:S().required("Escull una fase"),workOrderPhaseDetailId:S().required("Escull una activitat"),quantity:Q().required("Has d'introduir una quantitat entera (pot ser 0)").integer(),time:Q().required("Has d'introduir el temps i ha de ser major que 0").moreThan(0)}),r=M({result:!1,errors:{}}),b=()=>{const u=new Z(s);r.value=u.validate(v.productionPart)},I=async u=>{v.avoidWorkOrderRefresh||(d.value=void 0,await w.fetchByWorkcenterId(u))},c=async()=>{if(b(),r.value.result)C("submit",v.productionPart);else{let u="";Object.entries(r.value.errors).forEach(p=>{u+=`${p[1].map(n=>n)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}};return(u,p)=>{var f,B,E;const n=P("Dropdown"),k=P("Calendar"),h=P("Button");return u.productionPart?(D(),j("form",Oe,[e("section",Ve,[e("div",null,[Ce,t(n,{modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=l=>d.value=l),editable:"",filter:!0,options:(f=i(w).detailedWorkOrders)==null?void 0:f.sort((l,a)=>l.workOrderCode.localeCompare(a.workOrderCode)).map(l=>({label:"Fase "+l.workOrderPhaseCode+"  ("+l.workOrderPhaseDescription+") | "+l.machineStatusDescription,value:l})),optionLabel:"label",class:$(["w-full",{"p-invalid":r.value.errors.workOrderId}]),onChange:o},null,8,["modelValue","options","class"])])]),e("section",Te,[e("div",null,[ge,t(n,{modelValue:u.productionPart.operatorId,"onUpdate:modelValue":p[1]||(p[1]=l=>u.productionPart.operatorId=l),editable:"",filter:!0,options:(B=i(T).operators)==null?void 0:B.sort((l,a)=>l.surname.localeCompare(a.surname)).map(l=>({value:l.id,label:l.name+" "+l.surname})),optionValue:"value",optionLabel:"label",class:$(["w-full",{"p-invalid":r.value.errors.operatorid}])},null,8,["modelValue","options","class"])]),e("div",null,[De,t(n,{modelValue:u.productionPart.workcenterId,"onUpdate:modelValue":p[2]||(p[2]=l=>u.productionPart.workcenterId=l),editable:"",filter:!0,options:(E=_.value)==null?void 0:E.sort((l,a)=>l.description.localeCompare(a.description)),optionValue:"id",optionLabel:"description",class:"w-full",onChange:p[3]||(p[3]=l=>I(u.productionPart.workcenterId))},null,8,["modelValue","options"])]),e("div",null,[$e,t(k,{modelValue:u.productionPart.date,"onUpdate:modelValue":p[4]||(p[4]=l=>u.productionPart.date=l),dateFormat:"dd/mm/yy"},null,8,["modelValue"])])]),e("section",Se,[e("div",null,[t(N,{type:i(x).NUMERIC,label:"Quantitat",id:"quantity",modelValue:u.productionPart.quantity,"onUpdate:modelValue":p[5]||(p[5]=l=>u.productionPart.quantity=l)},null,8,["type","modelValue"])]),e("div",null,[t(N,{type:i(x).NUMERIC,label:"Temps total (minuts)",id:"time",modelValue:u.productionPart.time,"onUpdate:modelValue":p[6]||(p[6]=l=>u.productionPart.time=l)},null,8,["type","modelValue"])])]),qe,e("div",We,[t(h,{label:"Guardar",size:"small",onClick:c})])])):q("",!0)}}}),Ee={key:0},Ue=e("br",null,null,-1),Fe={class:"four-columns"},Me=e("label",{class:"block text-900 mb-2"},"Data Prevista",-1),Ne={class:"four-columns"},Re=e("label",{class:"block text-900 mb-2"},"Data Inici",-1),Le=e("label",{class:"block text-900 mb-2"},"Data Fi",-1),xe=e("label",{class:"block text-900 mb-2"},"Comentari Fabricació",-1),Qe=L({__name:"FormWorkorder",props:{workorder:{}},emits:["submit","cancel"],setup(V,{emit:C}){const v=V;G();const y=z(),T=Y().shape({plannedQuantity:Q().min(1,"La quantitat ha de ser superior a 0").required("La quanitat és obligatoria"),referenceId:S().required("La referència és obligatoria"),order:Q().required("L'ordre és obligatori"),plannedDate:S().required("La data prevista és obligatoria")}),w=M({result:!1,errors:{}}),_=()=>{const o=new Z(T);w.value=o.validate(v.workorder)},d=async()=>{if(_(),w.value.result)C("submit",v.workorder);else{let o="";Object.entries(w.value.errors).forEach(s=>{o+=`${s[1].map(r=>r)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,s)=>{const r=P("Button"),b=P("Calendar"),I=P("Textarea");return o.workorder?(D(),j("form",Ee,[e("div",null,[t(r,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:d}),Ue]),e("section",Fe,[e("div",null,[t(N,{label:"Codi",modelValue:o.workorder.code,"onUpdate:modelValue":s[0]||(s[0]=c=>o.workorder.code=c),disabled:""},null,8,["modelValue"])]),e("div",null,[t(be,{label:"Referència",modelValue:o.workorder.referenceId,"onUpdate:modelValue":s[1]||(s[1]=c=>o.workorder.referenceId=c),fullName:!0,disabled:""},null,8,["modelValue"])]),e("div",null,[t(N,{type:i(x).NUMERIC,label:"Quantitat",modelValue:o.workorder.plannedQuantity,"onUpdate:modelValue":s[2]||(s[2]=c=>o.workorder.plannedQuantity=c),class:$({"p-invalid":w.value.errors.plannedQuantity})},null,8,["type","modelValue","class"])]),e("div",null,[Me,t(b,{modelValue:o.workorder.plannedDate,"onUpdate:modelValue":s[3]||(s[3]=c=>o.workorder.plannedDate=c),dateFormat:"dd/mm/yy",class:$(["mt-2",{"p-invalid":w.value.errors.plannedDate}])},null,8,["modelValue","class"])])]),e("section",Ne,[e("div",null,[t(he,{label:"Estat",modelValue:o.workorder.statusId,"onUpdate:modelValue":s[4]||(s[4]=c=>o.workorder.statusId=c),class:$({"p-invalid":w.value.errors.statusId})},null,8,["modelValue","class"])]),e("div",null,[Re,t(b,{modelValue:o.workorder.startTime,"onUpdate:modelValue":s[5]||(s[5]=c=>o.workorder.startTime=c),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),e("div",null,[Le,t(b,{modelValue:o.workorder.endTime,"onUpdate:modelValue":s[6]||(s[6]=c=>o.workorder.endTime=c),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),e("div",null,[t(N,{type:i(x).NUMERIC,label:"Ordre",modelValue:o.workorder.order,"onUpdate:modelValue":s[7]||(s[7]=c=>o.workorder.order=c),class:$({"p-invalid":w.value.errors.plannedorderQuantity})},null,8,["type","modelValue","class"])])]),e("div",null,[xe,t(I,{class:"w-full",modelValue:o.workorder.comment,"onUpdate:modelValue":s[8]||(s[8]=c=>o.workorder.comment=c)},null,8,["modelValue"])])])):q("",!0)}}}),je={class:"flex flex-wrap align-items-center justify-content-between gap-2"},He=e("span",{class:"text-xl text-900 font-bold"},"Fases",-1),Ae=["onClick"],ze=L({__name:"TableWorkorderPhases",props:{workorder:{},workorderPhases:{}},emits:["add","edit","delete"],setup(V,{emit:C}){const v=V,y=J({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),T=de(),w=H(),_=G(),d=n=>{var h;if(!w.workcenterTypes)return"";const k=(h=w.workcenterTypes)==null?void 0:h.find(f=>n===f.id);return k?k.name:""},o=n=>{var h;if(!w.workcenters)return"";const k=(h=w.workcenters)==null?void 0:h.find(f=>n===f.id);return k?k.name:""},s=n=>{var h;if(!w.operatorTypes)return"";const k=(h=w.operatorTypes)==null?void 0:h.find(f=>n===f.id);return k?k.name:""},r=n=>{var h;if(!_.lifecycle||!_.lifecycle.statuses)return"";const k=(h=_.lifecycle.statuses)==null?void 0:h.find(f=>n===f.id);return k?k.name:""},b=M({}),I=()=>{b.value={id:ee(),workOrderId:v.workorder.id,disabled:!1,code:((v.workorder.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,statusId:"",startTime:null,endTime:null,workOrderPhaseDetails:[],workOrderPhaseBillOfMaterials:[]},y.visible=!0},c=n=>{y.visible=!1,C("add",n)},u=n=>{n.originalEvent.target.className.includes("grid_delete_column_button")||C("edit",n.data)},p=(n,k)=>{T.require({target:n.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{C("delete",k)}})};return(n,k)=>{const h=P("Button"),f=P("Column"),B=P("BooleanColumn"),E=P("DataTable"),l=P("Dialog");return D(),j(K,null,[t(E,{onRowClick:u,value:n.workorderPhases,tableStyle:"min-width: 100%"},{header:m(()=>[e("div",je,[He,t(h,{icon:i(R).PLUS,rounded:"",raised:"",onClick:I},null,8,["icon"])])]),default:m(()=>[t(f,{field:"code",header:"Codi",style:{width:"10%"}}),t(f,{field:"description",header:"Descripció",style:{width:"15%"}}),t(f,{header:"Tipus de màquina",style:{width:"15%"}},{body:m(a=>[g(O(d(a.data.workcenterTypeId)),1)]),_:1}),t(f,{header:"Màquina preferida",style:{width:"15%"}},{body:m(a=>[g(O(o(a.data.preferredWorkcenterId)),1)]),_:1}),t(f,{header:"Tipus d'operari",style:{width:"15%"}},{body:m(a=>[g(O(s(a.data.operatorTypeId)),1)]),_:1}),t(f,{header:"Estat",style:{width:"15%"}},{body:m(a=>[g(O(r(a.data.statusId)),1)]),_:1}),t(f,{header:"Extern",style:{width:"5%"}},{body:m(a=>[t(B,{value:a.data.isExternalWork},null,8,["value"])]),_:1}),t(f,{style:{width:"5%"}},{body:m(a=>[e("i",{class:$([i(R).TIMES,"grid_delete_column_button"]),onClick:U=>p(U,a.data)},null,10,Ae)]),_:1})]),_:1},8,["value"]),t(l,{visible:y.visible,"onUpdate:visible":k[0]||(k[0]=a=>y.visible=a),header:y.title,closable:y.closable,modal:y.modal},{default:m(()=>[b.value?(D(),F(_e,{key:0,workorder:n.workorder,phase:b.value,onSubmit:c},null,8,["workorder","phase"])):q("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),Ge=["onClick"],Je=L({__name:"TableProductionParts",emits:["delete"],setup(V,{emit:C}){const v=te(),y=H(),T=_=>{if(!_)return"";if(_.workOrderPhase&&_.workOrderPhaseDetail){const d=y.getMachineStatusNameById(_.workOrderPhaseDetail.machineStatusId);return`(${_.workOrderPhase.code}) ${_.workOrderPhase.description} - ${d}`}},w=(_,d)=>{_.stopPropagation(),C("delete",d)};return(_,d)=>{const o=P("Column"),s=P("DataTable");return D(),F(s,{value:i(v).productionParts,class:"p-datatable-sm",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"40vh"},{header:m(()=>[ne(_.$slots,"header")]),empty:m(()=>[g(" No s'han trobat tiquets. ")]),loading:m(()=>[g(" Carregant tiquets. Si us plau espera. ")]),default:m(()=>[t(o,{field:"operatorId",header:"Operari",style:{width:"15%"}},{body:m(r=>[g(O(i(y).getOperatorNameById(r.data.operatorId)),1)]),_:1}),t(o,{field:"workcenterId",header:"Màquina",style:{width:"20%"}},{body:m(r=>[g(O(i(y).getWorkcenterNameById(r.data.workcenterId)),1)]),_:1}),t(o,{field:"workOrderPhaseId",header:"Fase/Estat",style:{width:"25%"}},{body:m(r=>[g(O(T(r.data)),1)]),_:1}),t(o,{field:"date",header:"Data",style:{width:"15%"}},{body:m(r=>[g(O(i(ve)(r.data.date)),1)]),_:1}),t(o,{field:"quantity",header:"Quantitat",style:{width:"10%"}}),t(o,{field:"time",header:"Temps Total (min)",style:{width:"15%"}}),t(o,{style:{width:"5%"}},{body:m(r=>[e("i",{class:$([i(R).TIMES,"grid_delete_column_button"]),onClick:b=>w(b,r.data)},null,10,Ge)]),_:1})]),_:3},8,["value"])}}}),W=V=>(ke("data-v-62722695"),V=V(),fe(),V),Ke={class:"main"},Xe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Ye=W(()=>e("span",{class:"text-xl text-900 font-bold"},"Hores",-1)),Ze={class:"three-columns"},et={class:"mt-1"},tt=W(()=>e("label",{class:"block text-900 mb-2"},"Temps Operari:",-1)),ot={class:"summary-field"},rt={class:"mt-1"},at=W(()=>e("label",{class:"block text-900 mb-2"},"Temps Màquina:",-1)),st={class:"summary-field"},lt=W(()=>e("div",{class:"mt-1"},null,-1)),dt={class:"mt-1"},nt=W(()=>e("label",{class:"block text-900 mb-2"},"Cost Operari:",-1)),it={class:"summary-field"},ut={class:"mt-1"},ct=W(()=>e("label",{class:"block text-900 mb-2"},"Cost Máquina:",-1)),mt={class:"summary-field"},pt={class:"mt-1"},kt=W(()=>e("label",{class:"block text-900 mb-2"},"Cost Material:",-1)),ft={class:"summary-field"},wt=L({__name:"Workorder",setup(V){const C=ie(),v=ue(),y=ce(),T=z(),w=G(),_=Ie(),d=X(),o=H(),s=te(),{workorder:r}=me(d),b=M(""),I=J({visible:!1,title:"Crear tíquet de producció",closable:!0,position:"center",modal:!0});pe(async()=>{b.value=C.params.id,d.detailedWorkOrders=void 0,await u();let a="";a="Ordre de fabricació",r.value&&(a=`${a} ${r.value.code}`),y.setMenuItem({icon:R.BUILDING,backButtonVisible:!0,title:a})});const c=async()=>{await d.fetchOne(b.value),d.workorder&&(d.workorder.plannedDate=ye(d.workorder.plannedDate))},u=async()=>{_.fetchReferencesByModule("sales"),o.fetchActiveModel(),w.fetchOneByName("WorkOrder"),s.fetchByWorkOrderId(b.value),await c()},p=async a=>{d.workorder&&(d.workorder.plannedDate=Pe(d.workorder.plannedDate)),await d.update(b.value,a)&&await u()},n=async a=>{await d.createPhase(a)?v.push({path:`/workorder/${b.value}/phase/${a.id}`}):T.add({severity:"error",summary:"Error al crear la fase",detail:"Revisi el log per a més informació"})},k=a=>{v.push({path:`/workorder/${b.value}/phase/${a.id}`})},h=async a=>{await d.deletePhase(a.id)},f=M({}),B=()=>{f.value={id:ee(),workOrderId:b.value,workOrderPhaseId:"",workOrderPhaseDetailId:"",operatorId:"",workcenterId:"",time:0,quantity:0,date:new Date},r.value&&d.fetchByWorkOrderId(r.value.id),I.visible=!0},E=async()=>{I.visible=!1,await s.create(f.value)&&(s.fetchByWorkOrderId(b.value),c())},l=async a=>{await s.delete(a.id),s.fetchByWorkOrderId(b.value),c()};return(a,U)=>{const A=P("TabPanel"),oe=P("Button"),re=P("TabView"),ae=P("Dialog");return D(),j(K,null,[e("header",null,[i(r)?(D(),F(Qe,{key:0,workorder:i(r),onSubmit:p},null,8,["workorder"])):q("",!0)]),e("main",Ke,[t(re,null,{default:m(()=>[t(A,{header:"Fases"},{default:m(()=>[i(r)&&i(r).phases?(D(),F(ze,{key:0,workorder:i(r),workorderPhases:i(r).phases,onAdd:n,onEdit:k,onDelete:h},null,8,["workorder","workorderPhases"])):q("",!0)]),_:1}),t(A,{header:"Hores"},{default:m(()=>[i(s).productionParts?(D(),F(Je,{key:0,productionParts:i(s).productionParts,onDelete:l},{header:m(()=>[e("div",Xe,[Ye,t(oe,{icon:i(R).PLUS,rounded:"",raised:"",onClick:B},null,8,["icon"])])]),_:1},8,["productionParts"])):q("",!0)]),_:1}),i(r)?(D(),F(A,{key:0,header:"Costs"},{default:m(()=>[e("section",Ze,[e("div",et,[tt,e("span",ot,O(i(r).operatorTime)+" mins.",1)]),e("div",rt,[at,e("span",st,O(i(r).machineTime)+" mins.",1)]),lt,e("div",dt,[nt,e("span",it,O(i(r).operatorCost.toFixed(2))+" €",1)]),e("div",ut,[ct,e("span",mt,O(i(r).machineCost.toFixed(2))+" €",1)]),e("div",pt,[kt,e("span",ft,O(i(r).materialCost.toFixed(2))+" €",1)])])]),_:1})):q("",!0)]),_:1})]),t(ae,{visible:I.visible,"onUpdate:visible":U[0]||(U[0]=se=>I.visible=se),header:I.title,closable:I.closable,modal:I.modal},{default:m(()=>[t(Be,{productionPart:f.value,"avoid-work-order-refresh":!0,onSubmit:E},null,8,["productionPart"])]),_:1},8,["visible","header","closable","modal"])],64)}}});const Wt=we(wt,[["__scopeId","data-v-62722695"]]);export{Wt as default};
