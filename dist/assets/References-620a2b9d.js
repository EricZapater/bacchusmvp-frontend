import{d as F,r as $,H as R,h as T,m as c,w as d,a as l,e as u,i as f,y as z,c as K,l as i,k as g,P as S,D as b,C as E,n as G,p as J,b as O,f as N,g as Q,v as W,u as X,x as Y,j as Z,o as ee}from"./index-1f9e3570.js";import{u as P}from"./reference-79c88333.js";import{_ as te}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-bb57db33.js";import{u as L}from"./referenceType-0ccbc93e.js";import{u as oe}from"./customers-bcffdfde.js";import{v as se}from"./v4-a960c1f4.js";import"./reference.service-859533eb.js";import"./base.service-e02629e7.js";import"./index-a13a1f31.js";const M=_=>(J("data-v-231c64a9"),_=_(),O(),_),re={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ae={class:"datatable-filter"},ne={class:"filter-field"},le=M(()=>u("label",null,"Codi",-1)),ce={key:0,class:"filter-field"},de=M(()=>u("label",null,"Client",-1)),ie={class:"datatable-buttons"},ue=["onClick"],me=F({__name:"TableReferences",props:{module:{},references:{}},emits:["add","edit","delete"],setup(_,{emit:y}){const p=_,C=L(),k=P(),I=oe(),n=$({code:"",customerId:""}),w=()=>{n.value.code="",n.value.customerId=""},r=R(()=>p.module==="sales"),v=R(()=>p.module==="purchase");R(()=>p.module==="production");const B=R(()=>{if(!p.references)return[];let o=p.references;return n.value.customerId.length>0&&(o=o.filter(e=>e.customerId===n.value.customerId)),n.value.code.length>0&&(o=o.filter(e=>e.code.toLowerCase().includes(n.value.code.toLowerCase()))),o}),D=()=>{y("add")},x=o=>{o.originalEvent.target.className.includes("grid_delete_column_button")||y("edit",o.data)},V=(o,e)=>{y("delete",e)},a=o=>{const e=C.getReferenceTypeById(o);return e?e.density:0},h=o=>{var m;const e=(m=k.referenceFormats)==null?void 0:m.find(s=>s.id===o);return e?e.description:""},j=o=>{const e=C.getReferenceTypeById(o);return e?e.description:""},q=o=>{var m;const e=(m=I.customers)==null?void 0:m.find(s=>s.id===o);return e?e.comercialName:""};return(o,e)=>{const m=T("Button"),s=T("Column"),A=T("BooleanColumn"),H=T("DataTable");return l(),c(H,{value:B.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:x},{header:d(()=>[u("div",re,[u("div",ae,[u("div",ne,[le,f(z,{modelValue:n.value.code,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.code=t)},null,8,["modelValue"])]),r.value?(l(),K("div",ce,[de,f(te,{label:"",modelValue:n.value.customerId,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.customerId=t)},null,8,["modelValue"])])):i("",!0)]),u("div",ie,[f(m,{class:"datatable-button mr-2",icon:g(S).FILTER_SLASH,rounded:"",raised:"",onClick:w},null,8,["icon"]),f(m,{class:"datatable-button mr-2",icon:g(S).PLUS,rounded:"",raised:"",onClick:D},null,8,["icon"])])])]),default:d(()=>[f(s,{field:"code",header:"Codi",style:{width:"15%"}}),f(s,{field:"description",header:"Descripció",style:{width:"35%"}}),r.value?(l(),c(s,{key:0,field:"version",header:"Versió",style:{width:"10%"}})):i("",!0),r.value?(l(),c(s,{key:1,field:"customerId",header:"Client",style:{width:"20%"}},{body:d(t=>[u("span",null,b(q(t.data.customerId)),1)]),_:1})):i("",!0),r.value?(l(),c(s,{key:2,field:"price",header:"Preu",style:{width:"10%"}},{body:d(t=>[E(b(t.data.price)+" € ",1)]),_:1})):i("",!0),r.value?(l(),c(s,{key:3,field:"cost",header:"Cost",style:{width:"10%"}},{body:d(t=>[E(b(t.data.cost)+" € ",1)]),_:1})):i("",!0),r.value?(l(),c(s,{key:4,header:"Servei",style:{width:"10%"}},{body:d(t=>[f(A,{value:t.data.isService},null,8,["value"])]),_:1})):i("",!0),v.value?(l(),c(s,{key:5,field:"referenceTypeId",header:"Tipus",style:{width:"15%"}},{body:d(t=>[u("span",null,b(j(t.data.referenceTypeId)),1)]),_:1})):i("",!0),v.value?(l(),c(s,{key:6,header:"Densitat (mm)",style:{width:"10%"}},{body:d(t=>[E(b(a(t.data.referenceTypeId)),1)]),_:1})):i("",!0),v.value?(l(),c(s,{key:7,field:"referenceFormatId",header:"Format",style:{width:"10%"}},{body:d(t=>[u("span",null,b(h(t.data.referenceFormatId)),1)]),_:1})):i("",!0),v.value?(l(),c(s,{key:8,field:"lastPurchaseCost",header:"Última Compra",style:{width:"10%"}})):i("",!0),f(s,{style:{width:"10%"}},{body:d(t=>[u("i",{class:G([g(S).TIMES,"grid_delete_column_button"]),onClick:U=>V(U,t.data)},null,10,ue)]),_:1})]),_:1},8,["value"])}}});const fe=N(me,[["__scopeId","data-v-231c64a9"]]),pe=F({__name:"References",setup(_){const y=Q(),p=W(),C=X(),k=L(),I=P(),n=Y(),w=Z(),r=$("");ee(async()=>{r.value=p.params.module,await I.fetchReferencesByModule(r.value),k.fetchAll();let a="";r.value==="sales"?a="Referencies de venta":r.value==="purchase"?a="Materies primeres":r.value==="production"&&(a="Referencies de producció"),C.setMenuItem({icon:S.TICKET,title:a})});const v=()=>{y.push({path:`/reference/${r.value}/${se()}`})},B=a=>{y.push({path:`/reference/${r.value}/${a.id}`})},D=a=>{n.require({message:`Está segur que vol eliminar el material ${a.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const h=await I.deleteReference(a.id);console.log(h),h.result?V():x(h)}})},x=a=>{w.add({severity:"error",summary:a.errors[0],life:3e3,closable:!0})},V=()=>{w.add({severity:"success",summary:"Eliminat",life:3e3})};return(a,h)=>(l(),c(fe,{module:r.value,references:g(I).references,onAdd:v,onEdit:B,onDelete:D},null,8,["module","references"]))}});const Te=N(pe,[["__scopeId","data-v-210c3064"]]);export{Te as default};
