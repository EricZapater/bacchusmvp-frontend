import{b as Q,u as X}from"./vue-router-ffe4063c.js";import{o as h,c as w,e as o,r as B,m as T,j as L,k as R,M as z,f as V,h as l,w as g,t as M,l as t,P as k,F as Y,p as Z,n as I,d as U,ax as q,a as W,a0 as ee,u as te}from"./index-a2430148.js";import{F as ae,a as H,u as oe}from"./purchaseInvoices-dca7f7a7.js";import{u as G}from"./usetoast.esm-261cff49.js";import{B as N,F as S}from"./component-c8ee66ae.js";import{s as se,B as A}from"./BaseInput-2edd0472.js";import{c as le,a as j,F as ne}from"./form-validator-1a569dfe.js";import{c as ie,f as re}from"./functions-028ffd6d.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";import"./exercise.service-ceab6cec.js";import"./base.service-ac28cfab.js";import"./paymentmethod.service-65f61ad5.js";import"./tax.service-be95229b.js";import"./index-87fd5a83.js";import"./suppliers.service-1deeab6b.js";import"./runtime-dom.esm-bundler-ee5f76e0.js";var J={name:"Toolbar",extends:se,props:{"aria-labelledby":{type:String,default:null}}};const de=["aria-labelledby"];function ce(i,c,y,u,n,e){return h(),w("div",T({class:"p-toolbar p-component",role:"toolbar","aria-labelledby":i.ariaLabelledby},i.ptm("root")),[o("div",T({class:"p-toolbar-group-start p-toolbar-group-left"},i.ptm("start")),[B(i.$slots,"start")],16),o("div",T({class:"p-toolbar-group-center"},i.ptm("center")),[B(i.$slots,"center")],16),o("div",T({class:"p-toolbar-group-end p-toolbar-group-right"},i.ptm("end")),[B(i.$slots,"end")],16)],16,de)}function me(i,c){c===void 0&&(c={});var y=c.insertAt;if(!(!i||typeof document>"u")){var u=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",y==="top"&&u.firstChild?u.insertBefore(n,u.firstChild):u.appendChild(n),n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i))}}var pe=`
.p-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}
.p-toolbar-group-start,
.p-toolbar-group-center,
.p-toolbar-group-end {
    display: flex;
    align-items: center;
}
.p-toolbar-group-left,
.p-toolbar-group-right {
    display: flex;
    align-items: center;
}
`;me(pe);J.render=ce;const ve={class:"base_input"},be={class:"file-viewer"},fe={class:"file-viewer-item-type"},ye={class:"file-viewer-item-actions"},_e=["onClick"],Ie=["onClick"],he=L({__name:"FileEntityPicker",props:{title:{},entity:{},id:{}},setup(i){const c=i,y=G(),u=new ae,n=R(void 0),e=async()=>{n.value=await u.GetEntityFiles(c.entity,c.id)};z(async()=>{await e()});const f=async()=>{const m=document.createElement("input");m.type="file",m.onchange=async r=>{const _=r.target.files[0];if(!await u.Upload(_,c.entity,c.id)){y.add({severity:"error",detail:"Error al carregar l'arxiu"});return}await e()},m.click()},P=async m=>{const r=await u.Download(m);ie(m.originalName,r)},p=async m=>{var r=await u.Delete(m.id);if(!r){y.add({severity:"error",detail:"Error al eliminar l'arxiu"});return}await e()};return(m,r)=>{const _=V("Button");return h(),w("div",ve,[l(t(J),null,{start:g(()=>[o("h4",null,M(m.title),1)]),end:g(()=>[l(_,{size:"small",rounded:"",icon:t(k).UPLOAD,onClick:f},null,8,["icon"])]),_:1}),o("section",be,[(h(!0),w(Y,null,Z(n.value,d=>(h(),w("article",{class:"file-viewer-item",key:m.id},[o("div",fe,[d.type===0?(h(),w("i",{key:0,class:I(t(k).FILE_PDF),style:{"font-size":"3.5rem"}},null,2)):U("",!0),d.type===1?(h(),w("i",{key:1,class:I(t(k).IMAGE),style:{"font-size":"3.5rem"}},null,2)):U("",!0),o("p",null,M(d.originalName.substring(0,20)),1)]),o("div",ye,[o("div",{class:"file-viewer-item-action file-viewer-item-action-download",onClick:b=>P(d)},[o("i",{class:I(t(k).DOWNLOAD),style:{"font-size":"1rem"}},null,2)],8,_e),o("div",{class:"file-viewer-item-action file-viewer-item-action-delete",onClick:b=>p(d)},[o("i",{class:I(t(k).TIMES)},null,2)],8,Ie)])]))),128))])])}}});const Ve=ue(he,[["__scopeId","data-v-dd7a228d"]]),we={key:0},ge={class:"four-columns"},De=o("label",{class:"block text-900 mb-2"},"Exercici",-1),xe=o("label",{class:"block text-900 mb-2"},"Sèrie",-1),Fe=o("label",{class:"block text-900 mb-2"},"Estat",-1),Ae={class:"three-columns"},ke={class:"mt-2"},Pe=o("label",{class:"block text-900 mb-2"},"Proveïdor",-1),$e={class:"mt-2"},Ce={class:"mt-2"},Ee=o("label",{class:"block text-900 mb-2"},"Data Factura: ",-1),Te={class:"four-columns"},Ne={class:"mt-2"},Se={class:"mt-2"},Ue={class:"mt-2"},Be=o("label",{class:"block text-900 mb-2"},"IVA",-1),Me={class:"mt-2"},Le={class:"two-columns"},Re={class:"mt-2"},ze=o("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),Ge={class:"mt-2"},Oe={class:"mt-3"},je=L({__name:"FormPurchaseInvoice",props:{purchaseInvoice:{}},emits:["submit","cancel"],setup(i,{emit:c}){const y=i,u=H(),n=oe(),{purchaseInvoice:e}=q(u),f=G(),P=le().shape({exerciceId:j().required("L'exercici es obligatori"),supplierId:j().required("El proveïdor es obligatori")}),p=R({result:!1,errors:{}}),m=()=>{const b=new ne(P);p.value=b.validate(y.purchaseInvoice)};let r=!1;z(()=>{setTimeout(()=>r=!0,1e3)});const _=async()=>{if(m(),p.value.result)c("submit",e.value);else{let b="";Object.entries(p.value.errors).forEach(a=>{b+=`${a[1].map(v=>v)}.   `}),f.add({severity:"warn",summary:"Formulari inválid",detail:b,life:5e3})}},d=async()=>{var s;if(!r)return;var b=(s=n.masterData.taxes)==null?void 0:s.find(K=>{var O;return K.id===((O=e.value)==null?void 0:O.taxId)});let a=0,v=0,C=0,D=0,E=0,$=0,x=0,F=0;e.value&&(e.value.baseAmount&&(a=parseFloat(e.value.baseAmount.toFixed(2))),e.value.transportAmount&&(v=parseFloat(e.value.transportAmount.toFixed(2))),e.value.discountPercentage&&(x=parseFloat(e.value.discountPercentage.toFixed(2))),b&&(C=parseFloat(b.percentatge.toFixed(2)))),D=(a*1+v*1)*(C/100),F=a*1+v*1+D*1,$=F*(1*x)/100,E=F-$,e.value.baseAmount=a,e.value.transportAmount=v,e.value.taxAmount=D,e.value.grossAmount=F,e.value.netAmount=E,e.value.discountPercentage=x,e.value.discountAmount=$,e.value.purchaseInvoiceDueDates=await u.GetDueDates(e.value)};return(b,a)=>{const v=V("Dropdown"),C=V("Calendar"),D=V("Column"),E=V("DataTable"),$=V("Button"),x=V("TabPanel"),F=V("TabView");return h(),W(F,null,{default:g(()=>[l(x,{header:"Factura"},{default:g(()=>[t(e)?(h(),w("form",we,[o("section",ge,[o("div",null,[De,l(v,{modelValue:t(e).exerciceId,"onUpdate:modelValue":a[0]||(a[0]=s=>t(e).exerciceId=s),editable:"",options:t(n).masterData.exercises,optionValue:"id",optionLabel:"name",class:I(["w-full",{"p-invalid":p.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),o("div",null,[xe,l(v,{modelValue:t(e).purchaseInvoiceSerieId,"onUpdate:modelValue":a[1]||(a[1]=s=>t(e).purchaseInvoiceSerieId=s),editable:"",options:t(n).masterData.series,optionValue:"id",optionLabel:"name",class:I(["w-full",{"p-invalid":p.value.errors.purchaseInvoiceSerieId}])},null,8,["modelValue","options","class"])]),l(A,{label:"Num. Fra. Intern",id:"number",modelValue:t(e).number,"onUpdate:modelValue":a[2]||(a[2]=s=>t(e).number=s),disabled:""},null,8,["modelValue"]),o("div",null,[Fe,l(v,{modelValue:t(e).purchaseInvoiceStatusId,"onUpdate:modelValue":a[3]||(a[3]=s=>t(e).purchaseInvoiceStatusId=s),editable:"",options:t(n).masterData.statuses,optionValue:"id",optionLabel:"name",class:I(["w-full",{"p-invalid":p.value.errors.purchaseInvoiceStatusId}])},null,8,["modelValue","options","class"])])]),o("section",Ae,[o("div",ke,[Pe,l(v,{modelValue:t(e).supplierId,"onUpdate:modelValue":a[4]||(a[4]=s=>t(e).supplierId=s),editable:"",options:t(n).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:I(["w-full",{"p-invalid":p.value.errors.supplierId}])},null,8,["modelValue","options","class"])]),o("div",$e,[l(A,{label:"Num. Fra. Proveïdor",id:"supplierNumber",modelValue:t(e).supplierNumber,"onUpdate:modelValue":a[5]||(a[5]=s=>t(e).supplierNumber=s)},null,8,["modelValue"])]),o("div",Ce,[Ee,l(C,{id:"purchaseInvoiceDate",modelValue:t(e).purchaseInvoiceDate,"onUpdate:modelValue":a[6]||(a[6]=s=>t(e).purchaseInvoiceDate=s)},null,8,["modelValue"])])]),o("section",Te,[o("div",Ne,[l(A,{type:t(N).NUMERIC,label:"Base",id:"baseAmount",modelValue:t(e).baseAmount,"onUpdate:modelValue":[a[7]||(a[7]=s=>t(e).baseAmount=s),a[8]||(a[8]=s=>d())]},null,8,["type","modelValue"])]),o("div",Se,[l(A,{type:t(N).NUMERIC,label:"Ports",id:"transportAmount",modelValue:t(e).transportAmount,"onUpdate:modelValue":[a[9]||(a[9]=s=>t(e).transportAmount=s),a[10]||(a[10]=s=>d())]},null,8,["type","modelValue"])]),o("div",Ue,[Be,l(v,{modelValue:t(e).taxId,"onUpdate:modelValue":[a[11]||(a[11]=s=>t(e).taxId=s),a[12]||(a[12]=s=>d())],editable:"",options:t(n).masterData.taxes,optionValue:"id",optionLabel:"name",class:I(["w-full",{"p-invalid":p.value.errors.taxId}])},null,8,["modelValue","options","class"])]),o("div",Me,[l(A,{type:t(N).NUMERIC,label:"% Dto.",id:"discountPercentage",modelValue:t(e).discountPercentage,"onUpdate:modelValue":[a[13]||(a[13]=s=>t(e).discountPercentage=s),a[14]||(a[14]=s=>d())]},null,8,["type","modelValue"])])]),o("section",Le,[o("div",Re,[ze,l(v,{modelValue:t(e).paymentMethodId,"onUpdate:modelValue":[a[15]||(a[15]=s=>t(e).paymentMethodId=s),a[16]||(a[16]=s=>d())],editable:"",options:t(n).masterData.paymentMethods,optionValue:"id",optionLabel:"name",class:I(["w-full",{"p-invalid":p.value.errors.paymentmethod}])},null,8,["modelValue","options","class"])]),o("div",Ge,[l(A,{type:t(N).NUMERIC,label:"Total",id:"netAmount",modelValue:t(e).netAmount,"onUpdate:modelValue":a[17]||(a[17]=s=>t(e).netAmount=s),disabled:""},null,8,["type","modelValue"])])])])):U("",!0),o("div",Oe,[l(E,{value:t(e).purchaseInvoiceDueDates,tableStyle:"min-width: 100%"},{default:g(()=>[l(D,{field:"dueDate",header:"Venciment",style:{width:"50%"}},{body:g(s=>[ee(M(t(re)(s.data.dueDate)),1)]),_:1}),l(D,{field:"amount",header:"Import",style:{width:"50%"}})]),_:1},8,["value"])]),l($,{label:"Guardar",class:"mt-2",onClick:_})]),_:1}),l(x,{header:"Fitxers"},{default:g(()=>[l(Ve,{title:"Factures",entity:"PurchaseInvoice",id:t(e).id},null,8,["id"])]),_:1})]),_:1})}}}),it=L({__name:"PurchaseInvoice",setup(i){const c=R(S.EDIT),y=Q(),u=X(),n=te(),e=H(),{purchaseInvoice:f}=q(e),P=async()=>{await e.GetById(y.params.id);let r="";f.value?(c.value=S.EDIT,r=`Factura de compra: ${f.value.number}`,f.value.purchaseInvoiceDate=new Date(f.value.purchaseInvoiceDate)):(c.value=S.CREATE,e.setNewPurchaseInvoice(y.params.id),r="Alta de factures de compra"),n.setMenuItem({icon:k.POUND,backButtonVisible:!0,text:r})};z(async()=>{await P()});const p=G(),m=async()=>{const r=f.value;let _=!1,d="";c.value===S.CREATE?await e.Create(r)===!0&&(_=!0,d="Factura creada correctament"):await e.Update(r)===!0&&(_=!0,d="Factura actualizada correctament"),_&&(p.add({severity:"success",summary:d,life:5e3}),u.back())};return(r,_)=>t(f)?(h(),W(je,{key:0,purchaseInvoice:t(f),onSubmit:m},null,8,["purchaseInvoice"])):U("",!0)}});export{it as default};
