import{c as O,a as $,F as j,d as L}from"./form-validator-9d0a56f8.js";import{d as q,j as x,r as E,h as w,c as W,e as o,i,y as B,l as D,a as V,x as H,m as R,w as f,k as c,P as U,C as M,D as S,B as ie,n as g,s as A,v as ne,g as re,u as de,z as ue,E as me,o as ce,F as C,G as pe}from"./index-357c9d4c.js";import{g as Y}from"./functions-afe9fe15.js";import{u as z}from"./plantmodel-ce44b43b.js";import{u as G}from"./reference-35a8c4f2.js";import{_ as Q}from"./DropdownReference.vue_vue_type_script_setup_true_lang-b48b93b0.js";import{u as be}from"./workmaster-137f1d0f.js";import"./v4-a960c1f4.js";import"./index-6fe49fa3.js";import"./base.service-d0780977.js";import"./reference.service-387fdae1.js";const fe={key:0},ve=o("br",null,null,-1),he={class:"three-columns"},ye=q({__name:"FormWorkmasterPhase",props:{workmaster:{},phase:{}},emits:["submit","cancel"],setup(T,{emit:v}){const h=T,y=x(),m=O().shape({phaseCode:$().required("El codi és obligatori")}),b=E({result:!1,errors:{}}),d=()=>{const a=new j(m);b.value=a.validate(h.phase)},k=async()=>{if(d(),b.value.result)v("submit",h.phase);else{let a="";Object.entries(b.value.errors).forEach(e=>{a+=`${e[1].map(s=>s)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const s=w("Button");return a.phase?(V(),W("form",fe,[o("div",null,[i(s,{label:"Guardar Fase",class:"grid_add_row_button",size:"small",onClick:k}),ve]),o("section",he,[o("div",null,[i(B,{label:"Codi de la fase",modelValue:a.phase.phaseCode,"onUpdate:modelValue":e[0]||(e[0]=l=>a.phase.phaseCode=l)},null,8,["modelValue"])]),o("div",null,[i(B,{label:"Descripció",modelValue:a.phase.phaseDescription,"onUpdate:modelValue":e[1]||(e[1]=l=>a.phase.phaseDescription=l)},null,8,["modelValue"])])])])):D("",!0)}}}),ke={class:"flex flex-wrap align-items-center justify-content-between gap-2"},we=o("span",{class:"text-xl text-900 font-bold"},"Pasos de fabricació",-1),_e=["onClick"],Ie=q({__name:"TableWorkmasterPhaseDetails",props:{workmasterPhase:{},details:{}},emits:["add","edit","delete"],setup(T,{emit:v}){const h=T,y=H(),m=z(),b=n=>{var t;if(!m.workcenterTypes)return"";const p=(t=m.workcenterTypes)==null?void 0:t.find(u=>n===u.id);return p?p.name:""},d=n=>{var t;if(!m.workcenters)return"";const p=(t=m.workcenters)==null?void 0:t.find(u=>n===u.id);return p?p.name:""},k=n=>{var t;if(!m.operatorTypes)return"";const p=(t=m.operatorTypes)==null?void 0:t.find(u=>n===u.id);return p?p.name:""},a=n=>{var t;if(!m.machineStatuses)return"";const p=(t=m.machineStatuses)==null?void 0:t.find(u=>n===u.id);return p?p.name:""},e=()=>{const n={id:Y(),workMasterPhaseId:h.workmasterPhase.id,estimatedTime:0,isCycleTime:!1,isExternalWork:!1,externalWorkCost:0,machineStatusId:"",operatorTypeId:"",workcenterTypeId:""};v("add",n)},s=n=>{n.originalEvent.target.className.includes("grid_delete_column_button")||v("edit",n.data)},l=(n,p)=>{y.require({target:n.currentTarget,message:"Está segur que vol eliminar el pas de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",p)}})};return(n,p)=>{const t=w("Button"),u=w("Column"),P=w("DataTable");return V(),R(P,{onRowClick:s,value:n.details,tableStyle:"min-width: 100%"},{header:f(()=>[o("div",ke,[we,i(t,{icon:c(U).PLUS,rounded:"",raised:"",onClick:e},null,8,["icon"])])]),default:f(()=>[i(u,{header:"Tipus de màquina",style:{width:"25%"}},{body:f(_=>[M(S(b(_.data.workcenterTypeId)),1)]),_:1}),i(u,{header:"Estat de màquina",style:{width:"25%"}},{body:f(_=>[M(S(a(_.data.machineStatusId)),1)]),_:1}),i(u,{header:"Màquina preferida",style:{width:"25%"}},{body:f(_=>[M(S(d(_.data.preferredWorkcenterId)),1)]),_:1}),i(u,{header:"Tipus d'operari",style:{width:"25%"}},{body:f(_=>[M(S(k(_.data.operatorTypeId)),1)]),_:1}),i(u,{field:"estimatedTime",header:"Temps (min)",style:{width:"25%"}}),i(u,{header:"Extern",style:{width:"25%"}},{body:f(_=>[i(ie,{value:_.data.isExternalWork},null,8,["value"])]),_:1}),i(u,{style:{width:"25%"}},{body:f(_=>[o("i",{class:g([c(U).TIMES,"grid_delete_column_button"]),onClick:N=>l(N,_.data)},null,10,_e)]),_:1})]),_:1},8,["value"])}}}),Te={key:0},Ve={class:"three-columns"},ge=o("label",{class:"block text-900 mb-2"},"Tipus de màquina",-1),Ce=o("label",{class:"block text-900 mb-2"},"Màquina preferida",-1),Ee=o("label",{class:"block text-900 mb-2"},"Estat",-1),Pe={class:"three-columns mt-2"},De=o("label",{class:"block text-900 mb-2"},"Tipus d'operari",-1),Me=o("label",{class:"block text-900v mb-1"},"Temps de cicle",-1),Se={class:"three-columns mt-2"},Be=o("label",{class:"block text-900 mt-1 mb-1"},"Extern",-1),qe=o("br",null,null,-1),$e=q({__name:"FormWorkmasterPhaseDetail",props:{detail:{}},emits:["submit","cancel"],setup(T,{emit:v}){const h=T,y=z(),m=x(),b=O().shape({workcenterTypeId:$().required("El tipus de màquina és obligatoria"),machineStatusId:$().required("L'estat de màquina és obligatori"),operatorTypeId:$().required("El tipus d'operari és obligatori"),estimatedTime:L().required("El temps estimat és obligatori"),externalWorkCost:L().required("El cost extern és obligatori")}),d=E({result:!1,errors:{}}),k=()=>{const e=new j(b);d.value=e.validate(h.detail)},a=async()=>{if(k(),d.value.result)h.detail.preferredWorkcenterId===""&&(h.detail.preferredWorkcenterId=null),v("submit",h.detail);else{let e="";Object.entries(d.value.errors).forEach(s=>{e+=`${s[1].map(l=>l)}.   `}),m.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,s)=>{const l=w("Dropdown"),n=w("Checkbox"),p=w("Button");return e.detail?(V(),W("form",Te,[o("section",Ve,[o("div",null,[ge,i(l,{modelValue:e.detail.workcenterTypeId,"onUpdate:modelValue":s[0]||(s[0]=t=>e.detail.workcenterTypeId=t),editable:"",options:c(y).workcenterTypes,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":d.value.errors.workcenterTypeId}])},null,8,["modelValue","options","class"])]),o("div",null,[Ce,i(l,{modelValue:e.detail.preferredWorkcenterId,"onUpdate:modelValue":s[1]||(s[1]=t=>e.detail.preferredWorkcenterId=t),editable:"",options:c(y).workcenters,optionValue:"id",optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])]),o("div",null,[Ee,i(l,{modelValue:e.detail.machineStatusId,"onUpdate:modelValue":s[2]||(s[2]=t=>e.detail.machineStatusId=t),editable:"",options:c(y).machineStatuses,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":d.value.errors.machineStatusId}])},null,8,["modelValue","options","class"])])]),o("section",Pe,[o("div",null,[De,i(l,{modelValue:e.detail.operatorTypeId,"onUpdate:modelValue":s[3]||(s[3]=t=>e.detail.operatorTypeId=t),editable:"",options:c(y).operatorTypes,optionValue:"id",optionLabel:"name",class:g(["w-full",{"p-invalid":d.value.errors.operatorTypeId}])},null,8,["modelValue","options","class"])]),o("div",null,[i(B,{type:c(A).NUMERIC,decimals:2,label:"Temps estimat (min)",modelValue:e.detail.estimatedTime,"onUpdate:modelValue":s[4]||(s[4]=t=>e.detail.estimatedTime=t),class:g({"p-invalid":d.value.errors.estimatedTime})},null,8,["type","modelValue","class"])]),o("div",null,[Me,i(n,{modelValue:e.detail.isCycleTime,"onUpdate:modelValue":s[5]||(s[5]=t=>e.detail.isCycleTime=t),class:"w-full",binary:!0},null,8,["modelValue"])])]),o("section",Se,[o("div",null,[Be,i(n,{modelValue:e.detail.isExternalWork,"onUpdate:modelValue":s[6]||(s[6]=t=>e.detail.isExternalWork=t),class:"w-full",binary:!0},null,8,["modelValue"])]),o("div",null,[i(B,{type:c(A).CURRENCY,label:"Cost extern",modelValue:e.detail.externalWorkCost,"onUpdate:modelValue":s[7]||(s[7]=t=>e.detail.externalWorkCost=t),disabled:!e.detail.isExternalWork,class:g({"p-invalid":d.value.errors.externalWorkCost})},null,8,["type","modelValue","disabled","class"])])]),qe,o("div",null,[i(p,{label:"Guardar pas",style:{float:"right"},size:"small",onClick:a})])])):D("",!0)}}}),Re={class:"flex flex-wrap align-items-center justify-content-between gap-2"},We=o("span",{class:"text-xl text-900 font-bold"},"Materials de fabricació",-1),Ue=["onClick"],Fe=q({__name:"TableWorkmasterPhaseBillOfMaterials",props:{workmasterPhase:{},billOfMaterials:{}},emits:["add","edit","delete"],setup(T,{emit:v}){const h=T,y=H(),m=G(),b=e=>{var l;if(!m.references)return"";const s=(l=m.references)==null?void 0:l.find(n=>e===n.id);return s?m.getFullName(s):""},d=()=>{const e={id:Y(),workMasterPhaseId:h.workmasterPhase.id,referenceId:"",quantity:0,waste:0};v("add",e)},k=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||v("edit",e.data)},a=(e,s)=>{y.require({target:e.currentTarget,message:"Está segur que vol eliminar el material de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",s)}})};return(e,s)=>{const l=w("Button"),n=w("Column"),p=w("DataTable");return V(),R(p,{onRowClick:k,value:e.billOfMaterials,tableStyle:"min-width: 100%"},{header:f(()=>[o("div",Re,[We,i(l,{icon:c(U).PLUS,rounded:"",raised:"",onClick:d},null,8,["icon"])])]),default:f(()=>[i(n,{header:"Material consum",style:{width:"30%"}},{body:f(t=>[M(S(b(t.data.referenceId)),1)]),_:1}),i(n,{field:"quantity",header:"Consum",style:{width:"15%"}}),i(n,{header:"Material rebuig",style:{width:"30%"}},{body:f(t=>[M(S(b(t.data.wasteReferenceId)),1)]),_:1}),i(n,{field:"waste",header:"Rebuig",style:{width:"15%"}}),i(n,{style:{width:"10%"}},{body:f(t=>[o("i",{class:g([c(U).TIMES,"grid_delete_column_button"]),onClick:u=>a(u,t.data)},null,10,Ue)]),_:1})]),_:1},8,["value"])}}}),Ae={key:0},Ne={class:"two-columns"},Le={class:"two-columns mt-2"},Oe=o("br",null,null,-1),je=q({__name:"FormWorkmasterPhaseBomItem",props:{bomItem:{}},emits:["submit","cancel"],setup(T,{emit:v}){const h=T;G();const y=x(),m=O().shape({referenceId:$().required("El material de consum és obligatori"),quantity:L().min(1,"La quantitat a consumir ha de ser positiva").required("La quantitat a consumir és obligatoria")}),b=E({result:!1,errors:{}}),d=()=>{const a=new j(m);b.value=a.validate(h.bomItem)},k=async()=>{if(d(),b.value.result)v("submit",h.bomItem);else{let a="";Object.entries(b.value.errors).forEach(e=>{a+=`${e[1].map(s=>s)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,e)=>{const s=w("Button");return a.bomItem?(V(),W("form",Ae,[o("section",Ne,[o("div",null,[i(Q,{label:"Material de consum",modelValue:a.bomItem.referenceId,"onUpdate:modelValue":e[0]||(e[0]=l=>a.bomItem.referenceId=l),class:g({"p-invalid":b.value.errors.referenceId})},null,8,["modelValue","class"])]),o("div",null,[i(B,{type:c(A).NUMERIC,decimals:2,label:"Quantitat a consumir",modelValue:a.bomItem.quantity,"onUpdate:modelValue":e[1]||(e[1]=l=>a.bomItem.quantity=l),class:g({"p-invalid":b.value.errors.quantity})},null,8,["type","modelValue","class"])])]),o("section",Le,[o("div",null,[i(Q,{label:"Material de rebuig",modelValue:a.bomItem.wasteReferenceId,"onUpdate:modelValue":e[2]||(e[2]=l=>a.bomItem.wasteReferenceId=l)},null,8,["modelValue"])]),o("div",null,[i(B,{type:c(A).NUMERIC,decimals:2,label:"Quantitat de rebuig",modelValue:a.bomItem.waste,"onUpdate:modelValue":e[3]||(e[3]=l=>a.bomItem.waste=l),class:g({"p-invalid":b.value.errors.waste})},null,8,["type","modelValue","class"])])]),Oe,o("div",null,[i(s,{label:"Guardar material",style:{float:"right"},size:"small",onClick:k})])])):D("",!0)}}}),xe={key:0,class:"main"},at=q({__name:"WorkmasterPhase",setup(T){const v=ne(),h=re(),y=de(),m=G(),b=z(),d=be(),{workmaster:k,workmasterPhase:a}=ue(d),e=E(""),s=E(""),l=me({visible:!1,title:"Linea",closable:!0,position:"center",modal:!0});ce(async()=>{e.value=v.params.id,s.value=v.params.phaseid,await n();let r="";r="Ruta de fabricació",k.value&&a.value&&(r=`${r} ${m.getFullName(k.value.reference)} - Fase ${a.value.phaseCode}`),y.setMenuItem({icon:U.BUILDING,backButtonVisible:!0,title:r}),m.fetchReferencesByModule("purchase"),b.fetchActiveModel()});const n=async()=>{await d.fetchPhaseById(s.value)},p=async r=>{await d.updatePhase(s.value,r)&&h.back()},t=E(C.CREATE),u=E(void 0),P=E(void 0),_=()=>{u.value=void 0,P.value=void 0},N=r=>{t.value=C.CREATE,u.value=r,l.title="Afegir pas de fabricació",l.visible=!0},J=r=>{t.value=C.EDIT,u.value=r,l.title="Modificar pas de fabricació",l.visible=!0},K=r=>{d.deletePhaseDetail(r.id)},X=async r=>{let I;t.value===C.CREATE?I=d.createPhaseDetail(r):t.value===C.EDIT&&(I=d.updatePhaseDetail(r.id,r)),await I&&(l.visible=!1)},Z=r=>{t.value=C.CREATE,P.value=r,l.title="Afegir material",l.visible=!0},ee=r=>{t.value=C.EDIT,P.value=r,l.title="Modificar material",l.visible=!0},te=r=>{d.deletePhaseBomItem(r.id)},ae=async r=>{let I;t.value===C.CREATE?I=d.createPhaseBomItem(r):t.value===C.EDIT&&(I=d.updatePhaseBomItem(r.id,r)),await I&&(l.visible=!1)};return(r,I)=>{const F=w("TabPanel"),le=w("TabView"),oe=w("Dialog");return V(),W(pe,null,[o("header",null,[c(k)&&c(a)?(V(),R(ye,{key:0,workmaster:c(k),phase:c(a),onSubmit:p},null,8,["workmaster","phase"])):D("",!0)]),c(a)?(V(),W("main",xe,[i(le,null,{default:f(()=>[i(F,{header:"Pasos"},{default:f(()=>[i(Ie,{workmasterPhase:c(a),details:c(a).details,onAdd:N,onEdit:J,onDelete:K},null,8,["workmasterPhase","details"])]),_:1}),i(F,{header:"Materials"},{default:f(()=>[i(Fe,{workmasterPhase:c(a),billOfMaterials:c(a).billOfMaterials,onAdd:Z,onEdit:ee,onDelete:te},null,8,["workmasterPhase","billOfMaterials"])]),_:1})]),_:1}),i(oe,{visible:l.visible,"onUpdate:visible":I[0]||(I[0]=se=>l.visible=se),header:l.title,closable:l.closable,modal:l.modal,onHide:_},{default:f(()=>[u.value?(V(),R($e,{key:0,detail:u.value,onSubmit:X},null,8,["detail"])):D("",!0),P.value?(V(),R(je,{key:1,bomItem:P.value,onSubmit:ae},null,8,["bomItem"])):D("",!0)]),_:1},8,["visible","header","closable","modal"])])):D("",!0)],64)}}});export{at as default};
