import{d as F,j as U,z as E,o as L,r as q,h as p,a as T,c as R,i as l,k as t,e as s,n as _,s as C,y as D,l as z,p as A,b as G,f as M,v as O,u as j,m as X,w as f,P as x}from"./index-f2f50ed2.js";import{u as P}from"./receipt-2ce2281f.js";import{u as $}from"./suppliers-ec6dc732.js";import{u as J}from"./lifecycle-20f9261b.js";import{c as H,a as N,F as K}from"./form-validator-929472fd.js";import{c as Q}from"./functions-13b40d42.js";import{u as W}from"./masterData-74bbfc2c.js";import"./index-e4c71092.js";import"./base.service-1bae7a9f.js";import"./suppliers.service-69572484.js";import"./index-ac3219c8.js";import"./v4-a960c1f4.js";const v=n=>(A("data-v-5cd0e1f5"),n=n(),G(),n),Y={key:0},Z={class:"four-columns"},ee={class:"mt-1"},te=v(()=>s("label",{class:"block text-900 mb-2"},"Exercici",-1)),se={class:"mt-1"},oe={class:"mt-1"},ae=v(()=>s("label",{class:"block text-900 mb-2"},"Data Albarà",-1)),le={class:"mt-1"},re=v(()=>s("label",{class:"block text-900 mb-2"},"Estat",-1)),ie={class:"three-columns"},ne={class:"mt-1"},ce=v(()=>s("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),ue={class:"mt-1"},de=F({__name:"FormReceipt",emits:["submit","cancel"],setup(n,{expose:V,emit:y}){const c=P(),i=$(),u=W(),b=J(),I=U(),{receipt:e}=E(c);L(async()=>{await u.fetchMasterData(),await i.fetchSuppliers(),await b.fetchOneByName("Receipts")});const d=H().shape({supplierId:N().required("El client es obligatori"),statusId:N().required("L'estat es obligatori"),exerciseId:N().required("L'exercici es obligatori")}),r=q({result:!1,errors:{}}),h=()=>{const m=new K(d);r.value=m.validate(e.value)},B=async()=>{if(h(),r.value.result)e.value.date=Q(e.value.date),y("submit",e.value);else{let m="";Object.entries(r.value.errors).forEach(o=>{m+=`${o[1].map(w=>w)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:m,life:5e3})}};return V({submitForm:B}),(m,o)=>{var k;const w=p("Button"),S=p("Dropdown"),g=p("Calendar");return T(),R("div",null,[l(w,{label:"Guardar",class:"grid_add_row_button",onClick:B}),t(e)?(T(),R("form",Y,[s("section",Z,[s("div",ee,[te,l(S,{modelValue:t(e).exerciseId,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).exerciseId=a),editable:"",options:t(u).exercises,optionValue:"id",optionLabel:"name",class:_(["w-full",{"p-invalid":r.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),s("div",se,[l(D,{type:t(C).TEXT,label:"Número",id:"number",modelValue:t(e).number,"onUpdate:modelValue":o[1]||(o[1]=a=>t(e).number=a),disabled:""},null,8,["type","modelValue"])]),s("div",oe,[ae,l(g,{modelValue:t(e).date,"onUpdate:modelValue":o[2]||(o[2]=a=>t(e).date=a),dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),s("div",le,[re,l(S,{modelValue:t(e).statusId,"onUpdate:modelValue":o[3]||(o[3]=a=>t(e).statusId=a),editable:"",options:(k=t(b).lifecycle)==null?void 0:k.statuses,optionValue:"id",optionLabel:"name",class:_(["w-full",{"p-invalid":r.value.errors.statusId}])},null,8,["modelValue","options","class"])])]),s("section",ie,[s("div",ne,[ce,l(S,{modelValue:t(e).supplierId,"onUpdate:modelValue":o[4]||(o[4]=a=>t(e).supplierId=a),editable:"",options:t(i).suppliers,optionValue:"id",optionLabel:"comercialName",class:_(["w-full",{"p-invalid":r.value.errors.customerId}])},null,8,["modelValue","options","class"])]),s("div",ue,[l(D,{type:t(C).TEXT,label:"Número Proveïdor",id:"supplierNumber",modelValue:t(e).supplierNumber,"onUpdate:modelValue":o[5]||(o[5]=a=>t(e).supplierNumber=a)},null,8,["type","modelValue"])])])])):z("",!0)])}}});const me=M(de,[["__scopeId","data-v-5cd0e1f5"]]),pe=s("span",null,"Proveïdor",-1),_e=s("span",null,"Contactes",-1),Be=F({__name:"Receipt",setup(n){const V=O(),y=j(),c=P();$();const{receipt:i}=E(c),u=async()=>{var e;await c.fetchReceipt(V.params.id),y.setMenuItem({icon:x.BUILDING,title:`Albarà de compra ${(e=i.value)==null?void 0:e.number}`,backButtonVisible:!0})};L(async()=>{await u()});const b=U(),I=async()=>{let e=!1,d="";i.value&&(e=await c.updateReceipt(i.value.id,i.value),d="Albarà actualizat correctament",e&&(b.add({severity:"success",summary:d,life:5e3}),await u()))};return(e,d)=>{const r=p("TabPanel"),h=p("TabView");return T(),X(h,null,{default:f(()=>[l(r,null,{header:f(()=>[s("i",{class:_([t(x).BUILDING,"mr-2"])},null,2),pe]),default:f(()=>[l(me,{onSubmit:I})]),_:1}),l(r,null,{header:f(()=>[s("i",{class:_([t(x).USERS,"mr-2"])},null,2),_e]),_:1})]),_:1})}}});export{Be as default};
