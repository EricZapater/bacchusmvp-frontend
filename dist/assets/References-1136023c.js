import{d as E,r as V,H as b,h as w,m as n,w as p,a as c,e as y,i as l,y as N,k as I,P as D,l as d,D as x,n as q,p as j,b as H,f as P,g as U,v as z,u as A,x as K,j as L,o as G}from"./index-c707b5be.js";import{u as $}from"./reference-ef5b5fae.js";import{u as J}from"./referenceType-aea5f149.js";import{v as O}from"./v4-a960c1f4.js";import"./reference.service-6f48d6ad.js";import"./base.service-557ead35.js";import"./index-d29cd318.js";const Q=m=>(j("data-v-9bc7cd72"),m=m(),H(),m),W={class:"references-header"},X={class:"references-filter"},Y=Q(()=>y("label",null,"Codi",-1)),Z=["onClick"],ee=E({__name:"TableReferences",props:{module:{},references:{}},emits:["add","edit","delete"],setup(m,{emit:_}){const i=m,C=J(),h=$(),v=V({code:""}),u=b(()=>i.module==="sales"),o=b(()=>i.module==="purchase");b(()=>i.module==="production");const R=b(()=>i.references?v.value.code.length>0?i.references.filter(t=>t.code.includes(v.value.code)):h.references:[]),S=()=>{_("add")},T=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||_("edit",t.data)},k=(t,a)=>{_("delete",a)},g=t=>{var f;const a=(f=h.referenceFormats)==null?void 0:f.find(e=>e.id===t);return a?a.description:""},s=t=>{var f;const a=(f=C.referenceTypes)==null?void 0:f.find(e=>e.id===t);return a?a.name:""};return(t,a)=>{const f=w("Button"),e=w("Column"),B=w("BooleanColumn"),F=w("DataTable");return c(),n(F,{value:R.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",onRowClick:T},{header:p(()=>[y("div",W,[y("div",X,[Y,l(N,{modelValue:v.value.code,"onUpdate:modelValue":a[0]||(a[0]=r=>v.value.code=r)},null,8,["modelValue"])]),l(f,{style:{float:"right"},icon:I(D).PLUS,rounded:"",raised:"",onClick:S},null,8,["icon"])])]),default:p(()=>[l(e,{field:"code",header:"Codi",style:{width:"15%"}}),l(e,{field:"description",header:"Descripció",style:{width:"35%"}}),u.value?(c(),n(e,{key:0,field:"version",header:"Versió",style:{width:"10%"}})):d("",!0),u.value?(c(),n(e,{key:1,field:"cost",header:"Cost",style:{width:"20%"}})):d("",!0),u.value?(c(),n(e,{key:2,field:"price",header:"Preu",style:{width:"20%"}})):d("",!0),u.value?(c(),n(e,{key:3,header:"Servei",style:{width:"10%"}},{body:p(r=>[l(B,{value:r.data.isService},null,8,["value"])]),_:1})):d("",!0),o.value?(c(),n(e,{key:4,field:"referenceTypeId",header:"Tipus",style:{width:"10%"}},{body:p(r=>[y("span",null,x(s(r.data.referenceTypeId)),1)]),_:1})):d("",!0),o.value?(c(),n(e,{key:5,field:"referenceFormatId",header:"Format",style:{width:"10%"}},{body:p(r=>[y("span",null,x(g(r.data.referenceFormatId)),1)]),_:1})):d("",!0),o.value?(c(),n(e,{key:6,field:"density",header:"Densitat",style:{width:"10%"}})):d("",!0),o.value?(c(),n(e,{key:7,field:"lastPurchaseCost",header:"Última Compra",style:{width:"15%"}})):d("",!0),l(e,{header:"Desc.",style:{width:"10%"}},{body:p(r=>[l(B,{value:r.data.disabled},null,8,["value"])]),_:1}),l(e,{style:{width:"10%"}},{body:p(r=>[y("i",{class:q([I(D).TIMES,"grid_delete_column_button"]),onClick:M=>k(M,r.data)},null,10,Z)]),_:1})]),_:1},8,["value"])}}});const te=P(ee,[["__scopeId","data-v-9bc7cd72"]]),se=E({__name:"References",setup(m){const _=U(),i=z(),C=A(),h=$(),v=K(),u=L(),o=V("");G(async()=>{o.value=i.params.module,await h.fetchReferencesByModule(o.value);let s="";o.value==="sales"?s="Referencies de venta":o.value==="purchase"?s="Materies primeres":o.value==="production"&&(s="Referencies de producció"),C.setMenuItem({icon:D.TICKET,title:s})});const R=()=>{_.push({path:`/reference/${o.value}/${O()}`})},S=s=>{_.push({path:`/reference/${o.value}/${s.id}`})},T=s=>{v.require({message:`Está segur que vol eliminar el material ${s.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const t=await h.deleteReference(s.id);console.log(t),t.result?g():k(t)}})},k=s=>{u.add({severity:"error",summary:s.errors[0],life:3e3,closable:!0})},g=()=>{u.add({severity:"success",summary:"Eliminat",life:3e3})};return(s,t)=>(c(),n(te,{module:o.value,references:I(h).references,onAdd:R,onEdit:S,onDelete:T},null,8,["module","references"]))}});const ie=P(se,[["__scopeId","data-v-9afaabc1"]]);export{ie as default};
