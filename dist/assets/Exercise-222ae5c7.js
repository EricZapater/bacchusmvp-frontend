import{d as w,j as _,r as C,h as p,c as B,e as o,i,n as v,y as D,l as I,a as F,F as b,g,v as N,u as T,z as U,o as $,k as y,m as L,P as R}from"./index-ed8fb5bb.js";import{c as q,a as E,e as k,f as A,F as M}from"./form-validator-95718e4a.js";import{u as S}from"./exercise-a3bfd77d.js";import"./index-f2c65ad9.js";import"./base.service-1efb2a9b.js";const z={key:0},j={class:"two-columns"},G={class:"two-columns",style:{"margin-bottom":"1rem"}},O=o("label",{class:"block text-900 mb-2"},"Data inici",-1),P=o("label",{class:"block text-900 mb-2"},"Data fi",-1),H={class:"two-columns"},J=o("label",{class:"block text-900 mb-2"},"Comptador factures de compra",-1),K=o("label",{class:"block text-900 mb-2"},"Desactivat",-1),Q={class:"mt-2"},W=w({__name:"FormExercise",props:{exercise:{}},emits:["submit","cancel"],setup(V,{emit:c}){const u=V,m=_(),f=q().shape({name:E().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:E().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),startDate:k().required("La data d'inici es obligatoria"),endDate:k().required("La data final es obligatoria").min(A("startDate"),"La data final de l'exercici ha de ser posterior a l'inici")}),s=C({result:!1,errors:{}}),r=()=>{const e=new M(f);s.value=e.validate(u.exercise)},x=async()=>{if(r(),s.value.result)c("submit",u.exercise);else{let e="";Object.entries(s.value.errors).forEach(a=>{e+=`${a[1].map(t=>t)}.   `}),m.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,a)=>{const t=p("Calendar"),n=p("InputNumber"),d=p("Checkbox"),h=p("Button");return e.exercise?(F(),B("form",z,[o("div",j,[i(D,{class:v(["mb-2",{"p-invalid":s.value.errors.name}]),label:"Nom",id:"name",modelValue:e.exercise.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.exercise.name=l)},null,8,["modelValue","class"]),i(D,{class:v(["mb-2",{"p-invalid":s.value.errors.description}]),label:"Descripció",id:"description",modelValue:e.exercise.description,"onUpdate:modelValue":a[1]||(a[1]=l=>e.exercise.description=l)},null,8,["modelValue","class"])]),o("div",G,[o("div",null,[O,i(t,{modelValue:e.exercise.startDate,"onUpdate:modelValue":a[2]||(a[2]=l=>e.exercise.startDate=l),dateFormat:"dd/mm/yy",class:v({"p-invalid":s.value.errors.startDate})},null,8,["modelValue","class"])]),o("div",null,[P,i(t,{modelValue:e.exercise.endDate,"onUpdate:modelValue":a[3]||(a[3]=l=>e.exercise.endDate=l),dateFormat:"dd/mm/yy",class:v({"p-invalid":s.value.errors.endDate})},null,8,["modelValue","class"])])]),o("div",H,[o("div",null,[J,i(n,{modelValue:e.exercise.purchaseInvoiceCounter,"onUpdate:modelValue":a[4]||(a[4]=l=>e.exercise.purchaseInvoiceCounter=l),class:"w-full mb-2"},null,8,["modelValue"])]),o("div",null,[K,i(d,{modelValue:e.exercise.disabled,"onUpdate:modelValue":a[5]||(a[5]=l=>e.exercise.disabled=l),class:"w-full",binary:!0},null,8,["modelValue"])])]),o("div",Q,[i(h,{label:"Guardar",class:"mr-2",onClick:x})])])):I("",!0)}}}),se=w({__name:"Exercise",setup(V){const c=C(b.EDIT),u=g(),m=N(),f=T(),s=S(),{exercise:r}=U(s),x=async()=>{await s.fetchOne(m.params.id);let t="";r.value?(c.value=b.EDIT,t=`Exercici ${r.value.name}`,r.value.startDate=new Date(r.value.startDate),r.value.endDate=new Date(r.value.endDate)):(c.value=b.CREATE,s.setNew(m.params.id),t="Alta d'exercici"),f.setMenuItem({icon:R.BUILDING,backButtonVisible:!0,title:t})};$(async()=>{await x()});const e=_(),a=async()=>{const t=r.value;let n=!1,d="";c.value===b.CREATE?(n=await s.create(t),d="Exercici creat correctament"):(n=await s.update(t.id,t),d="Exercici actualizat correctament"),n&&(e.add({severity:"success",summary:d,life:5e3}),u.back())};return(t,n)=>y(r)?(F(),L(W,{key:0,exercise:y(r),onSubmit:a},null,8,["exercise"])):I("",!0)}});export{se as default};
